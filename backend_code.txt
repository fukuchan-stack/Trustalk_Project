
--- FILE: ./backend/knowledge_base_manager.py ---
# sqlite3のバージョン問題を解決するためのパッチ
__import__('pysqlite3')
import sys
sys.modules['sqlite3'] = sys.modules.pop('pysqlite3')

import chromadb
import os
import openai
from langchain_openai import OpenAIEmbeddings
from langchain.text_splitter import RecursiveCharacterTextSplitter
import uuid

class KnowledgeBaseManager:
    """
    ミーティングのナレッジを管理するためのクラス。
    ベクトルデータベース(ChromaDB)への接続、データの追加、検索を担当します。
    """
    DB_PATH = "backend/db/chroma_db"
    COLLECTION_NAME = "meeting_transcripts"

    def __init__(self):
        """
        KnowledgeBaseManagerを初期化します。
        DBへの接続とコレクションの準備を行います。
        """
        os.makedirs(self.DB_PATH, exist_ok=True)
        
        self.client = chromadb.PersistentClient(path=self.DB_PATH)
        self.collection = self.client.get_or_create_collection(name=self.COLLECTION_NAME)
        
        if "OPENAI_API_KEY" not in os.environ:
            raise ValueError("環境変数 `OPENAI_API_KEY` が設定されていません。")
        openai.api_key = os.environ["OPENAI_API_KEY"]
        
        self.embedding_model = OpenAIEmbeddings(model="text-embedding-3-small")
        self.text_splitter = RecursiveCharacterTextSplitter(
            chunk_size=1000,
            chunk_overlap=200,
        )
        
        print("✅ ナレッジベースの準備が完了しました。")
        print(f"データベースのパス: {os.path.abspath(self.DB_PATH)}")
        print(f"コレクション名: {self.collection.name}")
        print(f"現在のナレッジ数: {self.collection.count()}")

    def add_text_to_knowledge_base(self, text_content: str, metadata: dict):
        """
        与えられたテキストコンテンツをナレッジベースに追加します。
        """
        if not text_content.strip():
            print(f"⚠️  ソース: {metadata.get('source_file', '不明')} のコンテンツが空のため、スキップします。")
            return

        chunks = self.text_splitter.split_text(text_content)
        ids = [str(uuid.uuid4()) for _ in chunks]

        self.collection.add(
            ids=ids,
            documents=chunks,
            metadatas=[metadata for _ in chunks]
        )
        
        print(f"✅ ソース: {metadata.get('source_file', '不明')} から {len(chunks)}個のナレッジを追加しました。")

# このファイルが直接実行された場合のテスト用コード
if __name__ == '__main__':
    print("ナレッジベースマネージャーの初期化テストを開始します...")
    try:
        kb_manager = KnowledgeBaseManager()
        print("🎉 テスト成功: KnowledgeBaseManagerのインスタンスが正常に作成されました。")
    except Exception as e:
        print(f"❌ テスト失敗: 初期化中にエラーが発生しました。")
        print(e)
--- FILE: ./backend/main.py ---
import os
import uuid
import json
import torch
import traceback
import subprocess
import re
import threading
import pandas as pd
from datetime import datetime, timezone
from typing import List
from pydantic import BaseModel
from fastapi import FastAPI, UploadFile, File, HTTPException, Form
from fastapi.responses import JSONResponse
from fastapi.middleware.cors import CORSMiddleware
from pyannote.audio import Pipeline
import whisper_timestamped as whisper
from ai_pipelines import run_self_improvement_pipeline, run_benchmark_pipeline
from rag_pipelines import run_rag_benchmark_pipeline, _parse_csv_to_records
from cost_calculator import calculate_cost_in_jpy
from io import BytesIO

# --- 環境変数 ---
HF_TOKEN = os.getenv("HF_TOKEN")
if not HF_TOKEN:
    raise ValueError("環境変数 HF_TOKEN が設定されていません。")

# --- AIモデルのグローバル変数 (遅延読み込み) ---
device = "cuda" if torch.cuda.is_available() else "cpu"
whisper_model = None
diarization_pipeline = None
whisper_lock = threading.Lock()
pyannote_lock = threading.Lock()

# --- モデル読み込み関数 ---
def load_whisper_model():
    global whisper_model
    with whisper_lock:
        if whisper_model is None:
            print("Whisper: Loading 'base' model for the first time...")
            whisper_model = whisper.load_model("base", device=device)
            print("Whisper: Model loaded successfully.")

def load_pyannote_pipeline():
    global diarization_pipeline
    with pyannote_lock:
        if diarization_pipeline is None:
            print("Pyannote: Loading diarization pipeline for the first time...")
            diarization_pipeline = Pipeline.from_pretrained("pyannote/speaker-diarization-3.1", use_auth_token=HF_TOKEN).to(torch.device(device))
            print("Pyannote: Diarization pipeline loaded successfully.")

# --- FastAPIアプリケーションのセットアップ ---
app = FastAPI(title="Trustalk API", version="2.5.0")
app.add_middleware(CORSMiddleware, allow_origins=["*"], allow_credentials=True, allow_methods=["*"], allow_headers=["*"])
HISTORY_DIR = "history"
RAG_HISTORY_DIR = "rag_history"
os.makedirs(HISTORY_DIR, exist_ok=True)
os.makedirs(RAG_HISTORY_DIR, exist_ok=True)

# --- ヘルパー関数 ---
def merge_results(diarization, transcription):
    if not diarization: return "話者分離パイプラインが利用できません。", transcription.get("text", "")
    word_speakers, current_speaker, current_speech = [], None, ""
    for segment in transcription.get("segments", []):
        for word in segment.get("words", []):
            speaker_label = "UNKNOWN"
            try:
                cropped_annotation = diarization.crop(word)
                if cropped_annotation:
                    speaker_turn = cropped_annotation.get_timeline().support().pop(0)
                    speaker_label = speaker_turn[2]
            except (IndexError, KeyError): speaker_label = "UNKNOWN"
            word_speakers.append({'word': word.get('text', ''), 'speaker': speaker_label})
    if not word_speakers: return "発言が見つかりませんでした。", transcription.get("text", "")
    full_transcript_with_speakers, current_speaker, current_speech = "", word_speakers[0]['speaker'], ""
    for item in word_speakers:
        word, speaker = item['word'], item['speaker']
        if speaker != current_speaker:
            full_transcript_with_speakers += f"**{current_speaker}**: {current_speech.strip()}\n\n"; current_speech = ""
        current_speech += word + " "; current_speaker = speaker
    if current_speech: full_transcript_with_speakers += f"**{current_speaker}**: {current_speech.strip()}\n"
    return full_transcript_with_speakers.strip(), transcription.get("text", "")

# --- APIエンドポイント ---
@app.get("/", summary="APIのヘルスチェック")
def read_root(): return {"status": "ok"}

@app.post("/analyze", summary="音声ファイルの分析")
async def analyze_audio(file: UploadFile = File(...), model_name: str = Form("gpt-4o-mini")):
    load_whisper_model(); load_pyannote_pipeline()
    original_filename, temp_file_path = file.filename, f"/tmp/{uuid.uuid4()}_{file.filename}"
    wav_file_path = f"{os.path.splitext(temp_file_path)[0]}.wav"
    try:
        with open(temp_file_path, "wb") as buffer: contents = await file.read(); buffer.write(contents)
        command = ["ffmpeg", "-i", temp_file_path, "-ar", "16000", "-ac", "1", "-c:a", "pcm_s16le", wav_file_path]; subprocess.run(command, check=True, capture_output=True, text=True)
        audio = whisper.load_audio(wav_file_path)
        audio_duration_seconds = len(audio) / whisper.audio.SAMPLE_RATE
        transcription_result = whisper.transcribe(whisper_model, audio, language="ja", detect_disfluencies=True)
        diarization_result = diarization_pipeline(wav_file_path)
        speakers_text, transcript_text = merge_results(diarization_result, transcription_result)
        cleaned_text = re.sub(r'[\(\[].*?[\)\]]', '', transcript_text or "").strip()
        if len(cleaned_text) < 10:
            summary_text, todos_list, reliability_info, token_usage = "- 音声が短すぎるため要約できません。", [], {"score": 0.0, "justification": "評価できません。"}, {"input_tokens": 0, "output_tokens": 0}
        else:
            summary_text, todos_list, reliability_info, token_usage = run_self_improvement_pipeline(model_name, transcript_text)
        calculated_cost_jpy = calculate_cost_in_jpy(model_name=model_name, total_input_tokens=token_usage.get("input_tokens", 0), total_output_tokens=token_usage.get("output_tokens", 0), audio_duration_seconds=audio_duration_seconds)
        result = { "id": str(uuid.uuid4()), "createdAt": datetime.now(timezone.utc).isoformat(), "originalFilename": original_filename, "model_name": model_name, "transcript": transcript_text if transcript_text and transcript_text.strip() else "有効な音声が検出されませんでした。", "summary": summary_text, "todos": todos_list, "speakers": speakers_text, "cost": calculated_cost_jpy, "reliability": reliability_info }
        history_file_path = os.path.join(HISTORY_DIR, f"{result['id']}.json")
        with open(history_file_path, "w", encoding="utf-8") as f: json.dump(result, f, ensure_ascii=False, indent=4)
        return JSONResponse(content=result)
    except Exception as e:
        print(traceback.format_exc()); raise HTTPException(status_code=500, detail=f"分析中に予期せぬエラー: {str(e)}")
    finally:
        if os.path.exists(temp_file_path): os.remove(temp_file_path)
        if os.path.exists(wav_file_path): os.remove(wav_file_path)

@app.post("/benchmark-summary", summary="単一の音声ファイルで、複数のモデルの性能を比較する")
async def benchmark_summary_audio(file: UploadFile = File(...), models_to_benchmark: str = Form(...)):
    load_whisper_model()
    try: models_to_run = json.loads(models_to_benchmark)
    except Exception: raise HTTPException(status_code=400, detail="無効なモデルリストが送信されました。")
    original_filename, temp_file_path = file.filename, f"/tmp/{uuid.uuid4()}_{file.filename}"
    wav_file_path = f"{os.path.splitext(temp_file_path)[0]}.wav"
    try:
        with open(temp_file_path, "wb") as buffer: contents = await file.read(); buffer.write(contents)
        command = ["ffmpeg", "-i", temp_file_path, "-ar", "16000", "-ac", "1", "-c:a", "pcm_s16le", wav_file_path]; subprocess.run(command, check=True, capture_output=True, text=True)
        audio = whisper.load_audio(wav_file_path)
        audio_duration_seconds = len(audio) / whisper.audio.SAMPLE_RATE
        transcription_result = whisper.transcribe(whisper_model, audio, language="ja", detect_disfluencies=True)
        transcript_text = transcription_result.get("text", "")
        cleaned_text = re.sub(r'[\(\[].*?[\)\]]', '', transcript_text or "").strip()
        if len(cleaned_text) < 10: raise HTTPException(status_code=400, detail="内容が短すぎるためベンチマークを実行できません。")
        benchmark_results = run_benchmark_pipeline(transcript_text, models_to_run)
        for result in benchmark_results:
            result["cost"] = calculate_cost_in_jpy(model_name=result["model_name"], total_input_tokens=result["token_usage"].get("input_tokens", 0), total_output_tokens=result["token_usage"].get("output_tokens", 0), audio_duration_seconds=audio_duration_seconds)
        return JSONResponse(content=benchmark_results)
    except Exception as e:
        print(traceback.format_exc()); raise HTTPException(status_code=500, detail=f"ベンチマーク中に予期せぬエラー: {str(e)}")
    finally:
        if os.path.exists(temp_file_path): os.remove(temp_file_path)
        if os.path.exists(wav_file_path): os.remove(wav_file_path)

@app.post("/benchmark-rag", summary="CSVデータセットで、複数のモデルと技術のRAG性能を一度に評価する")
async def benchmark_rag_multi(qa_file: UploadFile = File(...), context_file: UploadFile = File(...), models_to_run_json: str = Form(...), selected_indices_json: str = Form(...), advanced_rag_options_json: str = Form(...)):
    try:
        models_to_run, selected_indices, advanced_options = json.loads(models_to_run_json), json.loads(selected_indices_json), json.loads(advanced_rag_options_json)
        qa_file_content = await qa_file.read(); context_file_content = await context_file.read()
        all_qa_records = _parse_csv_to_records(BytesIO(qa_file_content), required_columns=["question", "ground_truth"])
        selected_qa_records = [all_qa_records[i] for i in selected_indices]
        if not selected_qa_records: raise HTTPException(status_code=400, detail="評価対象の質問が選択されていません。")
        benchmark_results = []
        for model_name in models_to_run:
            context_file_stream = BytesIO(context_file_content)
            results_data = run_rag_benchmark_pipeline(qa_dataset=selected_qa_records, context_file=context_file_stream, model_name=model_name, advanced_options=advanced_options)
            token_usage = results_data.get("token_usage", {})
            calculated_cost = calculate_cost_in_jpy(model_name=model_name, total_input_tokens=token_usage.get("input_tokens", 0), total_output_tokens=token_usage.get("output_tokens", 0), audio_duration_seconds=0)
            results_data["total_cost"] = calculated_cost
            results_data["model_name"] = model_name
            benchmark_results.append(results_data)
        rag_run_id = str(uuid.uuid4())
        final_data_to_save = { "id": rag_run_id, "createdAt": datetime.now(timezone.utc).isoformat(), "qa_filename": qa_file.filename, "context_filename": context_file.filename, "models_tested": models_to_run, "advanced_options": advanced_options, "num_questions": len(selected_qa_records), "results": benchmark_results }
        history_file_path = os.path.join(RAG_HISTORY_DIR, f"{rag_run_id}.json")
        with open(history_file_path, "w", encoding="utf-8") as f: json.dump(final_data_to_save, f, ensure_ascii=False, indent=4)
        return JSONResponse(content=final_data_to_save)
    except Exception as e:
        print(traceback.format_exc()); raise HTTPException(status_code=500, detail=f"RAGベンチマーク中にエラー: {str(e)}")

@app.get("/history", summary="分析履歴の一覧を取得")
async def get_history_list():
    try:
        history_summary = []
        files = [f for f in os.listdir(HISTORY_DIR) if f.endswith(".json")]
        for filename in files:
            file_path = os.path.join(HISTORY_DIR, filename)
            with open(file_path, "r", encoding="utf-8") as f:
                data = json.load(f)
                reliability_data = data.get("reliability", {})
                score = reliability_data.get("score", 0.0) if isinstance(reliability_data, dict) else 0.0
                history_summary.append({
                    "id": data.get("id"), "createdAt": data.get("createdAt"),
                    "originalFilename": data.get("originalFilename", "ファイル名不明"), "cost": data.get("cost", 0.0),
                    "model_name": data.get("model_name", "不明"), "reliability_score": score
                })
        valid_history = [h for h in history_summary if h.get("createdAt")]
        sorted_history = sorted(valid_history, key=lambda x: x["createdAt"], reverse=True)
        return sorted_history
    except Exception as e:
        raise HTTPException(status_code=500, detail=f"履歴の読み込み中にエラーが発生しました: {str(e)}")

@app.get("/history/{file_id}", summary="特定の分析履歴を取得")
async def get_history_detail(file_id: str):
    file_path = os.path.join(HISTORY_DIR, f"{file_id}.json")
    if not os.path.exists(file_path):
        raise HTTPException(status_code=404, detail="指定された分析履歴が見つかりません。")
    try:
        with open(file_path, "r", encoding="utf-8") as f:
            data = json.load(f)
        return data
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

class DeleteHistoryRequest(BaseModel):
    ids: List[str]

@app.post("/history/delete", summary="指定された分析履歴を削除する")
async def delete_history(request: DeleteHistoryRequest):
    deleted_count = 0; errors = []
    for file_id in request.ids:
        if ".." in file_id or "/" in file_id or "\\" in file_id:
            errors.append(f"不正なID形式: {file_id}"); continue
        file_path = os.path.join(HISTORY_DIR, f"{file_id}.json")
        if os.path.exists(file_path):
            try:
                os.remove(file_path); deleted_count += 1
            except Exception as e:
                errors.append(f"{file_id}の削除中にエラー: {e}")
        else:
            errors.append(f"ファイルが見つかりません: {file_id}")
    if errors:
        raise HTTPException(status_code=500, detail={"message": "一部のファイルの削除に失敗しました。", "errors": errors})
    return {"message": f"{deleted_count}件の履歴を削除しました。", "deleted_count": deleted_count}

@app.get("/history-rag", summary="RAG評価履歴の一覧を取得")
async def get_rag_history_list():
    try:
        history_summary = []
        files = [f for f in os.listdir(RAG_HISTORY_DIR) if f.endswith(".json")]
        for filename in files:
            file_path = os.path.join(RAG_HISTORY_DIR, filename)
            with open(file_path, "r", encoding="utf-8") as f:
                data = json.load(f)
                history_summary.append({
                    "id": data.get("id"), "createdAt": data.get("createdAt"),
                    "qa_filename": data.get("qa_filename", "不明"),
                    "context_filename": data.get("context_filename", "不明"),
                    "models_tested": data.get("models_tested", []),
                    "num_questions": data.get("num_questions", 0),
                })
        valid_history = [h for h in history_summary if h.get("createdAt")]
        sorted_history = sorted(valid_history, key=lambda x: x["createdAt"], reverse=True)
        return sorted_history
    except Exception as e:
        raise HTTPException(status_code=500, detail=f"RAG履歴の読み込み中にエラーが発生しました: {str(e)}")

@app.get("/history-rag/{file_id}", summary="特定のRAG評価履歴を取得")
async def get_rag_history_detail(file_id: str):
    if ".." in file_id or "/" in file_id or "\\" in file_id:
        raise HTTPException(status_code=400, detail="不正なファイルIDです。")
    file_path = os.path.join(RAG_HISTORY_DIR, f"{file_id}.json")
    if not os.path.exists(file_path):
        raise HTTPException(status_code=404, detail="指定されたRAG評価履歴が見つかりません。")
    try:
        with open(file_path, "r", encoding="utf-8") as f:
            data = json.load(f)
        return data
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))

@app.post("/history-rag/delete", summary="指定されたRAG評価履歴を削除する")
async def delete_rag_history(request: DeleteHistoryRequest):
    deleted_count = 0; errors = []
    for file_id in request.ids:
        if ".." in file_id or "/" in file_id or "\\" in file_id:
            errors.append(f"不正なID形式: {file_id}"); continue
        file_path = os.path.join(RAG_HISTORY_DIR, f"{file_id}.json")
        if os.path.exists(file_path):
            try: os.remove(file_path); deleted_count += 1
            except Exception as e: errors.append(f"{file_id}の削除中エラー: {e}")
        else: errors.append(f"ファイルが見つかりません: {file_id}")
    if errors: raise HTTPException(status_code=500, detail={"message": "一部削除失敗。", "errors": errors})
    return {"message": f"{deleted_count}件のRAG履歴を削除しました。", "deleted_count": deleted_count}
--- FILE: ./backend/rag_history/6284da68-285c-4cf2-b36e-984266ba9324.json ---
{
    "id": "6284da68-285c-4cf2-b36e-984266ba9324",
    "createdAt": "2025-08-17T12:56:57.134874+00:00",
    "qa_filename": "質問・正解(f).csv",
    "context_filename": "文脈(f).csv",
    "models_tested": [
        "gpt-4o-mini"
    ],
    "advanced_options": {
        "chunking": false,
        "hybridSearch": false,
        "promptTuning": false
    },
    "num_questions": 1,
    "results": [
        {
            "results_by_question": [
                {
                    "question": "f.ドイツのサステナビリティ保証制度の実務訓練は何か月か？",
                    "ground_truth": "少なくとも8か月の実務訓練",
                    "generated_answer": "文脈情報には、ドイツのサステナビリティ保証制度の実務訓練に関する情報が含まれていないため、具体的な期間についてはお答えできません。",
                    "retrieved_contexts": [
                        "2024年４月17日決定\nマネロン・テロ資金供与・拡散金融対策政策会議\nマネロン・テロ資金供与・拡散金融対策に関する行動計画（2024-2026 年度）\nIO.1 マネロン・テロ資金供与・拡散金融に係るリスクの認識・協調\n項目 行動内容 期限 担当府省庁等\n(1) ｢政策会議｣の体制 マネロンによる不正な資金の流れの複雑化・多様化に的確に対応するため、 令和６年度末 警察庁、財務省、金融庁、\n強化 マネロン・テロ資金供与・拡散金融対策政策会議（以下、「政策会議」）の 法務省、外務省、その他\n参加省庁拡大等により、｢政策会議｣の体制を強化する。 関係省庁\n(2) 「基本方針」等の進 マネロン・テロ資金供与・拡散金融対策の推進に関する基本方針（2022年 継続実施 同上\n捗管理及び更新 5 月 19 日決定・公表）（以下、「基本方針」）及び本行動計画の進捗状況を\n「政策会議」でフォローアップし、必要に応じ「基本方針」を更新する。\n我が国のマネロン・テロ資金供与・拡散金融対策(以下、｢マネロン等対策｣) 令和６年度末 同上\nの強化の進捗状況を的確に把握するため、FATF基準も踏まえ、適切な統計\nデータ等を特定し、継続的に把握する。\n関係省庁及び業界団体が緊密に連携し、マネロン等対策の強化に向けて取 令和８年度末 同上\nり組むため、次期「基本方針」等の検討において、民間有識者及び関係業\n界団体等の意見を聴取し、聴取した意見を反映させる。\n(3) 国内外情勢の変化 国内外の情勢変化等を踏まえタイムリーにリスク評価を見直すこととし、 継続実施 同上\n等を踏まえたタイ 犯罪収益移転危険度調査書については毎年、拡散金融リスク評価書につい\nムリーなリスク評 ては定期的に更新する。\n価の更新等 犯罪収益移転危険度調査書及び拡散金融リスク評価書等を踏まえ、定期的 継続実施 同上\nな意見交換等の場を設け、関係省庁間でリスク認識の向上につなげる。\nIO.２ 国際協力\n項目 行動内容 期限 担当府省庁等\n(1) 国際機関等との連 FATF、APG の活動支援等を通じ、国際的なマネロン等対策に貢献すると 継続実施 警察庁、財務省、外務省\n携強化 ともに、インターポール、エグモント・グループ等の国際機関等との連携\n1\n強化に取り組む。\n(2) 効果的かつ時機を 国際業務に従事する検察庁及び警察職員に対して、捜査共助・逃亡犯罪人 継続実施 法務省、警察庁\n得た捜査共助・逃亡 引渡に関するトレーニングを実施し、これら手続に対する理解を深め、積\n犯罪人引渡の実施 極的な活用につなげる。\n(3) 外国のカウンター JAFIC と外国 FIU の情報交換がより広範かつ効果的なものとなるよう、 継続実施 警察庁、外務省\nパートとの(2)以外 FIU 間の情報交換枠組みの一層の充実を図るとともに、活発な情報交換を\nの情報交換の促進 実施する。\n外国当局から要請された口座凍結に対し、適切な対応を推進する。 継続実施 同上\n監督当局等による他国のカウンターパートとのマネロン・テロ資金供与等 継続実施 金融庁、その他特定事業\nに関する情報交換を継続するとともに、必要に応じて更に発展させる。 者監督官庁\nIO.３ マネロン・テロ資金供与対策に係る金融機関・暗号資産交換業者（VASPs）の監督・予防措置\n項目 行動内容 期限 担当府省庁等\n(1) 金融機関等による マネロン・テロ資金供与対策に係る重要性等の周知徹底により、金融機関・ 継続実施 金融庁、その他金融機関\nリスクベースアプ 暗号資産交換業者（以下、「金融機関等」）のリスク理解を更に向上させ、 監督省庁\nローチに基づく取 リスク評価に基づくリスクベースの実効性ある取組を促す。また、必要に\n組の促進等 応じて、マネロン・テロ資金供与対策に関する検査監督ガイドラインを更\n新する。\n政府広報も活用して、官民が連携して国民の理解を促進しつつ、金融機関 継続実施 同上\n等による継続的な顧客情報管理に基づく顧客のリスク評価の取組を推進す\nる。\n(2) 監督当局による金 マネロン・テロ資金供与対策に関するノウハウの共有や共同研修の実施な 継続実施 同上\n融機関等に対する どの監督当局間連携の取組を推進するとともに、リスクベースアプローチ\nリスクベースアプ に基づくメリハリのある検査監督の取組を実践する。ブロックチェーンや\nローチに基づく検 暗号資産等を活用した技術による新たな金融商品・サービスを提供する金\n査監督の実践等 融機関等において、必要なリスク低減措置等が実施されるよう取り組む。\n2\nまた、金融機関等の取組を改善させるため、効果的かつ抑止力のある措置 継続実施 同上\nを実施する。\n(3) 取引モニタリング 為替取引分析業者の検査監督等を通じて、共同システムの安定運営を確保 継続実施 同上\n共同システムの充 しつつ、金融機関等による取引モニタリング等を強化する。\n実・効率化、金融機\n関等の取引モニタ\nリング等の強化\nIO.４ マネロン・テロ資金供与対策に係る特定非金融業者及び職業専門家（DNFBPs）の監督・予防措置\n項目 行動内容 期限 担当府省庁等\n(1) DNFBPs のリスク マネロン・テロ資金供与対策に関するガイドライン等の周知徹底により、 令和８年度末 DNFBPs監督官庁、警察\n理解向上とリスク DNFBPsのリスク理解を向上させ、適切なリスクベースアプローチに基づ 庁、財務省\nベースアプローチ く取組を促す。その上で、必要に応じて、ガイドラインの更新やガイドラ\nに基づく取組の促 インに関するよくある質問（FAQ）の策定を行う。\n進等 また、マネロン・テロ資金供与対策に関するガイドラインの実施期限を明\n確化する。\n取引モニタリングを強化するとともに、政府広報も活用して国民の理解を 令和８年度末 警察庁、財務省、DNFBPs\n促進しつつ、DNFBPsによる取引時確認及び継続的顧客管理の実効性を確 監督官庁\n保する。\n(2) 監 督 当 局 に よ る ｢政策会議｣等において、モニタリング手法や参考事例、ベストプラクティ 令和６年度末 同上\nDNFBPs に対する スを共有することにより、監督当局によるマネロン・テロ資金供与対策に\nリスクベースアプ 係るリスクベースでの検査監督を強化する。\nローチに基づく検 各業界団体と政府当局との定期協議の場を設けるとともに、関係省庁間で 令和６年度末 同上\n査監督の強化 連携して地方公共団体を含む担当者の能力向上のための研修プログラムを\n作成し、実施する。\n監督当局によるリスクベースでの検査監督を実施するため、モニタリング 令和７年度末 DNFBPs監督官庁、警察\n3\n方針を策定する。 庁、財務省\n(3) 疑わしい取引の届 疑わしい取引の届出の実効性を高めるため、必要に応じて、疑わしい取引 令和８年度末 警察庁、財務省、DNFBPs\n出の推進強化及び の参考事例を作成・更新するとともに、疑わしい取引参考事例の共有やア 監督官庁\n向上 ウトリーチの実施等によりDNFBPsの理解を深めることにより、疑わしい\n取引の届出の推進強化及び質・件数の向上につなげる。\nIO.５ 法人等の悪用防止\n項目 行動内容 期限 担当府省庁等\n(1) 法人の実質的支配 法人の実質的支配者情報に関する制度整備に向けた検討を推進しながら、 令和８年度末 法務省、財務省、警察庁、\n者情報に関する制 株式会社が自らの実質的支配者情報を特定するため、株主である他の株式 金融庁、経済産業省、そ\n度の改善と実効性 会社の実質的支配者リストを活用する方策を検討し、所要の措置を講じる。 の他特定事業者監督省\n向上 併せて、株式会社をはじめとする法人が自身の実質的支配者情報を把握す 庁、その他法人設立根拠\nることの重要性を周知する。 法所管省庁\n実質的支配者リスト制度の実効性を高めるため、引き続きその積極的な活\n用を政府として推進するとともに、金融機関等による直接の確認等の検討\nを含む制度の利便性向上や商業登記制度との連携による実質的支配者リス\nト制度の活用場面の確保にも取り組み、所要の措置を講じる。\n(2) 法人の実質的支配 特定事業者が保持する実質的支配者情報を十分、正確、最新な状態に保つ 令和８年度末 金融庁、警察庁、財務省、\n者情報への当局に ための措置を行うとともに、当局による当該情報への効率的なアクセスを 法務省、その他特定事業\nよるアクセス強化 確保する仕組みを検討し、導入する。 者監督省庁\n公証人が定款認証を通じて保有する実質的支配者情報への当局による照会\nについての対応を一層迅速化する。\n(3) 法人・信託に関する 外国で設立された法人や民事・外国信託について、日本においてマネロン 令和７年度末 警察庁、財務省、金融庁、\nリスク評価 等に悪用されるリスクの評価を行い、必要なリスク低減措置を検討する。 法務省\nIO.６ 特定金融情報の活用\n項目 行動内容 期限 担当府省庁等\n4\n(1) 疑わしい取引の届 JAFICの疑わしい取引の届出の分析にICT／AI技術を積極的に活用するこ 継続実施 警察庁\n出の分析の高度化 とにより、分析の実効性・効率性の向上につなげる。\n(2) 関係機関の連携強 JAFICからの情報提供の充実や、定期的な意見交換等の場を設け、関係機 継続実施 警察庁、特定事業者監督\n化 関との連携を強化する。 官庁\nIO.７ マネロンの捜査・訴追・制裁\n項目 行動内容 期限 担当府省庁等\n(1) リスクに応じたマ 高リスクと特定された前提犯罪について、とりわけ重大複雑な事案（外国 継続実施 法務省、警察庁\nネロン事案の捜査・ において前提犯罪が行われた場合を含む）に係るマネロンの捜査・訴追を\n訴追 推進するため、リスクの理解向上に努めるとともに、各種通達や研修のほ\nか、タスクフォースの枠組みに基づいて、関係省庁が連携して捜査・訴追\nに取り組む。\nマネロン罪の捜査や訴追における電子化の推進について検討し、所要の措 継続実施 同上\n置を講じる。\n(2) 効果的で均衡のと 各種通達や研修等に基づいて、マネロン罪について適切な量刑を確保する 継続実施 法務省\nれた抑止力のある べく取り組む。\n量刑の確保\nIO.８ 犯罪収益の没収\n項目 行動内容 期限 担当府省庁等\n(1) 捜査・没収の執行 犯罪収益や、マネロンに関連する犯罪供用物の押収・没収・追徴を適切に 継続実施 法務省、警察庁\n実施するため、リスクが高い分野に関する犯罪収益追跡捜査、保全措置及\nび没収・追徴を執行する。\nマネロン等に関連する現金等の国境での差し止め、現金等の輸出入情報の 継続実施 財務省、警察庁\n警察庁への共有及び官民連携した取締り等を引き続き行うとともに、カレ\nンシードッグの導入を始めとした新たな取締手法等、国境での取締り体制\n5\nの強化に取り組む。\n(2) 適切な口座凍結検 預貯金口座や暗号資産取引口座に関して、迅速かつ確実な凍結検討依頼を 継続実施 警察庁、金融庁\n討依頼の実施 行う。\n(3) 財産回復に係る勧 財産回復に係る勧告 4 及び勧告 38 の改訂並びにそれを受けたメソドロジ 令和8年度末 法務省、警察庁、財務省、\n告4及び38の改訂 ーの改訂を踏まえ、政府内で諸外国の制度調査等を行うとともに、国内に 金融庁\n対応 おける対応を協議のうえ、必要に応じ措置を講じる。\nIO.９ テロ資金の捜査・訴追・制裁\n項目 行動内容 期限 担当府省庁等\n(1) テロ資金等提供罪 テロ資金等提供罪の捜査や訴追における電子化の推進について検討し、所 継続実施 法務省、警察庁\nの捜査・訴追 要の措置を講じる。\n重大複雑なテロ資金供与の更なる捜査・訴追のため、タスクフォースの枠 継続実施 法務省、警察庁、その他\n組みや各種通達に基づいて、関係省庁が連携し、態勢整備も含め捜査・訴 関係省庁\n追の執行を強化する。また、必要に応じて、国内外のテロ資金供与の状況\n変化も踏まえた新たな取組を検討する。\nIO.10 テロ資金の凍結・NPOの悪用防止\n項目 行動内容 期限 担当府省庁等\n(1) 関係機関の連携強 遅滞なき資産凍結等の実施強化のため、迅速な制裁対象者情報の通知やベ 令和７年度末 外務省、財務省、経済産\n化 ストプラクティスの共有など、関係省庁及び特定事業者（金融機関等及び 業省、警察庁、特定事業\nDNFBPs）との連携の枠組みを強化する。 者監督官庁\n(2) テロ資金の凍結に 外為法及び国際テロリスト等財産凍結法で対応すべき事項及びその具体的 令和７年度末 特定事業者監督官庁、財\n係る事業者の理解 な対応方法を特定事業者に対し周知することで、リスク理解の向上につな 務省、警察庁\nの向上 げる。\n(3) 外国為替取引等取 外国為替取引等取扱業者によるテロ資金供与対策の態勢整備状況及びリス 令和７年度末 財務省\n扱業者に対するテ クに応じた対応状況について、経済制裁の迂回・潜脱等の検知を含め、リ\nロ資金の凍結に係 スクベースでの検査監督を強化する。\n6\nる検査監督の強化\n(4) NPOの悪用防止 NPOがテロ資金供与目的で悪用されることを防ぐため、ターゲットを絞っ 継続実施 内閣府、文科省、厚労省、\nたアウトリーチやモニタリングを継続する。 外務省、警察庁、財務省\nNPO に係る勧告 8 改訂及びそれを受けたメソドロジーの改訂を踏まえ、 令和７年度末 同上\n必要な対応を政府内で協議・実施する。\nIO.11 大量破壊兵器の拡散金融対策\n項目 行動内容 期限 担当府省庁等\n(1) 関係機関の連携強 遅滞なき資産凍結等の実施強化のため、迅速な制裁対象者情報の通知やベ 令和７年度末 外務省、財務省、経産省、\n化 ストプラクティスの共有など、関係省庁及び特定事業者との連携の枠組み 警察庁、特定事業者監督\nを強化する。 官庁\n(2) 拡散金融に係る事 外為法及び国際テロリスト等財産凍結法で対応すべき事項及びその具体的 令和７年度末 特定事業者監督官庁、財\n業者の理解の向上 な対応方法を特定事業者に対し周知することで、リスク理解の向上につな 務省、警察庁\nげる。\n(3) 外国為替取引等取 外国為替取引等取扱業者による拡散金融対策の態勢整備状況及びリスクに 令和７年度末 財務省\n扱業者に対する拡 応じた対応状況について、経済制裁の迂回・潜脱等の検知を含め、リスク\n散金融に係る検査 ベースでの検査監督を強化する。\n監督の強化\n7",
                        "000万円以上」では全生保が4.7件、民保が4.0件となっている。（図表Ⅰ－21）",
                        "000万円以上」では、全生保が3"
                    ],
                    "faithfulness_score": 1.0,
                    "relevancy_score": 0.0
                }
            ],
            "final_scores": {
                "average_faithfulness": 1.0,
                "average_answer_relevancy": 0.0
            },
            "token_usage": {
                "input_tokens": 10900,
                "output_tokens": 69
            },
            "total_cost": 0.243078,
            "model_name": "gpt-4o-mini"
        }
    ]
}
--- FILE: ./backend/rag_history/6aa0325c-ece5-48ee-a2b8-47851da778d6.json ---
{
    "id": "6aa0325c-ece5-48ee-a2b8-47851da778d6",
    "createdAt": "2025-08-17T12:56:04.117897+00:00",
    "qa_filename": "質問・正解(f).csv",
    "context_filename": "文脈(f).csv",
    "models_tested": [
        "gpt-4o-mini"
    ],
    "advanced_options": {
        "chunking": false,
        "hybridSearch": false,
        "promptTuning": false
    },
    "num_questions": 1,
    "results": [
        {
            "results_by_question": [
                {
                    "question": "f.ドイツのサステナビリティ保証制度の実務訓練は何か月か？",
                    "ground_truth": "少なくとも8か月の実務訓練",
                    "generated_answer": "文脈情報には、ドイツのサステナビリティ保証制度の実務訓練に関する情報が含まれていないため、具体的な回答を提供することはできません。",
                    "retrieved_contexts": [
                        "2024年４月17日決定\nマネロン・テロ資金供与・拡散金融対策政策会議\nマネロン・テロ資金供与・拡散金融対策に関する行動計画（2024-2026 年度）\nIO.1 マネロン・テロ資金供与・拡散金融に係るリスクの認識・協調\n項目 行動内容 期限 担当府省庁等\n(1) ｢政策会議｣の体制 マネロンによる不正な資金の流れの複雑化・多様化に的確に対応するため、 令和６年度末 警察庁、財務省、金融庁、\n強化 マネロン・テロ資金供与・拡散金融対策政策会議（以下、「政策会議」）の 法務省、外務省、その他\n参加省庁拡大等により、｢政策会議｣の体制を強化する。 関係省庁\n(2) 「基本方針」等の進 マネロン・テロ資金供与・拡散金融対策の推進に関する基本方針（2022年 継続実施 同上\n捗管理及び更新 5 月 19 日決定・公表）（以下、「基本方針」）及び本行動計画の進捗状況を\n「政策会議」でフォローアップし、必要に応じ「基本方針」を更新する。\n我が国のマネロン・テロ資金供与・拡散金融対策(以下、｢マネロン等対策｣) 令和６年度末 同上\nの強化の進捗状況を的確に把握するため、FATF基準も踏まえ、適切な統計\nデータ等を特定し、継続的に把握する。\n関係省庁及び業界団体が緊密に連携し、マネロン等対策の強化に向けて取 令和８年度末 同上\nり組むため、次期「基本方針」等の検討において、民間有識者及び関係業\n界団体等の意見を聴取し、聴取した意見を反映させる。\n(3) 国内外情勢の変化 国内外の情勢変化等を踏まえタイムリーにリスク評価を見直すこととし、 継続実施 同上\n等を踏まえたタイ 犯罪収益移転危険度調査書については毎年、拡散金融リスク評価書につい\nムリーなリスク評 ては定期的に更新する。\n価の更新等 犯罪収益移転危険度調査書及び拡散金融リスク評価書等を踏まえ、定期的 継続実施 同上\nな意見交換等の場を設け、関係省庁間でリスク認識の向上につなげる。\nIO.２ 国際協力\n項目 行動内容 期限 担当府省庁等\n(1) 国際機関等との連 FATF、APG の活動支援等を通じ、国際的なマネロン等対策に貢献すると 継続実施 警察庁、財務省、外務省\n携強化 ともに、インターポール、エグモント・グループ等の国際機関等との連携\n1\n強化に取り組む。\n(2) 効果的かつ時機を 国際業務に従事する検察庁及び警察職員に対して、捜査共助・逃亡犯罪人 継続実施 法務省、警察庁\n得た捜査共助・逃亡 引渡に関するトレーニングを実施し、これら手続に対する理解を深め、積\n犯罪人引渡の実施 極的な活用につなげる。\n(3) 外国のカウンター JAFIC と外国 FIU の情報交換がより広範かつ効果的なものとなるよう、 継続実施 警察庁、外務省\nパートとの(2)以外 FIU 間の情報交換枠組みの一層の充実を図るとともに、活発な情報交換を\nの情報交換の促進 実施する。\n外国当局から要請された口座凍結に対し、適切な対応を推進する。 継続実施 同上\n監督当局等による他国のカウンターパートとのマネロン・テロ資金供与等 継続実施 金融庁、その他特定事業\nに関する情報交換を継続するとともに、必要に応じて更に発展させる。 者監督官庁\nIO.３ マネロン・テロ資金供与対策に係る金融機関・暗号資産交換業者（VASPs）の監督・予防措置\n項目 行動内容 期限 担当府省庁等\n(1) 金融機関等による マネロン・テロ資金供与対策に係る重要性等の周知徹底により、金融機関・ 継続実施 金融庁、その他金融機関\nリスクベースアプ 暗号資産交換業者（以下、「金融機関等」）のリスク理解を更に向上させ、 監督省庁\nローチに基づく取 リスク評価に基づくリスクベースの実効性ある取組を促す。また、必要に\n組の促進等 応じて、マネロン・テロ資金供与対策に関する検査監督ガイドラインを更\n新する。\n政府広報も活用して、官民が連携して国民の理解を促進しつつ、金融機関 継続実施 同上\n等による継続的な顧客情報管理に基づく顧客のリスク評価の取組を推進す\nる。\n(2) 監督当局による金 マネロン・テロ資金供与対策に関するノウハウの共有や共同研修の実施な 継続実施 同上\n融機関等に対する どの監督当局間連携の取組を推進するとともに、リスクベースアプローチ\nリスクベースアプ に基づくメリハリのある検査監督の取組を実践する。ブロックチェーンや\nローチに基づく検 暗号資産等を活用した技術による新たな金融商品・サービスを提供する金\n査監督の実践等 融機関等において、必要なリスク低減措置等が実施されるよう取り組む。\n2\nまた、金融機関等の取組を改善させるため、効果的かつ抑止力のある措置 継続実施 同上\nを実施する。\n(3) 取引モニタリング 為替取引分析業者の検査監督等を通じて、共同システムの安定運営を確保 継続実施 同上\n共同システムの充 しつつ、金融機関等による取引モニタリング等を強化する。\n実・効率化、金融機\n関等の取引モニタ\nリング等の強化\nIO.４ マネロン・テロ資金供与対策に係る特定非金融業者及び職業専門家（DNFBPs）の監督・予防措置\n項目 行動内容 期限 担当府省庁等\n(1) DNFBPs のリスク マネロン・テロ資金供与対策に関するガイドライン等の周知徹底により、 令和８年度末 DNFBPs監督官庁、警察\n理解向上とリスク DNFBPsのリスク理解を向上させ、適切なリスクベースアプローチに基づ 庁、財務省\nベースアプローチ く取組を促す。その上で、必要に応じて、ガイドラインの更新やガイドラ\nに基づく取組の促 インに関するよくある質問（FAQ）の策定を行う。\n進等 また、マネロン・テロ資金供与対策に関するガイドラインの実施期限を明\n確化する。\n取引モニタリングを強化するとともに、政府広報も活用して国民の理解を 令和８年度末 警察庁、財務省、DNFBPs\n促進しつつ、DNFBPsによる取引時確認及び継続的顧客管理の実効性を確 監督官庁\n保する。\n(2) 監 督 当 局 に よ る ｢政策会議｣等において、モニタリング手法や参考事例、ベストプラクティ 令和６年度末 同上\nDNFBPs に対する スを共有することにより、監督当局によるマネロン・テロ資金供与対策に\nリスクベースアプ 係るリスクベースでの検査監督を強化する。\nローチに基づく検 各業界団体と政府当局との定期協議の場を設けるとともに、関係省庁間で 令和６年度末 同上\n査監督の強化 連携して地方公共団体を含む担当者の能力向上のための研修プログラムを\n作成し、実施する。\n監督当局によるリスクベースでの検査監督を実施するため、モニタリング 令和７年度末 DNFBPs監督官庁、警察\n3\n方針を策定する。 庁、財務省\n(3) 疑わしい取引の届 疑わしい取引の届出の実効性を高めるため、必要に応じて、疑わしい取引 令和８年度末 警察庁、財務省、DNFBPs\n出の推進強化及び の参考事例を作成・更新するとともに、疑わしい取引参考事例の共有やア 監督官庁\n向上 ウトリーチの実施等によりDNFBPsの理解を深めることにより、疑わしい\n取引の届出の推進強化及び質・件数の向上につなげる。\nIO.５ 法人等の悪用防止\n項目 行動内容 期限 担当府省庁等\n(1) 法人の実質的支配 法人の実質的支配者情報に関する制度整備に向けた検討を推進しながら、 令和８年度末 法務省、財務省、警察庁、\n者情報に関する制 株式会社が自らの実質的支配者情報を特定するため、株主である他の株式 金融庁、経済産業省、そ\n度の改善と実効性 会社の実質的支配者リストを活用する方策を検討し、所要の措置を講じる。 の他特定事業者監督省\n向上 併せて、株式会社をはじめとする法人が自身の実質的支配者情報を把握す 庁、その他法人設立根拠\nることの重要性を周知する。 法所管省庁\n実質的支配者リスト制度の実効性を高めるため、引き続きその積極的な活\n用を政府として推進するとともに、金融機関等による直接の確認等の検討\nを含む制度の利便性向上や商業登記制度との連携による実質的支配者リス\nト制度の活用場面の確保にも取り組み、所要の措置を講じる。\n(2) 法人の実質的支配 特定事業者が保持する実質的支配者情報を十分、正確、最新な状態に保つ 令和８年度末 金融庁、警察庁、財務省、\n者情報への当局に ための措置を行うとともに、当局による当該情報への効率的なアクセスを 法務省、その他特定事業\nよるアクセス強化 確保する仕組みを検討し、導入する。 者監督省庁\n公証人が定款認証を通じて保有する実質的支配者情報への当局による照会\nについての対応を一層迅速化する。\n(3) 法人・信託に関する 外国で設立された法人や民事・外国信託について、日本においてマネロン 令和７年度末 警察庁、財務省、金融庁、\nリスク評価 等に悪用されるリスクの評価を行い、必要なリスク低減措置を検討する。 法務省\nIO.６ 特定金融情報の活用\n項目 行動内容 期限 担当府省庁等\n4\n(1) 疑わしい取引の届 JAFICの疑わしい取引の届出の分析にICT／AI技術を積極的に活用するこ 継続実施 警察庁\n出の分析の高度化 とにより、分析の実効性・効率性の向上につなげる。\n(2) 関係機関の連携強 JAFICからの情報提供の充実や、定期的な意見交換等の場を設け、関係機 継続実施 警察庁、特定事業者監督\n化 関との連携を強化する。 官庁\nIO.７ マネロンの捜査・訴追・制裁\n項目 行動内容 期限 担当府省庁等\n(1) リスクに応じたマ 高リスクと特定された前提犯罪について、とりわけ重大複雑な事案（外国 継続実施 法務省、警察庁\nネロン事案の捜査・ において前提犯罪が行われた場合を含む）に係るマネロンの捜査・訴追を\n訴追 推進するため、リスクの理解向上に努めるとともに、各種通達や研修のほ\nか、タスクフォースの枠組みに基づいて、関係省庁が連携して捜査・訴追\nに取り組む。\nマネロン罪の捜査や訴追における電子化の推進について検討し、所要の措 継続実施 同上\n置を講じる。\n(2) 効果的で均衡のと 各種通達や研修等に基づいて、マネロン罪について適切な量刑を確保する 継続実施 法務省\nれた抑止力のある べく取り組む。\n量刑の確保\nIO.８ 犯罪収益の没収\n項目 行動内容 期限 担当府省庁等\n(1) 捜査・没収の執行 犯罪収益や、マネロンに関連する犯罪供用物の押収・没収・追徴を適切に 継続実施 法務省、警察庁\n実施するため、リスクが高い分野に関する犯罪収益追跡捜査、保全措置及\nび没収・追徴を執行する。\nマネロン等に関連する現金等の国境での差し止め、現金等の輸出入情報の 継続実施 財務省、警察庁\n警察庁への共有及び官民連携した取締り等を引き続き行うとともに、カレ\nンシードッグの導入を始めとした新たな取締手法等、国境での取締り体制\n5\nの強化に取り組む。\n(2) 適切な口座凍結検 預貯金口座や暗号資産取引口座に関して、迅速かつ確実な凍結検討依頼を 継続実施 警察庁、金融庁\n討依頼の実施 行う。\n(3) 財産回復に係る勧 財産回復に係る勧告 4 及び勧告 38 の改訂並びにそれを受けたメソドロジ 令和8年度末 法務省、警察庁、財務省、\n告4及び38の改訂 ーの改訂を踏まえ、政府内で諸外国の制度調査等を行うとともに、国内に 金融庁\n対応 おける対応を協議のうえ、必要に応じ措置を講じる。\nIO.９ テロ資金の捜査・訴追・制裁\n項目 行動内容 期限 担当府省庁等\n(1) テロ資金等提供罪 テロ資金等提供罪の捜査や訴追における電子化の推進について検討し、所 継続実施 法務省、警察庁\nの捜査・訴追 要の措置を講じる。\n重大複雑なテロ資金供与の更なる捜査・訴追のため、タスクフォースの枠 継続実施 法務省、警察庁、その他\n組みや各種通達に基づいて、関係省庁が連携し、態勢整備も含め捜査・訴 関係省庁\n追の執行を強化する。また、必要に応じて、国内外のテロ資金供与の状況\n変化も踏まえた新たな取組を検討する。\nIO.10 テロ資金の凍結・NPOの悪用防止\n項目 行動内容 期限 担当府省庁等\n(1) 関係機関の連携強 遅滞なき資産凍結等の実施強化のため、迅速な制裁対象者情報の通知やベ 令和７年度末 外務省、財務省、経済産\n化 ストプラクティスの共有など、関係省庁及び特定事業者（金融機関等及び 業省、警察庁、特定事業\nDNFBPs）との連携の枠組みを強化する。 者監督官庁\n(2) テロ資金の凍結に 外為法及び国際テロリスト等財産凍結法で対応すべき事項及びその具体的 令和７年度末 特定事業者監督官庁、財\n係る事業者の理解 な対応方法を特定事業者に対し周知することで、リスク理解の向上につな 務省、警察庁\nの向上 げる。\n(3) 外国為替取引等取 外国為替取引等取扱業者によるテロ資金供与対策の態勢整備状況及びリス 令和７年度末 財務省\n扱業者に対するテ クに応じた対応状況について、経済制裁の迂回・潜脱等の検知を含め、リ\nロ資金の凍結に係 スクベースでの検査監督を強化する。\n6\nる検査監督の強化\n(4) NPOの悪用防止 NPOがテロ資金供与目的で悪用されることを防ぐため、ターゲットを絞っ 継続実施 内閣府、文科省、厚労省、\nたアウトリーチやモニタリングを継続する。 外務省、警察庁、財務省\nNPO に係る勧告 8 改訂及びそれを受けたメソドロジーの改訂を踏まえ、 令和７年度末 同上\n必要な対応を政府内で協議・実施する。\nIO.11 大量破壊兵器の拡散金融対策\n項目 行動内容 期限 担当府省庁等\n(1) 関係機関の連携強 遅滞なき資産凍結等の実施強化のため、迅速な制裁対象者情報の通知やベ 令和７年度末 外務省、財務省、経産省、\n化 ストプラクティスの共有など、関係省庁及び特定事業者との連携の枠組み 警察庁、特定事業者監督\nを強化する。 官庁\n(2) 拡散金融に係る事 外為法及び国際テロリスト等財産凍結法で対応すべき事項及びその具体的 令和７年度末 特定事業者監督官庁、財\n業者の理解の向上 な対応方法を特定事業者に対し周知することで、リスク理解の向上につな 務省、警察庁\nげる。\n(3) 外国為替取引等取 外国為替取引等取扱業者による拡散金融対策の態勢整備状況及びリスクに 令和７年度末 財務省\n扱業者に対する拡 応じた対応状況について、経済制裁の迂回・潜脱等の検知を含め、リスク\n散金融に係る検査 ベースでの検査監督を強化する。\n監督の強化\n7",
                        "000万円以上」では全生保が4.7件、民保が4.0件となっている。（図表Ⅰ－21）",
                        "000万円以上」では、全生保が3"
                    ],
                    "faithfulness_score": 1.0,
                    "relevancy_score": 0.0
                }
            ],
            "final_scores": {
                "average_faithfulness": 1.0,
                "average_answer_relevancy": 0.0
            },
            "token_usage": {
                "input_tokens": 10900,
                "output_tokens": 69
            },
            "total_cost": 0.243078,
            "model_name": "gpt-4o-mini"
        }
    ]
}
--- FILE: ./backend/rag_history/5f5ce4b2-a919-4166-b6e4-dd9040aff644.json ---
{
    "id": "5f5ce4b2-a919-4166-b6e4-dd9040aff644",
    "createdAt": "2025-08-17T12:56:31.413183+00:00",
    "qa_filename": "質問・正解(f).csv",
    "context_filename": "文脈(f).csv",
    "models_tested": [
        "gemini-1.5-flash-latest"
    ],
    "advanced_options": {
        "chunking": false,
        "hybridSearch": false,
        "promptTuning": false
    },
    "num_questions": 1,
    "results": [
        {
            "results_by_question": [
                {
                    "question": "f.ドイツのサステナビリティ保証制度の実務訓練は何か月か？",
                    "ground_truth": "少なくとも8か月の実務訓練",
                    "generated_answer": "この文章には、ドイツのサステナビリティ保証制度に関する情報は含まれていません。そのため、質問にお答えすることはできません。",
                    "retrieved_contexts": [
                        "2024年４月17日決定\nマネロン・テロ資金供与・拡散金融対策政策会議\nマネロン・テロ資金供与・拡散金融対策に関する行動計画（2024-2026 年度）\nIO.1 マネロン・テロ資金供与・拡散金融に係るリスクの認識・協調\n項目 行動内容 期限 担当府省庁等\n(1) ｢政策会議｣の体制 マネロンによる不正な資金の流れの複雑化・多様化に的確に対応するため、 令和６年度末 警察庁、財務省、金融庁、\n強化 マネロン・テロ資金供与・拡散金融対策政策会議（以下、「政策会議」）の 法務省、外務省、その他\n参加省庁拡大等により、｢政策会議｣の体制を強化する。 関係省庁\n(2) 「基本方針」等の進 マネロン・テロ資金供与・拡散金融対策の推進に関する基本方針（2022年 継続実施 同上\n捗管理及び更新 5 月 19 日決定・公表）（以下、「基本方針」）及び本行動計画の進捗状況を\n「政策会議」でフォローアップし、必要に応じ「基本方針」を更新する。\n我が国のマネロン・テロ資金供与・拡散金融対策(以下、｢マネロン等対策｣) 令和６年度末 同上\nの強化の進捗状況を的確に把握するため、FATF基準も踏まえ、適切な統計\nデータ等を特定し、継続的に把握する。\n関係省庁及び業界団体が緊密に連携し、マネロン等対策の強化に向けて取 令和８年度末 同上\nり組むため、次期「基本方針」等の検討において、民間有識者及び関係業\n界団体等の意見を聴取し、聴取した意見を反映させる。\n(3) 国内外情勢の変化 国内外の情勢変化等を踏まえタイムリーにリスク評価を見直すこととし、 継続実施 同上\n等を踏まえたタイ 犯罪収益移転危険度調査書については毎年、拡散金融リスク評価書につい\nムリーなリスク評 ては定期的に更新する。\n価の更新等 犯罪収益移転危険度調査書及び拡散金融リスク評価書等を踏まえ、定期的 継続実施 同上\nな意見交換等の場を設け、関係省庁間でリスク認識の向上につなげる。\nIO.２ 国際協力\n項目 行動内容 期限 担当府省庁等\n(1) 国際機関等との連 FATF、APG の活動支援等を通じ、国際的なマネロン等対策に貢献すると 継続実施 警察庁、財務省、外務省\n携強化 ともに、インターポール、エグモント・グループ等の国際機関等との連携\n1\n強化に取り組む。\n(2) 効果的かつ時機を 国際業務に従事する検察庁及び警察職員に対して、捜査共助・逃亡犯罪人 継続実施 法務省、警察庁\n得た捜査共助・逃亡 引渡に関するトレーニングを実施し、これら手続に対する理解を深め、積\n犯罪人引渡の実施 極的な活用につなげる。\n(3) 外国のカウンター JAFIC と外国 FIU の情報交換がより広範かつ効果的なものとなるよう、 継続実施 警察庁、外務省\nパートとの(2)以外 FIU 間の情報交換枠組みの一層の充実を図るとともに、活発な情報交換を\nの情報交換の促進 実施する。\n外国当局から要請された口座凍結に対し、適切な対応を推進する。 継続実施 同上\n監督当局等による他国のカウンターパートとのマネロン・テロ資金供与等 継続実施 金融庁、その他特定事業\nに関する情報交換を継続するとともに、必要に応じて更に発展させる。 者監督官庁\nIO.３ マネロン・テロ資金供与対策に係る金融機関・暗号資産交換業者（VASPs）の監督・予防措置\n項目 行動内容 期限 担当府省庁等\n(1) 金融機関等による マネロン・テロ資金供与対策に係る重要性等の周知徹底により、金融機関・ 継続実施 金融庁、その他金融機関\nリスクベースアプ 暗号資産交換業者（以下、「金融機関等」）のリスク理解を更に向上させ、 監督省庁\nローチに基づく取 リスク評価に基づくリスクベースの実効性ある取組を促す。また、必要に\n組の促進等 応じて、マネロン・テロ資金供与対策に関する検査監督ガイドラインを更\n新する。\n政府広報も活用して、官民が連携して国民の理解を促進しつつ、金融機関 継続実施 同上\n等による継続的な顧客情報管理に基づく顧客のリスク評価の取組を推進す\nる。\n(2) 監督当局による金 マネロン・テロ資金供与対策に関するノウハウの共有や共同研修の実施な 継続実施 同上\n融機関等に対する どの監督当局間連携の取組を推進するとともに、リスクベースアプローチ\nリスクベースアプ に基づくメリハリのある検査監督の取組を実践する。ブロックチェーンや\nローチに基づく検 暗号資産等を活用した技術による新たな金融商品・サービスを提供する金\n査監督の実践等 融機関等において、必要なリスク低減措置等が実施されるよう取り組む。\n2\nまた、金融機関等の取組を改善させるため、効果的かつ抑止力のある措置 継続実施 同上\nを実施する。\n(3) 取引モニタリング 為替取引分析業者の検査監督等を通じて、共同システムの安定運営を確保 継続実施 同上\n共同システムの充 しつつ、金融機関等による取引モニタリング等を強化する。\n実・効率化、金融機\n関等の取引モニタ\nリング等の強化\nIO.４ マネロン・テロ資金供与対策に係る特定非金融業者及び職業専門家（DNFBPs）の監督・予防措置\n項目 行動内容 期限 担当府省庁等\n(1) DNFBPs のリスク マネロン・テロ資金供与対策に関するガイドライン等の周知徹底により、 令和８年度末 DNFBPs監督官庁、警察\n理解向上とリスク DNFBPsのリスク理解を向上させ、適切なリスクベースアプローチに基づ 庁、財務省\nベースアプローチ く取組を促す。その上で、必要に応じて、ガイドラインの更新やガイドラ\nに基づく取組の促 インに関するよくある質問（FAQ）の策定を行う。\n進等 また、マネロン・テロ資金供与対策に関するガイドラインの実施期限を明\n確化する。\n取引モニタリングを強化するとともに、政府広報も活用して国民の理解を 令和８年度末 警察庁、財務省、DNFBPs\n促進しつつ、DNFBPsによる取引時確認及び継続的顧客管理の実効性を確 監督官庁\n保する。\n(2) 監 督 当 局 に よ る ｢政策会議｣等において、モニタリング手法や参考事例、ベストプラクティ 令和６年度末 同上\nDNFBPs に対する スを共有することにより、監督当局によるマネロン・テロ資金供与対策に\nリスクベースアプ 係るリスクベースでの検査監督を強化する。\nローチに基づく検 各業界団体と政府当局との定期協議の場を設けるとともに、関係省庁間で 令和６年度末 同上\n査監督の強化 連携して地方公共団体を含む担当者の能力向上のための研修プログラムを\n作成し、実施する。\n監督当局によるリスクベースでの検査監督を実施するため、モニタリング 令和７年度末 DNFBPs監督官庁、警察\n3\n方針を策定する。 庁、財務省\n(3) 疑わしい取引の届 疑わしい取引の届出の実効性を高めるため、必要に応じて、疑わしい取引 令和８年度末 警察庁、財務省、DNFBPs\n出の推進強化及び の参考事例を作成・更新するとともに、疑わしい取引参考事例の共有やア 監督官庁\n向上 ウトリーチの実施等によりDNFBPsの理解を深めることにより、疑わしい\n取引の届出の推進強化及び質・件数の向上につなげる。\nIO.５ 法人等の悪用防止\n項目 行動内容 期限 担当府省庁等\n(1) 法人の実質的支配 法人の実質的支配者情報に関する制度整備に向けた検討を推進しながら、 令和８年度末 法務省、財務省、警察庁、\n者情報に関する制 株式会社が自らの実質的支配者情報を特定するため、株主である他の株式 金融庁、経済産業省、そ\n度の改善と実効性 会社の実質的支配者リストを活用する方策を検討し、所要の措置を講じる。 の他特定事業者監督省\n向上 併せて、株式会社をはじめとする法人が自身の実質的支配者情報を把握す 庁、その他法人設立根拠\nることの重要性を周知する。 法所管省庁\n実質的支配者リスト制度の実効性を高めるため、引き続きその積極的な活\n用を政府として推進するとともに、金融機関等による直接の確認等の検討\nを含む制度の利便性向上や商業登記制度との連携による実質的支配者リス\nト制度の活用場面の確保にも取り組み、所要の措置を講じる。\n(2) 法人の実質的支配 特定事業者が保持する実質的支配者情報を十分、正確、最新な状態に保つ 令和８年度末 金融庁、警察庁、財務省、\n者情報への当局に ための措置を行うとともに、当局による当該情報への効率的なアクセスを 法務省、その他特定事業\nよるアクセス強化 確保する仕組みを検討し、導入する。 者監督省庁\n公証人が定款認証を通じて保有する実質的支配者情報への当局による照会\nについての対応を一層迅速化する。\n(3) 法人・信託に関する 外国で設立された法人や民事・外国信託について、日本においてマネロン 令和７年度末 警察庁、財務省、金融庁、\nリスク評価 等に悪用されるリスクの評価を行い、必要なリスク低減措置を検討する。 法務省\nIO.６ 特定金融情報の活用\n項目 行動内容 期限 担当府省庁等\n4\n(1) 疑わしい取引の届 JAFICの疑わしい取引の届出の分析にICT／AI技術を積極的に活用するこ 継続実施 警察庁\n出の分析の高度化 とにより、分析の実効性・効率性の向上につなげる。\n(2) 関係機関の連携強 JAFICからの情報提供の充実や、定期的な意見交換等の場を設け、関係機 継続実施 警察庁、特定事業者監督\n化 関との連携を強化する。 官庁\nIO.７ マネロンの捜査・訴追・制裁\n項目 行動内容 期限 担当府省庁等\n(1) リスクに応じたマ 高リスクと特定された前提犯罪について、とりわけ重大複雑な事案（外国 継続実施 法務省、警察庁\nネロン事案の捜査・ において前提犯罪が行われた場合を含む）に係るマネロンの捜査・訴追を\n訴追 推進するため、リスクの理解向上に努めるとともに、各種通達や研修のほ\nか、タスクフォースの枠組みに基づいて、関係省庁が連携して捜査・訴追\nに取り組む。\nマネロン罪の捜査や訴追における電子化の推進について検討し、所要の措 継続実施 同上\n置を講じる。\n(2) 効果的で均衡のと 各種通達や研修等に基づいて、マネロン罪について適切な量刑を確保する 継続実施 法務省\nれた抑止力のある べく取り組む。\n量刑の確保\nIO.８ 犯罪収益の没収\n項目 行動内容 期限 担当府省庁等\n(1) 捜査・没収の執行 犯罪収益や、マネロンに関連する犯罪供用物の押収・没収・追徴を適切に 継続実施 法務省、警察庁\n実施するため、リスクが高い分野に関する犯罪収益追跡捜査、保全措置及\nび没収・追徴を執行する。\nマネロン等に関連する現金等の国境での差し止め、現金等の輸出入情報の 継続実施 財務省、警察庁\n警察庁への共有及び官民連携した取締り等を引き続き行うとともに、カレ\nンシードッグの導入を始めとした新たな取締手法等、国境での取締り体制\n5\nの強化に取り組む。\n(2) 適切な口座凍結検 預貯金口座や暗号資産取引口座に関して、迅速かつ確実な凍結検討依頼を 継続実施 警察庁、金融庁\n討依頼の実施 行う。\n(3) 財産回復に係る勧 財産回復に係る勧告 4 及び勧告 38 の改訂並びにそれを受けたメソドロジ 令和8年度末 法務省、警察庁、財務省、\n告4及び38の改訂 ーの改訂を踏まえ、政府内で諸外国の制度調査等を行うとともに、国内に 金融庁\n対応 おける対応を協議のうえ、必要に応じ措置を講じる。\nIO.９ テロ資金の捜査・訴追・制裁\n項目 行動内容 期限 担当府省庁等\n(1) テロ資金等提供罪 テロ資金等提供罪の捜査や訴追における電子化の推進について検討し、所 継続実施 法務省、警察庁\nの捜査・訴追 要の措置を講じる。\n重大複雑なテロ資金供与の更なる捜査・訴追のため、タスクフォースの枠 継続実施 法務省、警察庁、その他\n組みや各種通達に基づいて、関係省庁が連携し、態勢整備も含め捜査・訴 関係省庁\n追の執行を強化する。また、必要に応じて、国内外のテロ資金供与の状況\n変化も踏まえた新たな取組を検討する。\nIO.10 テロ資金の凍結・NPOの悪用防止\n項目 行動内容 期限 担当府省庁等\n(1) 関係機関の連携強 遅滞なき資産凍結等の実施強化のため、迅速な制裁対象者情報の通知やベ 令和７年度末 外務省、財務省、経済産\n化 ストプラクティスの共有など、関係省庁及び特定事業者（金融機関等及び 業省、警察庁、特定事業\nDNFBPs）との連携の枠組みを強化する。 者監督官庁\n(2) テロ資金の凍結に 外為法及び国際テロリスト等財産凍結法で対応すべき事項及びその具体的 令和７年度末 特定事業者監督官庁、財\n係る事業者の理解 な対応方法を特定事業者に対し周知することで、リスク理解の向上につな 務省、警察庁\nの向上 げる。\n(3) 外国為替取引等取 外国為替取引等取扱業者によるテロ資金供与対策の態勢整備状況及びリス 令和７年度末 財務省\n扱業者に対するテ クに応じた対応状況について、経済制裁の迂回・潜脱等の検知を含め、リ\nロ資金の凍結に係 スクベースでの検査監督を強化する。\n6\nる検査監督の強化\n(4) NPOの悪用防止 NPOがテロ資金供与目的で悪用されることを防ぐため、ターゲットを絞っ 継続実施 内閣府、文科省、厚労省、\nたアウトリーチやモニタリングを継続する。 外務省、警察庁、財務省\nNPO に係る勧告 8 改訂及びそれを受けたメソドロジーの改訂を踏まえ、 令和７年度末 同上\n必要な対応を政府内で協議・実施する。\nIO.11 大量破壊兵器の拡散金融対策\n項目 行動内容 期限 担当府省庁等\n(1) 関係機関の連携強 遅滞なき資産凍結等の実施強化のため、迅速な制裁対象者情報の通知やベ 令和７年度末 外務省、財務省、経産省、\n化 ストプラクティスの共有など、関係省庁及び特定事業者との連携の枠組み 警察庁、特定事業者監督\nを強化する。 官庁\n(2) 拡散金融に係る事 外為法及び国際テロリスト等財産凍結法で対応すべき事項及びその具体的 令和７年度末 特定事業者監督官庁、財\n業者の理解の向上 な対応方法を特定事業者に対し周知することで、リスク理解の向上につな 務省、警察庁\nげる。\n(3) 外国為替取引等取 外国為替取引等取扱業者による拡散金融対策の態勢整備状況及びリスクに 令和７年度末 財務省\n扱業者に対する拡 応じた対応状況について、経済制裁の迂回・潜脱等の検知を含め、リスク\n散金融に係る検査 ベースでの検査監督を強化する。\n監督の強化\n7",
                        "000万円以上」では全生保が4.7件、民保が4.0件となっている。（図表Ⅰ－21）",
                        "000万円以上」では、全生保が3"
                    ],
                    "faithfulness_score": 1.0,
                    "relevancy_score": 0.0
                }
            ],
            "final_scores": {
                "average_faithfulness": 1.0,
                "average_answer_relevancy": 0.0
            },
            "token_usage": {
                "input_tokens": 5534,
                "output_tokens": 20
            },
            "total_cost": 0.28389549999999997,
            "model_name": "gemini-1.5-flash-latest"
        }
    ]
}
--- FILE: ./backend/rag_history/33875625-4122-4b03-8c88-787eaf8dc916.json ---
{
    "id": "33875625-4122-4b03-8c88-787eaf8dc916",
    "createdAt": "2025-08-17T12:58:54.328969+00:00",
    "qa_filename": "質問・正解(f).csv",
    "context_filename": "文脈(f).csv",
    "models_tested": [
        "gpt-4o-mini"
    ],
    "advanced_options": {
        "chunking": false,
        "hybridSearch": false,
        "promptTuning": false
    },
    "num_questions": 1,
    "results": [
        {
            "results_by_question": [
                {
                    "question": "f.ドイツのサステナビリティ保証制度の実務訓練は何か月か？",
                    "ground_truth": "少なくとも8か月の実務訓練",
                    "generated_answer": "文脈情報には、ドイツのサステナビリティ保証制度の実務訓練に関する情報が含まれていないため、具体的な回答を提供することはできません。",
                    "retrieved_contexts": [
                        "2024年４月17日決定\nマネロン・テロ資金供与・拡散金融対策政策会議\nマネロン・テロ資金供与・拡散金融対策に関する行動計画（2024-2026 年度）\nIO.1 マネロン・テロ資金供与・拡散金融に係るリスクの認識・協調\n項目 行動内容 期限 担当府省庁等\n(1) ｢政策会議｣の体制 マネロンによる不正な資金の流れの複雑化・多様化に的確に対応するため、 令和６年度末 警察庁、財務省、金融庁、\n強化 マネロン・テロ資金供与・拡散金融対策政策会議（以下、「政策会議」）の 法務省、外務省、その他\n参加省庁拡大等により、｢政策会議｣の体制を強化する。 関係省庁\n(2) 「基本方針」等の進 マネロン・テロ資金供与・拡散金融対策の推進に関する基本方針（2022年 継続実施 同上\n捗管理及び更新 5 月 19 日決定・公表）（以下、「基本方針」）及び本行動計画の進捗状況を\n「政策会議」でフォローアップし、必要に応じ「基本方針」を更新する。\n我が国のマネロン・テロ資金供与・拡散金融対策(以下、｢マネロン等対策｣) 令和６年度末 同上\nの強化の進捗状況を的確に把握するため、FATF基準も踏まえ、適切な統計\nデータ等を特定し、継続的に把握する。\n関係省庁及び業界団体が緊密に連携し、マネロン等対策の強化に向けて取 令和８年度末 同上\nり組むため、次期「基本方針」等の検討において、民間有識者及び関係業\n界団体等の意見を聴取し、聴取した意見を反映させる。\n(3) 国内外情勢の変化 国内外の情勢変化等を踏まえタイムリーにリスク評価を見直すこととし、 継続実施 同上\n等を踏まえたタイ 犯罪収益移転危険度調査書については毎年、拡散金融リスク評価書につい\nムリーなリスク評 ては定期的に更新する。\n価の更新等 犯罪収益移転危険度調査書及び拡散金融リスク評価書等を踏まえ、定期的 継続実施 同上\nな意見交換等の場を設け、関係省庁間でリスク認識の向上につなげる。\nIO.２ 国際協力\n項目 行動内容 期限 担当府省庁等\n(1) 国際機関等との連 FATF、APG の活動支援等を通じ、国際的なマネロン等対策に貢献すると 継続実施 警察庁、財務省、外務省\n携強化 ともに、インターポール、エグモント・グループ等の国際機関等との連携\n1\n強化に取り組む。\n(2) 効果的かつ時機を 国際業務に従事する検察庁及び警察職員に対して、捜査共助・逃亡犯罪人 継続実施 法務省、警察庁\n得た捜査共助・逃亡 引渡に関するトレーニングを実施し、これら手続に対する理解を深め、積\n犯罪人引渡の実施 極的な活用につなげる。\n(3) 外国のカウンター JAFIC と外国 FIU の情報交換がより広範かつ効果的なものとなるよう、 継続実施 警察庁、外務省\nパートとの(2)以外 FIU 間の情報交換枠組みの一層の充実を図るとともに、活発な情報交換を\nの情報交換の促進 実施する。\n外国当局から要請された口座凍結に対し、適切な対応を推進する。 継続実施 同上\n監督当局等による他国のカウンターパートとのマネロン・テロ資金供与等 継続実施 金融庁、その他特定事業\nに関する情報交換を継続するとともに、必要に応じて更に発展させる。 者監督官庁\nIO.３ マネロン・テロ資金供与対策に係る金融機関・暗号資産交換業者（VASPs）の監督・予防措置\n項目 行動内容 期限 担当府省庁等\n(1) 金融機関等による マネロン・テロ資金供与対策に係る重要性等の周知徹底により、金融機関・ 継続実施 金融庁、その他金融機関\nリスクベースアプ 暗号資産交換業者（以下、「金融機関等」）のリスク理解を更に向上させ、 監督省庁\nローチに基づく取 リスク評価に基づくリスクベースの実効性ある取組を促す。また、必要に\n組の促進等 応じて、マネロン・テロ資金供与対策に関する検査監督ガイドラインを更\n新する。\n政府広報も活用して、官民が連携して国民の理解を促進しつつ、金融機関 継続実施 同上\n等による継続的な顧客情報管理に基づく顧客のリスク評価の取組を推進す\nる。\n(2) 監督当局による金 マネロン・テロ資金供与対策に関するノウハウの共有や共同研修の実施な 継続実施 同上\n融機関等に対する どの監督当局間連携の取組を推進するとともに、リスクベースアプローチ\nリスクベースアプ に基づくメリハリのある検査監督の取組を実践する。ブロックチェーンや\nローチに基づく検 暗号資産等を活用した技術による新たな金融商品・サービスを提供する金\n査監督の実践等 融機関等において、必要なリスク低減措置等が実施されるよう取り組む。\n2\nまた、金融機関等の取組を改善させるため、効果的かつ抑止力のある措置 継続実施 同上\nを実施する。\n(3) 取引モニタリング 為替取引分析業者の検査監督等を通じて、共同システムの安定運営を確保 継続実施 同上\n共同システムの充 しつつ、金融機関等による取引モニタリング等を強化する。\n実・効率化、金融機\n関等の取引モニタ\nリング等の強化\nIO.４ マネロン・テロ資金供与対策に係る特定非金融業者及び職業専門家（DNFBPs）の監督・予防措置\n項目 行動内容 期限 担当府省庁等\n(1) DNFBPs のリスク マネロン・テロ資金供与対策に関するガイドライン等の周知徹底により、 令和８年度末 DNFBPs監督官庁、警察\n理解向上とリスク DNFBPsのリスク理解を向上させ、適切なリスクベースアプローチに基づ 庁、財務省\nベースアプローチ く取組を促す。その上で、必要に応じて、ガイドラインの更新やガイドラ\nに基づく取組の促 インに関するよくある質問（FAQ）の策定を行う。\n進等 また、マネロン・テロ資金供与対策に関するガイドラインの実施期限を明\n確化する。\n取引モニタリングを強化するとともに、政府広報も活用して国民の理解を 令和８年度末 警察庁、財務省、DNFBPs\n促進しつつ、DNFBPsによる取引時確認及び継続的顧客管理の実効性を確 監督官庁\n保する。\n(2) 監 督 当 局 に よ る ｢政策会議｣等において、モニタリング手法や参考事例、ベストプラクティ 令和６年度末 同上\nDNFBPs に対する スを共有することにより、監督当局によるマネロン・テロ資金供与対策に\nリスクベースアプ 係るリスクベースでの検査監督を強化する。\nローチに基づく検 各業界団体と政府当局との定期協議の場を設けるとともに、関係省庁間で 令和６年度末 同上\n査監督の強化 連携して地方公共団体を含む担当者の能力向上のための研修プログラムを\n作成し、実施する。\n監督当局によるリスクベースでの検査監督を実施するため、モニタリング 令和７年度末 DNFBPs監督官庁、警察\n3\n方針を策定する。 庁、財務省\n(3) 疑わしい取引の届 疑わしい取引の届出の実効性を高めるため、必要に応じて、疑わしい取引 令和８年度末 警察庁、財務省、DNFBPs\n出の推進強化及び の参考事例を作成・更新するとともに、疑わしい取引参考事例の共有やア 監督官庁\n向上 ウトリーチの実施等によりDNFBPsの理解を深めることにより、疑わしい\n取引の届出の推進強化及び質・件数の向上につなげる。\nIO.５ 法人等の悪用防止\n項目 行動内容 期限 担当府省庁等\n(1) 法人の実質的支配 法人の実質的支配者情報に関する制度整備に向けた検討を推進しながら、 令和８年度末 法務省、財務省、警察庁、\n者情報に関する制 株式会社が自らの実質的支配者情報を特定するため、株主である他の株式 金融庁、経済産業省、そ\n度の改善と実効性 会社の実質的支配者リストを活用する方策を検討し、所要の措置を講じる。 の他特定事業者監督省\n向上 併せて、株式会社をはじめとする法人が自身の実質的支配者情報を把握す 庁、その他法人設立根拠\nることの重要性を周知する。 法所管省庁\n実質的支配者リスト制度の実効性を高めるため、引き続きその積極的な活\n用を政府として推進するとともに、金融機関等による直接の確認等の検討\nを含む制度の利便性向上や商業登記制度との連携による実質的支配者リス\nト制度の活用場面の確保にも取り組み、所要の措置を講じる。\n(2) 法人の実質的支配 特定事業者が保持する実質的支配者情報を十分、正確、最新な状態に保つ 令和８年度末 金融庁、警察庁、財務省、\n者情報への当局に ための措置を行うとともに、当局による当該情報への効率的なアクセスを 法務省、その他特定事業\nよるアクセス強化 確保する仕組みを検討し、導入する。 者監督省庁\n公証人が定款認証を通じて保有する実質的支配者情報への当局による照会\nについての対応を一層迅速化する。\n(3) 法人・信託に関する 外国で設立された法人や民事・外国信託について、日本においてマネロン 令和７年度末 警察庁、財務省、金融庁、\nリスク評価 等に悪用されるリスクの評価を行い、必要なリスク低減措置を検討する。 法務省\nIO.６ 特定金融情報の活用\n項目 行動内容 期限 担当府省庁等\n4\n(1) 疑わしい取引の届 JAFICの疑わしい取引の届出の分析にICT／AI技術を積極的に活用するこ 継続実施 警察庁\n出の分析の高度化 とにより、分析の実効性・効率性の向上につなげる。\n(2) 関係機関の連携強 JAFICからの情報提供の充実や、定期的な意見交換等の場を設け、関係機 継続実施 警察庁、特定事業者監督\n化 関との連携を強化する。 官庁\nIO.７ マネロンの捜査・訴追・制裁\n項目 行動内容 期限 担当府省庁等\n(1) リスクに応じたマ 高リスクと特定された前提犯罪について、とりわけ重大複雑な事案（外国 継続実施 法務省、警察庁\nネロン事案の捜査・ において前提犯罪が行われた場合を含む）に係るマネロンの捜査・訴追を\n訴追 推進するため、リスクの理解向上に努めるとともに、各種通達や研修のほ\nか、タスクフォースの枠組みに基づいて、関係省庁が連携して捜査・訴追\nに取り組む。\nマネロン罪の捜査や訴追における電子化の推進について検討し、所要の措 継続実施 同上\n置を講じる。\n(2) 効果的で均衡のと 各種通達や研修等に基づいて、マネロン罪について適切な量刑を確保する 継続実施 法務省\nれた抑止力のある べく取り組む。\n量刑の確保\nIO.８ 犯罪収益の没収\n項目 行動内容 期限 担当府省庁等\n(1) 捜査・没収の執行 犯罪収益や、マネロンに関連する犯罪供用物の押収・没収・追徴を適切に 継続実施 法務省、警察庁\n実施するため、リスクが高い分野に関する犯罪収益追跡捜査、保全措置及\nび没収・追徴を執行する。\nマネロン等に関連する現金等の国境での差し止め、現金等の輸出入情報の 継続実施 財務省、警察庁\n警察庁への共有及び官民連携した取締り等を引き続き行うとともに、カレ\nンシードッグの導入を始めとした新たな取締手法等、国境での取締り体制\n5\nの強化に取り組む。\n(2) 適切な口座凍結検 預貯金口座や暗号資産取引口座に関して、迅速かつ確実な凍結検討依頼を 継続実施 警察庁、金融庁\n討依頼の実施 行う。\n(3) 財産回復に係る勧 財産回復に係る勧告 4 及び勧告 38 の改訂並びにそれを受けたメソドロジ 令和8年度末 法務省、警察庁、財務省、\n告4及び38の改訂 ーの改訂を踏まえ、政府内で諸外国の制度調査等を行うとともに、国内に 金融庁\n対応 おける対応を協議のうえ、必要に応じ措置を講じる。\nIO.９ テロ資金の捜査・訴追・制裁\n項目 行動内容 期限 担当府省庁等\n(1) テロ資金等提供罪 テロ資金等提供罪の捜査や訴追における電子化の推進について検討し、所 継続実施 法務省、警察庁\nの捜査・訴追 要の措置を講じる。\n重大複雑なテロ資金供与の更なる捜査・訴追のため、タスクフォースの枠 継続実施 法務省、警察庁、その他\n組みや各種通達に基づいて、関係省庁が連携し、態勢整備も含め捜査・訴 関係省庁\n追の執行を強化する。また、必要に応じて、国内外のテロ資金供与の状況\n変化も踏まえた新たな取組を検討する。\nIO.10 テロ資金の凍結・NPOの悪用防止\n項目 行動内容 期限 担当府省庁等\n(1) 関係機関の連携強 遅滞なき資産凍結等の実施強化のため、迅速な制裁対象者情報の通知やベ 令和７年度末 外務省、財務省、経済産\n化 ストプラクティスの共有など、関係省庁及び特定事業者（金融機関等及び 業省、警察庁、特定事業\nDNFBPs）との連携の枠組みを強化する。 者監督官庁\n(2) テロ資金の凍結に 外為法及び国際テロリスト等財産凍結法で対応すべき事項及びその具体的 令和７年度末 特定事業者監督官庁、財\n係る事業者の理解 な対応方法を特定事業者に対し周知することで、リスク理解の向上につな 務省、警察庁\nの向上 げる。\n(3) 外国為替取引等取 外国為替取引等取扱業者によるテロ資金供与対策の態勢整備状況及びリス 令和７年度末 財務省\n扱業者に対するテ クに応じた対応状況について、経済制裁の迂回・潜脱等の検知を含め、リ\nロ資金の凍結に係 スクベースでの検査監督を強化する。\n6\nる検査監督の強化\n(4) NPOの悪用防止 NPOがテロ資金供与目的で悪用されることを防ぐため、ターゲットを絞っ 継続実施 内閣府、文科省、厚労省、\nたアウトリーチやモニタリングを継続する。 外務省、警察庁、財務省\nNPO に係る勧告 8 改訂及びそれを受けたメソドロジーの改訂を踏まえ、 令和７年度末 同上\n必要な対応を政府内で協議・実施する。\nIO.11 大量破壊兵器の拡散金融対策\n項目 行動内容 期限 担当府省庁等\n(1) 関係機関の連携強 遅滞なき資産凍結等の実施強化のため、迅速な制裁対象者情報の通知やベ 令和７年度末 外務省、財務省、経産省、\n化 ストプラクティスの共有など、関係省庁及び特定事業者との連携の枠組み 警察庁、特定事業者監督\nを強化する。 官庁\n(2) 拡散金融に係る事 外為法及び国際テロリスト等財産凍結法で対応すべき事項及びその具体的 令和７年度末 特定事業者監督官庁、財\n業者の理解の向上 な対応方法を特定事業者に対し周知することで、リスク理解の向上につな 務省、警察庁\nげる。\n(3) 外国為替取引等取 外国為替取引等取扱業者による拡散金融対策の態勢整備状況及びリスクに 令和７年度末 財務省\n扱業者に対する拡 応じた対応状況について、経済制裁の迂回・潜脱等の検知を含め、リスク\n散金融に係る検査 ベースでの検査監督を強化する。\n監督の強化\n7",
                        "000万円以上」では全生保が4.7件、民保が4.0件となっている。（図表Ⅰ－21）",
                        "000万円以上」では、全生保が3"
                    ],
                    "faithfulness_score": 1.0,
                    "relevancy_score": 0.0
                }
            ],
            "final_scores": {
                "average_faithfulness": 1.0,
                "average_answer_relevancy": 0.0
            },
            "token_usage": {
                "input_tokens": 10900,
                "output_tokens": 69
            },
            "total_cost": 0.243078,
            "model_name": "gpt-4o-mini"
        }
    ]
}
--- FILE: ./backend/rag_history/6eca4c5f-2fc4-43c6-87b7-537d11652d61.json ---
{
    "id": "6eca4c5f-2fc4-43c6-87b7-537d11652d61",
    "createdAt": "2025-08-17T12:34:02.883112+00:00",
    "models_tested": [
        "gpt-4o-mini",
        "gemini-1.5-flash-latest"
    ],
    "advanced_options": {
        "chunking": true,
        "hybridSearch": false,
        "promptTuning": false
    },
    "num_questions": 1,
    "results": [
        {
            "results_by_question": [
                {
                    "question": "f.ドイツのサステナビリティ保証制度の実務訓練は何か月か？",
                    "ground_truth": "少なくとも8か月の実務訓練",
                    "generated_answer": "文脈情報には、ドイツのサステナビリティ保証制度の実務訓練に関する情報が含まれていないため、具体的な回答を提供することはできません。",
                    "retrieved_contexts": [
                        "見通し\n中小企業\n（％ポイント） 見通し\n16年度 17年度 18年度 19年度 20年度 21年度 22年度 23年度 24年度 25年度 26年度 27年度 28年度 29年度 30年度 元年度 2年度 3年度 4年度 5年度 6年度\n■「従業員数判断」BSIの推移\n50\n40\n30\n20\n10\n0\n▲10\n▲20\n▲30\n▲40\n(注)令和6年6月末までの数値は、各調査期における現状判断。\n令和6年9月末及び令和6年12月末の数値は、令和6年4-6月期調査時の見通し。\nシャドー部分は景気後退期を示す。",
                        "見通し\n見通し\n中小企業\n（％ポイント） 見見見通通通ししし\n16年度 17年度 18年度 19年度 20年度 21年度 22年度 23年度 24年度 25年度 26年度 27年度 28年度 29年度 30年度 元年度 2年度 3年度 4年度 5年度 6年度\n●：1-3月期調査時の翌年度の見通し\n○：4-6月期調査時の当年度の見込み\n各調査時期における計数の年度見通しの推移（全規模・全産業） △：7-9月期調査時の当年度の見込み\n□：10-12月期調査時の当年度の見込み\n◇：1-3月期調査時の当年度の見込み\n（１）売上高 (金融業、保険業を除く)\n（前年度比、％）\n8.0\n5.9 6.5",
                        "2024年４月17日決定\nマネロン・テロ資金供与・拡散金融対策政策会議\nマネロン・テロ資金供与・拡散金融対策に関する行動計画（2024-2026 年度）\nIO.1 マネロン・テロ資金供与・拡散金融に係るリスクの認識・協調\n項目 行動内容 期限 担当府省庁等\n(1) ｢政策会議｣の体制 マネロンによる不正な資金の流れの複雑化・多様化に的確に対応するため、 令和６年度末 警察庁、財務省、金融庁、\n強化 マネロン・テロ資金供与・拡散金融対策政策会議（以下、「政策会議」）の 法務省、外務省、その他\n参加省庁拡大等により、｢政策会議｣の体制を強化する。 関係省庁\n(2) 「基本方針」等の進 マネロン・テロ資金供与・拡散金融対策の推進に関する基本方針（2022年 継続実施 同上\n捗管理及び更新 5 月 19 日決定・公表）（以下、「基本方針」）及び本行動計画の進捗状況を\n「政策会議」でフォローアップし、必要に応じ「基本方針」を更新する。\n我が国のマネロン・テロ資金供与・拡散金融対策(以下、｢マネロン等対策｣) 令和６年度末 同上"
                    ],
                    "faithfulness_score": 1.0,
                    "relevancy_score": 0.0
                }
            ],
            "final_scores": {
                "average_faithfulness": 1.0,
                "average_answer_relevancy": 0.0
            },
            "token_usage": {
                "input_tokens": 1986,
                "output_tokens": 69
            },
            "total_cost": 0.04919849999999999,
            "model_name": "gpt-4o-mini"
        },
        {
            "results_by_question": [
                {
                    "question": "f.ドイツのサステナビリティ保証制度の実務訓練は何か月か？",
                    "ground_truth": "少なくとも8か月の実務訓練",
                    "generated_answer": "この文脈には、ドイツのサステナビリティ保証制度の実務訓練に関する情報は含まれていません。そのため、質問に答えることはできません。",
                    "retrieved_contexts": [
                        "見通し\n中小企業\n（％ポイント） 見通し\n16年度 17年度 18年度 19年度 20年度 21年度 22年度 23年度 24年度 25年度 26年度 27年度 28年度 29年度 30年度 元年度 2年度 3年度 4年度 5年度 6年度\n■「従業員数判断」BSIの推移\n50\n40\n30\n20\n10\n0\n▲10\n▲20\n▲30\n▲40\n(注)令和6年6月末までの数値は、各調査期における現状判断。\n令和6年9月末及び令和6年12月末の数値は、令和6年4-6月期調査時の見通し。\nシャドー部分は景気後退期を示す。",
                        "見通し\n見通し\n中小企業\n（％ポイント） 見見見通通通ししし\n16年度 17年度 18年度 19年度 20年度 21年度 22年度 23年度 24年度 25年度 26年度 27年度 28年度 29年度 30年度 元年度 2年度 3年度 4年度 5年度 6年度\n●：1-3月期調査時の翌年度の見通し\n○：4-6月期調査時の当年度の見込み\n各調査時期における計数の年度見通しの推移（全規模・全産業） △：7-9月期調査時の当年度の見込み\n□：10-12月期調査時の当年度の見込み\n◇：1-3月期調査時の当年度の見込み\n（１）売上高 (金融業、保険業を除く)\n（前年度比、％）\n8.0\n5.9 6.5",
                        "2024年４月17日決定\nマネロン・テロ資金供与・拡散金融対策政策会議\nマネロン・テロ資金供与・拡散金融対策に関する行動計画（2024-2026 年度）\nIO.1 マネロン・テロ資金供与・拡散金融に係るリスクの認識・協調\n項目 行動内容 期限 担当府省庁等\n(1) ｢政策会議｣の体制 マネロンによる不正な資金の流れの複雑化・多様化に的確に対応するため、 令和６年度末 警察庁、財務省、金融庁、\n強化 マネロン・テロ資金供与・拡散金融対策政策会議（以下、「政策会議」）の 法務省、外務省、その他\n参加省庁拡大等により、｢政策会議｣の体制を強化する。 関係省庁\n(2) 「基本方針」等の進 マネロン・テロ資金供与・拡散金融対策の推進に関する基本方針（2022年 継続実施 同上\n捗管理及び更新 5 月 19 日決定・公表）（以下、「基本方針」）及び本行動計画の進捗状況を\n「政策会議」でフォローアップし、必要に応じ「基本方針」を更新する。\n我が国のマネロン・テロ資金供与・拡散金融対策(以下、｢マネロン等対策｣) 令和６年度末 同上"
                    ],
                    "faithfulness_score": 1.0,
                    "relevancy_score": 0.0
                }
            ],
            "final_scores": {
                "average_faithfulness": 1.0,
                "average_answer_relevancy": 0.0
            },
            "token_usage": {
                "input_tokens": 1084,
                "output_tokens": 20
            },
            "total_cost": 0.058058,
            "model_name": "gemini-1.5-flash-latest"
        }
    ]
}
--- FILE: ./backend/rag_history/326e1a96-e914-44e9-bb29-2db2a565f169.json ---
{
    "id": "326e1a96-e914-44e9-bb29-2db2a565f169",
    "createdAt": "2025-08-17T12:29:00.926407+00:00",
    "models_tested": [
        "gpt-4o-mini",
        "gemini-1.5-flash-latest"
    ],
    "advanced_options": {
        "chunking": true,
        "hybridSearch": false,
        "promptTuning": false
    },
    "num_questions": 1,
    "results": [
        {
            "results_by_question": [
                {
                    "question": "f.ドイツのサステナビリティ保証制度の実務訓練は何か月か？",
                    "ground_truth": "少なくとも8か月の実務訓練",
                    "generated_answer": "文脈情報には、ドイツのサステナビリティ保証制度の実務訓練に関する情報が含まれていないため、具体的な回答を提供することはできません。",
                    "retrieved_contexts": [
                        "見通し\n中小企業\n（％ポイント） 見通し\n16年度 17年度 18年度 19年度 20年度 21年度 22年度 23年度 24年度 25年度 26年度 27年度 28年度 29年度 30年度 元年度 2年度 3年度 4年度 5年度 6年度\n■「従業員数判断」BSIの推移\n50\n40\n30\n20\n10\n0\n▲10\n▲20\n▲30\n▲40\n(注)令和6年6月末までの数値は、各調査期における現状判断。\n令和6年9月末及び令和6年12月末の数値は、令和6年4-6月期調査時の見通し。\nシャドー部分は景気後退期を示す。",
                        "見通し\n見通し\n中小企業\n（％ポイント） 見見見通通通ししし\n16年度 17年度 18年度 19年度 20年度 21年度 22年度 23年度 24年度 25年度 26年度 27年度 28年度 29年度 30年度 元年度 2年度 3年度 4年度 5年度 6年度\n●：1-3月期調査時の翌年度の見通し\n○：4-6月期調査時の当年度の見込み\n各調査時期における計数の年度見通しの推移（全規模・全産業） △：7-9月期調査時の当年度の見込み\n□：10-12月期調査時の当年度の見込み\n◇：1-3月期調査時の当年度の見込み\n（１）売上高 (金融業、保険業を除く)\n（前年度比、％）\n8.0\n5.9 6.5",
                        "2024年４月17日決定\nマネロン・テロ資金供与・拡散金融対策政策会議\nマネロン・テロ資金供与・拡散金融対策に関する行動計画（2024-2026 年度）\nIO.1 マネロン・テロ資金供与・拡散金融に係るリスクの認識・協調\n項目 行動内容 期限 担当府省庁等\n(1) ｢政策会議｣の体制 マネロンによる不正な資金の流れの複雑化・多様化に的確に対応するため、 令和６年度末 警察庁、財務省、金融庁、\n強化 マネロン・テロ資金供与・拡散金融対策政策会議（以下、「政策会議」）の 法務省、外務省、その他\n参加省庁拡大等により、｢政策会議｣の体制を強化する。 関係省庁\n(2) 「基本方針」等の進 マネロン・テロ資金供与・拡散金融対策の推進に関する基本方針（2022年 継続実施 同上\n捗管理及び更新 5 月 19 日決定・公表）（以下、「基本方針」）及び本行動計画の進捗状況を\n「政策会議」でフォローアップし、必要に応じ「基本方針」を更新する。\n我が国のマネロン・テロ資金供与・拡散金融対策(以下、｢マネロン等対策｣) 令和６年度末 同上"
                    ],
                    "faithfulness_score": 1.0,
                    "relevancy_score": 0.0
                }
            ],
            "final_scores": {
                "average_faithfulness": 1.0,
                "average_answer_relevancy": 0.0
            },
            "token_usage": {
                "input_tokens": 1986,
                "output_tokens": 69
            },
            "total_cost": 0.04919849999999999,
            "model_name": "gpt-4o-mini"
        },
        {
            "results_by_question": [
                {
                    "question": "f.ドイツのサステナビリティ保証制度の実務訓練は何か月か？",
                    "ground_truth": "少なくとも8か月の実務訓練",
                    "generated_answer": "この文脈には、ドイツのサステナビリティ保証制度や実務訓練に関する情報は含まれていません。そのため、質問に答えることはできません。",
                    "retrieved_contexts": [
                        "見通し\n中小企業\n（％ポイント） 見通し\n16年度 17年度 18年度 19年度 20年度 21年度 22年度 23年度 24年度 25年度 26年度 27年度 28年度 29年度 30年度 元年度 2年度 3年度 4年度 5年度 6年度\n■「従業員数判断」BSIの推移\n50\n40\n30\n20\n10\n0\n▲10\n▲20\n▲30\n▲40\n(注)令和6年6月末までの数値は、各調査期における現状判断。\n令和6年9月末及び令和6年12月末の数値は、令和6年4-6月期調査時の見通し。\nシャドー部分は景気後退期を示す。",
                        "見通し\n見通し\n中小企業\n（％ポイント） 見見見通通通ししし\n16年度 17年度 18年度 19年度 20年度 21年度 22年度 23年度 24年度 25年度 26年度 27年度 28年度 29年度 30年度 元年度 2年度 3年度 4年度 5年度 6年度\n●：1-3月期調査時の翌年度の見通し\n○：4-6月期調査時の当年度の見込み\n各調査時期における計数の年度見通しの推移（全規模・全産業） △：7-9月期調査時の当年度の見込み\n□：10-12月期調査時の当年度の見込み\n◇：1-3月期調査時の当年度の見込み\n（１）売上高 (金融業、保険業を除く)\n（前年度比、％）\n8.0\n5.9 6.5",
                        "2024年４月17日決定\nマネロン・テロ資金供与・拡散金融対策政策会議\nマネロン・テロ資金供与・拡散金融対策に関する行動計画（2024-2026 年度）\nIO.1 マネロン・テロ資金供与・拡散金融に係るリスクの認識・協調\n項目 行動内容 期限 担当府省庁等\n(1) ｢政策会議｣の体制 マネロンによる不正な資金の流れの複雑化・多様化に的確に対応するため、 令和６年度末 警察庁、財務省、金融庁、\n強化 マネロン・テロ資金供与・拡散金融対策政策会議（以下、「政策会議」）の 法務省、外務省、その他\n参加省庁拡大等により、｢政策会議｣の体制を強化する。 関係省庁\n(2) 「基本方針」等の進 マネロン・テロ資金供与・拡散金融対策の推進に関する基本方針（2022年 継続実施 同上\n捗管理及び更新 5 月 19 日決定・公表）（以下、「基本方針」）及び本行動計画の進捗状況を\n「政策会議」でフォローアップし、必要に応じ「基本方針」を更新する。\n我が国のマネロン・テロ資金供与・拡散金融対策(以下、｢マネロン等対策｣) 令和６年度末 同上"
                    ],
                    "faithfulness_score": 1.0,
                    "relevancy_score": 0.0
                }
            ],
            "final_scores": {
                "average_faithfulness": 1.0,
                "average_answer_relevancy": 0.0
            },
            "token_usage": {
                "input_tokens": 1084,
                "output_tokens": 20
            },
            "total_cost": 0.058058,
            "model_name": "gemini-1.5-flash-latest"
        }
    ]
}
--- FILE: ./backend/rag_history/9be51a95-7aa2-43b7-bac7-b4d0a5b81517.json ---
{
    "id": "9be51a95-7aa2-43b7-bac7-b4d0a5b81517",
    "createdAt": "2025-08-17T12:59:16.108447+00:00",
    "qa_filename": "質問・正解(f).csv",
    "context_filename": "文脈(f).csv",
    "models_tested": [
        "gpt-4o-mini"
    ],
    "advanced_options": {
        "chunking": false,
        "hybridSearch": false,
        "promptTuning": false
    },
    "num_questions": 1,
    "results": [
        {
            "results_by_question": [
                {
                    "question": "f.ドイツのサステナビリティ保証制度の実務訓練は何か月か？",
                    "ground_truth": "少なくとも8か月の実務訓練",
                    "generated_answer": "文脈情報には、ドイツのサステナビリティ保証制度の実務訓練に関する情報が含まれていないため、具体的な回答を提供することはできません。",
                    "retrieved_contexts": [
                        "2024年４月17日決定\nマネロン・テロ資金供与・拡散金融対策政策会議\nマネロン・テロ資金供与・拡散金融対策に関する行動計画（2024-2026 年度）\nIO.1 マネロン・テロ資金供与・拡散金融に係るリスクの認識・協調\n項目 行動内容 期限 担当府省庁等\n(1) ｢政策会議｣の体制 マネロンによる不正な資金の流れの複雑化・多様化に的確に対応するため、 令和６年度末 警察庁、財務省、金融庁、\n強化 マネロン・テロ資金供与・拡散金融対策政策会議（以下、「政策会議」）の 法務省、外務省、その他\n参加省庁拡大等により、｢政策会議｣の体制を強化する。 関係省庁\n(2) 「基本方針」等の進 マネロン・テロ資金供与・拡散金融対策の推進に関する基本方針（2022年 継続実施 同上\n捗管理及び更新 5 月 19 日決定・公表）（以下、「基本方針」）及び本行動計画の進捗状況を\n「政策会議」でフォローアップし、必要に応じ「基本方針」を更新する。\n我が国のマネロン・テロ資金供与・拡散金融対策(以下、｢マネロン等対策｣) 令和６年度末 同上\nの強化の進捗状況を的確に把握するため、FATF基準も踏まえ、適切な統計\nデータ等を特定し、継続的に把握する。\n関係省庁及び業界団体が緊密に連携し、マネロン等対策の強化に向けて取 令和８年度末 同上\nり組むため、次期「基本方針」等の検討において、民間有識者及び関係業\n界団体等の意見を聴取し、聴取した意見を反映させる。\n(3) 国内外情勢の変化 国内外の情勢変化等を踏まえタイムリーにリスク評価を見直すこととし、 継続実施 同上\n等を踏まえたタイ 犯罪収益移転危険度調査書については毎年、拡散金融リスク評価書につい\nムリーなリスク評 ては定期的に更新する。\n価の更新等 犯罪収益移転危険度調査書及び拡散金融リスク評価書等を踏まえ、定期的 継続実施 同上\nな意見交換等の場を設け、関係省庁間でリスク認識の向上につなげる。\nIO.２ 国際協力\n項目 行動内容 期限 担当府省庁等\n(1) 国際機関等との連 FATF、APG の活動支援等を通じ、国際的なマネロン等対策に貢献すると 継続実施 警察庁、財務省、外務省\n携強化 ともに、インターポール、エグモント・グループ等の国際機関等との連携\n1\n強化に取り組む。\n(2) 効果的かつ時機を 国際業務に従事する検察庁及び警察職員に対して、捜査共助・逃亡犯罪人 継続実施 法務省、警察庁\n得た捜査共助・逃亡 引渡に関するトレーニングを実施し、これら手続に対する理解を深め、積\n犯罪人引渡の実施 極的な活用につなげる。\n(3) 外国のカウンター JAFIC と外国 FIU の情報交換がより広範かつ効果的なものとなるよう、 継続実施 警察庁、外務省\nパートとの(2)以外 FIU 間の情報交換枠組みの一層の充実を図るとともに、活発な情報交換を\nの情報交換の促進 実施する。\n外国当局から要請された口座凍結に対し、適切な対応を推進する。 継続実施 同上\n監督当局等による他国のカウンターパートとのマネロン・テロ資金供与等 継続実施 金融庁、その他特定事業\nに関する情報交換を継続するとともに、必要に応じて更に発展させる。 者監督官庁\nIO.３ マネロン・テロ資金供与対策に係る金融機関・暗号資産交換業者（VASPs）の監督・予防措置\n項目 行動内容 期限 担当府省庁等\n(1) 金融機関等による マネロン・テロ資金供与対策に係る重要性等の周知徹底により、金融機関・ 継続実施 金融庁、その他金融機関\nリスクベースアプ 暗号資産交換業者（以下、「金融機関等」）のリスク理解を更に向上させ、 監督省庁\nローチに基づく取 リスク評価に基づくリスクベースの実効性ある取組を促す。また、必要に\n組の促進等 応じて、マネロン・テロ資金供与対策に関する検査監督ガイドラインを更\n新する。\n政府広報も活用して、官民が連携して国民の理解を促進しつつ、金融機関 継続実施 同上\n等による継続的な顧客情報管理に基づく顧客のリスク評価の取組を推進す\nる。\n(2) 監督当局による金 マネロン・テロ資金供与対策に関するノウハウの共有や共同研修の実施な 継続実施 同上\n融機関等に対する どの監督当局間連携の取組を推進するとともに、リスクベースアプローチ\nリスクベースアプ に基づくメリハリのある検査監督の取組を実践する。ブロックチェーンや\nローチに基づく検 暗号資産等を活用した技術による新たな金融商品・サービスを提供する金\n査監督の実践等 融機関等において、必要なリスク低減措置等が実施されるよう取り組む。\n2\nまた、金融機関等の取組を改善させるため、効果的かつ抑止力のある措置 継続実施 同上\nを実施する。\n(3) 取引モニタリング 為替取引分析業者の検査監督等を通じて、共同システムの安定運営を確保 継続実施 同上\n共同システムの充 しつつ、金融機関等による取引モニタリング等を強化する。\n実・効率化、金融機\n関等の取引モニタ\nリング等の強化\nIO.４ マネロン・テロ資金供与対策に係る特定非金融業者及び職業専門家（DNFBPs）の監督・予防措置\n項目 行動内容 期限 担当府省庁等\n(1) DNFBPs のリスク マネロン・テロ資金供与対策に関するガイドライン等の周知徹底により、 令和８年度末 DNFBPs監督官庁、警察\n理解向上とリスク DNFBPsのリスク理解を向上させ、適切なリスクベースアプローチに基づ 庁、財務省\nベースアプローチ く取組を促す。その上で、必要に応じて、ガイドラインの更新やガイドラ\nに基づく取組の促 インに関するよくある質問（FAQ）の策定を行う。\n進等 また、マネロン・テロ資金供与対策に関するガイドラインの実施期限を明\n確化する。\n取引モニタリングを強化するとともに、政府広報も活用して国民の理解を 令和８年度末 警察庁、財務省、DNFBPs\n促進しつつ、DNFBPsによる取引時確認及び継続的顧客管理の実効性を確 監督官庁\n保する。\n(2) 監 督 当 局 に よ る ｢政策会議｣等において、モニタリング手法や参考事例、ベストプラクティ 令和６年度末 同上\nDNFBPs に対する スを共有することにより、監督当局によるマネロン・テロ資金供与対策に\nリスクベースアプ 係るリスクベースでの検査監督を強化する。\nローチに基づく検 各業界団体と政府当局との定期協議の場を設けるとともに、関係省庁間で 令和６年度末 同上\n査監督の強化 連携して地方公共団体を含む担当者の能力向上のための研修プログラムを\n作成し、実施する。\n監督当局によるリスクベースでの検査監督を実施するため、モニタリング 令和７年度末 DNFBPs監督官庁、警察\n3\n方針を策定する。 庁、財務省\n(3) 疑わしい取引の届 疑わしい取引の届出の実効性を高めるため、必要に応じて、疑わしい取引 令和８年度末 警察庁、財務省、DNFBPs\n出の推進強化及び の参考事例を作成・更新するとともに、疑わしい取引参考事例の共有やア 監督官庁\n向上 ウトリーチの実施等によりDNFBPsの理解を深めることにより、疑わしい\n取引の届出の推進強化及び質・件数の向上につなげる。\nIO.５ 法人等の悪用防止\n項目 行動内容 期限 担当府省庁等\n(1) 法人の実質的支配 法人の実質的支配者情報に関する制度整備に向けた検討を推進しながら、 令和８年度末 法務省、財務省、警察庁、\n者情報に関する制 株式会社が自らの実質的支配者情報を特定するため、株主である他の株式 金融庁、経済産業省、そ\n度の改善と実効性 会社の実質的支配者リストを活用する方策を検討し、所要の措置を講じる。 の他特定事業者監督省\n向上 併せて、株式会社をはじめとする法人が自身の実質的支配者情報を把握す 庁、その他法人設立根拠\nることの重要性を周知する。 法所管省庁\n実質的支配者リスト制度の実効性を高めるため、引き続きその積極的な活\n用を政府として推進するとともに、金融機関等による直接の確認等の検討\nを含む制度の利便性向上や商業登記制度との連携による実質的支配者リス\nト制度の活用場面の確保にも取り組み、所要の措置を講じる。\n(2) 法人の実質的支配 特定事業者が保持する実質的支配者情報を十分、正確、最新な状態に保つ 令和８年度末 金融庁、警察庁、財務省、\n者情報への当局に ための措置を行うとともに、当局による当該情報への効率的なアクセスを 法務省、その他特定事業\nよるアクセス強化 確保する仕組みを検討し、導入する。 者監督省庁\n公証人が定款認証を通じて保有する実質的支配者情報への当局による照会\nについての対応を一層迅速化する。\n(3) 法人・信託に関する 外国で設立された法人や民事・外国信託について、日本においてマネロン 令和７年度末 警察庁、財務省、金融庁、\nリスク評価 等に悪用されるリスクの評価を行い、必要なリスク低減措置を検討する。 法務省\nIO.６ 特定金融情報の活用\n項目 行動内容 期限 担当府省庁等\n4\n(1) 疑わしい取引の届 JAFICの疑わしい取引の届出の分析にICT／AI技術を積極的に活用するこ 継続実施 警察庁\n出の分析の高度化 とにより、分析の実効性・効率性の向上につなげる。\n(2) 関係機関の連携強 JAFICからの情報提供の充実や、定期的な意見交換等の場を設け、関係機 継続実施 警察庁、特定事業者監督\n化 関との連携を強化する。 官庁\nIO.７ マネロンの捜査・訴追・制裁\n項目 行動内容 期限 担当府省庁等\n(1) リスクに応じたマ 高リスクと特定された前提犯罪について、とりわけ重大複雑な事案（外国 継続実施 法務省、警察庁\nネロン事案の捜査・ において前提犯罪が行われた場合を含む）に係るマネロンの捜査・訴追を\n訴追 推進するため、リスクの理解向上に努めるとともに、各種通達や研修のほ\nか、タスクフォースの枠組みに基づいて、関係省庁が連携して捜査・訴追\nに取り組む。\nマネロン罪の捜査や訴追における電子化の推進について検討し、所要の措 継続実施 同上\n置を講じる。\n(2) 効果的で均衡のと 各種通達や研修等に基づいて、マネロン罪について適切な量刑を確保する 継続実施 法務省\nれた抑止力のある べく取り組む。\n量刑の確保\nIO.８ 犯罪収益の没収\n項目 行動内容 期限 担当府省庁等\n(1) 捜査・没収の執行 犯罪収益や、マネロンに関連する犯罪供用物の押収・没収・追徴を適切に 継続実施 法務省、警察庁\n実施するため、リスクが高い分野に関する犯罪収益追跡捜査、保全措置及\nび没収・追徴を執行する。\nマネロン等に関連する現金等の国境での差し止め、現金等の輸出入情報の 継続実施 財務省、警察庁\n警察庁への共有及び官民連携した取締り等を引き続き行うとともに、カレ\nンシードッグの導入を始めとした新たな取締手法等、国境での取締り体制\n5\nの強化に取り組む。\n(2) 適切な口座凍結検 預貯金口座や暗号資産取引口座に関して、迅速かつ確実な凍結検討依頼を 継続実施 警察庁、金融庁\n討依頼の実施 行う。\n(3) 財産回復に係る勧 財産回復に係る勧告 4 及び勧告 38 の改訂並びにそれを受けたメソドロジ 令和8年度末 法務省、警察庁、財務省、\n告4及び38の改訂 ーの改訂を踏まえ、政府内で諸外国の制度調査等を行うとともに、国内に 金融庁\n対応 おける対応を協議のうえ、必要に応じ措置を講じる。\nIO.９ テロ資金の捜査・訴追・制裁\n項目 行動内容 期限 担当府省庁等\n(1) テロ資金等提供罪 テロ資金等提供罪の捜査や訴追における電子化の推進について検討し、所 継続実施 法務省、警察庁\nの捜査・訴追 要の措置を講じる。\n重大複雑なテロ資金供与の更なる捜査・訴追のため、タスクフォースの枠 継続実施 法務省、警察庁、その他\n組みや各種通達に基づいて、関係省庁が連携し、態勢整備も含め捜査・訴 関係省庁\n追の執行を強化する。また、必要に応じて、国内外のテロ資金供与の状況\n変化も踏まえた新たな取組を検討する。\nIO.10 テロ資金の凍結・NPOの悪用防止\n項目 行動内容 期限 担当府省庁等\n(1) 関係機関の連携強 遅滞なき資産凍結等の実施強化のため、迅速な制裁対象者情報の通知やベ 令和７年度末 外務省、財務省、経済産\n化 ストプラクティスの共有など、関係省庁及び特定事業者（金融機関等及び 業省、警察庁、特定事業\nDNFBPs）との連携の枠組みを強化する。 者監督官庁\n(2) テロ資金の凍結に 外為法及び国際テロリスト等財産凍結法で対応すべき事項及びその具体的 令和７年度末 特定事業者監督官庁、財\n係る事業者の理解 な対応方法を特定事業者に対し周知することで、リスク理解の向上につな 務省、警察庁\nの向上 げる。\n(3) 外国為替取引等取 外国為替取引等取扱業者によるテロ資金供与対策の態勢整備状況及びリス 令和７年度末 財務省\n扱業者に対するテ クに応じた対応状況について、経済制裁の迂回・潜脱等の検知を含め、リ\nロ資金の凍結に係 スクベースでの検査監督を強化する。\n6\nる検査監督の強化\n(4) NPOの悪用防止 NPOがテロ資金供与目的で悪用されることを防ぐため、ターゲットを絞っ 継続実施 内閣府、文科省、厚労省、\nたアウトリーチやモニタリングを継続する。 外務省、警察庁、財務省\nNPO に係る勧告 8 改訂及びそれを受けたメソドロジーの改訂を踏まえ、 令和７年度末 同上\n必要な対応を政府内で協議・実施する。\nIO.11 大量破壊兵器の拡散金融対策\n項目 行動内容 期限 担当府省庁等\n(1) 関係機関の連携強 遅滞なき資産凍結等の実施強化のため、迅速な制裁対象者情報の通知やベ 令和７年度末 外務省、財務省、経産省、\n化 ストプラクティスの共有など、関係省庁及び特定事業者との連携の枠組み 警察庁、特定事業者監督\nを強化する。 官庁\n(2) 拡散金融に係る事 外為法及び国際テロリスト等財産凍結法で対応すべき事項及びその具体的 令和７年度末 特定事業者監督官庁、財\n業者の理解の向上 な対応方法を特定事業者に対し周知することで、リスク理解の向上につな 務省、警察庁\nげる。\n(3) 外国為替取引等取 外国為替取引等取扱業者による拡散金融対策の態勢整備状況及びリスクに 令和７年度末 財務省\n扱業者に対する拡 応じた対応状況について、経済制裁の迂回・潜脱等の検知を含め、リスク\n散金融に係る検査 ベースでの検査監督を強化する。\n監督の強化\n7",
                        "000万円以上」では全生保が4.7件、民保が4.0件となっている。（図表Ⅰ－21）",
                        "000万円以上」では、全生保が3"
                    ],
                    "faithfulness_score": 1.0,
                    "relevancy_score": 0.0
                }
            ],
            "final_scores": {
                "average_faithfulness": 1.0,
                "average_answer_relevancy": 0.0
            },
            "token_usage": {
                "input_tokens": 10900,
                "output_tokens": 69
            },
            "total_cost": 0.243078,
            "model_name": "gpt-4o-mini"
        }
    ]
}
--- FILE: ./backend/rag_history/e1b34f7f-5ac2-42f2-88da-04dec47e39b0.json ---
{
    "id": "e1b34f7f-5ac2-42f2-88da-04dec47e39b0",
    "createdAt": "2025-08-17T12:58:31.580256+00:00",
    "qa_filename": "質問・正解(f).csv",
    "context_filename": "文脈(f).csv",
    "models_tested": [
        "gpt-4o-mini"
    ],
    "advanced_options": {
        "chunking": false,
        "hybridSearch": false,
        "promptTuning": false
    },
    "num_questions": 1,
    "results": [
        {
            "results_by_question": [
                {
                    "question": "f.ドイツのサステナビリティ保証制度の実務訓練は何か月か？",
                    "ground_truth": "少なくとも8か月の実務訓練",
                    "generated_answer": "文脈情報には、ドイツのサステナビリティ保証制度の実務訓練に関する情報が含まれていないため、具体的な回答を提供することはできません。",
                    "retrieved_contexts": [
                        "2024年４月17日決定\nマネロン・テロ資金供与・拡散金融対策政策会議\nマネロン・テロ資金供与・拡散金融対策に関する行動計画（2024-2026 年度）\nIO.1 マネロン・テロ資金供与・拡散金融に係るリスクの認識・協調\n項目 行動内容 期限 担当府省庁等\n(1) ｢政策会議｣の体制 マネロンによる不正な資金の流れの複雑化・多様化に的確に対応するため、 令和６年度末 警察庁、財務省、金融庁、\n強化 マネロン・テロ資金供与・拡散金融対策政策会議（以下、「政策会議」）の 法務省、外務省、その他\n参加省庁拡大等により、｢政策会議｣の体制を強化する。 関係省庁\n(2) 「基本方針」等の進 マネロン・テロ資金供与・拡散金融対策の推進に関する基本方針（2022年 継続実施 同上\n捗管理及び更新 5 月 19 日決定・公表）（以下、「基本方針」）及び本行動計画の進捗状況を\n「政策会議」でフォローアップし、必要に応じ「基本方針」を更新する。\n我が国のマネロン・テロ資金供与・拡散金融対策(以下、｢マネロン等対策｣) 令和６年度末 同上\nの強化の進捗状況を的確に把握するため、FATF基準も踏まえ、適切な統計\nデータ等を特定し、継続的に把握する。\n関係省庁及び業界団体が緊密に連携し、マネロン等対策の強化に向けて取 令和８年度末 同上\nり組むため、次期「基本方針」等の検討において、民間有識者及び関係業\n界団体等の意見を聴取し、聴取した意見を反映させる。\n(3) 国内外情勢の変化 国内外の情勢変化等を踏まえタイムリーにリスク評価を見直すこととし、 継続実施 同上\n等を踏まえたタイ 犯罪収益移転危険度調査書については毎年、拡散金融リスク評価書につい\nムリーなリスク評 ては定期的に更新する。\n価の更新等 犯罪収益移転危険度調査書及び拡散金融リスク評価書等を踏まえ、定期的 継続実施 同上\nな意見交換等の場を設け、関係省庁間でリスク認識の向上につなげる。\nIO.２ 国際協力\n項目 行動内容 期限 担当府省庁等\n(1) 国際機関等との連 FATF、APG の活動支援等を通じ、国際的なマネロン等対策に貢献すると 継続実施 警察庁、財務省、外務省\n携強化 ともに、インターポール、エグモント・グループ等の国際機関等との連携\n1\n強化に取り組む。\n(2) 効果的かつ時機を 国際業務に従事する検察庁及び警察職員に対して、捜査共助・逃亡犯罪人 継続実施 法務省、警察庁\n得た捜査共助・逃亡 引渡に関するトレーニングを実施し、これら手続に対する理解を深め、積\n犯罪人引渡の実施 極的な活用につなげる。\n(3) 外国のカウンター JAFIC と外国 FIU の情報交換がより広範かつ効果的なものとなるよう、 継続実施 警察庁、外務省\nパートとの(2)以外 FIU 間の情報交換枠組みの一層の充実を図るとともに、活発な情報交換を\nの情報交換の促進 実施する。\n外国当局から要請された口座凍結に対し、適切な対応を推進する。 継続実施 同上\n監督当局等による他国のカウンターパートとのマネロン・テロ資金供与等 継続実施 金融庁、その他特定事業\nに関する情報交換を継続するとともに、必要に応じて更に発展させる。 者監督官庁\nIO.３ マネロン・テロ資金供与対策に係る金融機関・暗号資産交換業者（VASPs）の監督・予防措置\n項目 行動内容 期限 担当府省庁等\n(1) 金融機関等による マネロン・テロ資金供与対策に係る重要性等の周知徹底により、金融機関・ 継続実施 金融庁、その他金融機関\nリスクベースアプ 暗号資産交換業者（以下、「金融機関等」）のリスク理解を更に向上させ、 監督省庁\nローチに基づく取 リスク評価に基づくリスクベースの実効性ある取組を促す。また、必要に\n組の促進等 応じて、マネロン・テロ資金供与対策に関する検査監督ガイドラインを更\n新する。\n政府広報も活用して、官民が連携して国民の理解を促進しつつ、金融機関 継続実施 同上\n等による継続的な顧客情報管理に基づく顧客のリスク評価の取組を推進す\nる。\n(2) 監督当局による金 マネロン・テロ資金供与対策に関するノウハウの共有や共同研修の実施な 継続実施 同上\n融機関等に対する どの監督当局間連携の取組を推進するとともに、リスクベースアプローチ\nリスクベースアプ に基づくメリハリのある検査監督の取組を実践する。ブロックチェーンや\nローチに基づく検 暗号資産等を活用した技術による新たな金融商品・サービスを提供する金\n査監督の実践等 融機関等において、必要なリスク低減措置等が実施されるよう取り組む。\n2\nまた、金融機関等の取組を改善させるため、効果的かつ抑止力のある措置 継続実施 同上\nを実施する。\n(3) 取引モニタリング 為替取引分析業者の検査監督等を通じて、共同システムの安定運営を確保 継続実施 同上\n共同システムの充 しつつ、金融機関等による取引モニタリング等を強化する。\n実・効率化、金融機\n関等の取引モニタ\nリング等の強化\nIO.４ マネロン・テロ資金供与対策に係る特定非金融業者及び職業専門家（DNFBPs）の監督・予防措置\n項目 行動内容 期限 担当府省庁等\n(1) DNFBPs のリスク マネロン・テロ資金供与対策に関するガイドライン等の周知徹底により、 令和８年度末 DNFBPs監督官庁、警察\n理解向上とリスク DNFBPsのリスク理解を向上させ、適切なリスクベースアプローチに基づ 庁、財務省\nベースアプローチ く取組を促す。その上で、必要に応じて、ガイドラインの更新やガイドラ\nに基づく取組の促 インに関するよくある質問（FAQ）の策定を行う。\n進等 また、マネロン・テロ資金供与対策に関するガイドラインの実施期限を明\n確化する。\n取引モニタリングを強化するとともに、政府広報も活用して国民の理解を 令和８年度末 警察庁、財務省、DNFBPs\n促進しつつ、DNFBPsによる取引時確認及び継続的顧客管理の実効性を確 監督官庁\n保する。\n(2) 監 督 当 局 に よ る ｢政策会議｣等において、モニタリング手法や参考事例、ベストプラクティ 令和６年度末 同上\nDNFBPs に対する スを共有することにより、監督当局によるマネロン・テロ資金供与対策に\nリスクベースアプ 係るリスクベースでの検査監督を強化する。\nローチに基づく検 各業界団体と政府当局との定期協議の場を設けるとともに、関係省庁間で 令和６年度末 同上\n査監督の強化 連携して地方公共団体を含む担当者の能力向上のための研修プログラムを\n作成し、実施する。\n監督当局によるリスクベースでの検査監督を実施するため、モニタリング 令和７年度末 DNFBPs監督官庁、警察\n3\n方針を策定する。 庁、財務省\n(3) 疑わしい取引の届 疑わしい取引の届出の実効性を高めるため、必要に応じて、疑わしい取引 令和８年度末 警察庁、財務省、DNFBPs\n出の推進強化及び の参考事例を作成・更新するとともに、疑わしい取引参考事例の共有やア 監督官庁\n向上 ウトリーチの実施等によりDNFBPsの理解を深めることにより、疑わしい\n取引の届出の推進強化及び質・件数の向上につなげる。\nIO.５ 法人等の悪用防止\n項目 行動内容 期限 担当府省庁等\n(1) 法人の実質的支配 法人の実質的支配者情報に関する制度整備に向けた検討を推進しながら、 令和８年度末 法務省、財務省、警察庁、\n者情報に関する制 株式会社が自らの実質的支配者情報を特定するため、株主である他の株式 金融庁、経済産業省、そ\n度の改善と実効性 会社の実質的支配者リストを活用する方策を検討し、所要の措置を講じる。 の他特定事業者監督省\n向上 併せて、株式会社をはじめとする法人が自身の実質的支配者情報を把握す 庁、その他法人設立根拠\nることの重要性を周知する。 法所管省庁\n実質的支配者リスト制度の実効性を高めるため、引き続きその積極的な活\n用を政府として推進するとともに、金融機関等による直接の確認等の検討\nを含む制度の利便性向上や商業登記制度との連携による実質的支配者リス\nト制度の活用場面の確保にも取り組み、所要の措置を講じる。\n(2) 法人の実質的支配 特定事業者が保持する実質的支配者情報を十分、正確、最新な状態に保つ 令和８年度末 金融庁、警察庁、財務省、\n者情報への当局に ための措置を行うとともに、当局による当該情報への効率的なアクセスを 法務省、その他特定事業\nよるアクセス強化 確保する仕組みを検討し、導入する。 者監督省庁\n公証人が定款認証を通じて保有する実質的支配者情報への当局による照会\nについての対応を一層迅速化する。\n(3) 法人・信託に関する 外国で設立された法人や民事・外国信託について、日本においてマネロン 令和７年度末 警察庁、財務省、金融庁、\nリスク評価 等に悪用されるリスクの評価を行い、必要なリスク低減措置を検討する。 法務省\nIO.６ 特定金融情報の活用\n項目 行動内容 期限 担当府省庁等\n4\n(1) 疑わしい取引の届 JAFICの疑わしい取引の届出の分析にICT／AI技術を積極的に活用するこ 継続実施 警察庁\n出の分析の高度化 とにより、分析の実効性・効率性の向上につなげる。\n(2) 関係機関の連携強 JAFICからの情報提供の充実や、定期的な意見交換等の場を設け、関係機 継続実施 警察庁、特定事業者監督\n化 関との連携を強化する。 官庁\nIO.７ マネロンの捜査・訴追・制裁\n項目 行動内容 期限 担当府省庁等\n(1) リスクに応じたマ 高リスクと特定された前提犯罪について、とりわけ重大複雑な事案（外国 継続実施 法務省、警察庁\nネロン事案の捜査・ において前提犯罪が行われた場合を含む）に係るマネロンの捜査・訴追を\n訴追 推進するため、リスクの理解向上に努めるとともに、各種通達や研修のほ\nか、タスクフォースの枠組みに基づいて、関係省庁が連携して捜査・訴追\nに取り組む。\nマネロン罪の捜査や訴追における電子化の推進について検討し、所要の措 継続実施 同上\n置を講じる。\n(2) 効果的で均衡のと 各種通達や研修等に基づいて、マネロン罪について適切な量刑を確保する 継続実施 法務省\nれた抑止力のある べく取り組む。\n量刑の確保\nIO.８ 犯罪収益の没収\n項目 行動内容 期限 担当府省庁等\n(1) 捜査・没収の執行 犯罪収益や、マネロンに関連する犯罪供用物の押収・没収・追徴を適切に 継続実施 法務省、警察庁\n実施するため、リスクが高い分野に関する犯罪収益追跡捜査、保全措置及\nび没収・追徴を執行する。\nマネロン等に関連する現金等の国境での差し止め、現金等の輸出入情報の 継続実施 財務省、警察庁\n警察庁への共有及び官民連携した取締り等を引き続き行うとともに、カレ\nンシードッグの導入を始めとした新たな取締手法等、国境での取締り体制\n5\nの強化に取り組む。\n(2) 適切な口座凍結検 預貯金口座や暗号資産取引口座に関して、迅速かつ確実な凍結検討依頼を 継続実施 警察庁、金融庁\n討依頼の実施 行う。\n(3) 財産回復に係る勧 財産回復に係る勧告 4 及び勧告 38 の改訂並びにそれを受けたメソドロジ 令和8年度末 法務省、警察庁、財務省、\n告4及び38の改訂 ーの改訂を踏まえ、政府内で諸外国の制度調査等を行うとともに、国内に 金融庁\n対応 おける対応を協議のうえ、必要に応じ措置を講じる。\nIO.９ テロ資金の捜査・訴追・制裁\n項目 行動内容 期限 担当府省庁等\n(1) テロ資金等提供罪 テロ資金等提供罪の捜査や訴追における電子化の推進について検討し、所 継続実施 法務省、警察庁\nの捜査・訴追 要の措置を講じる。\n重大複雑なテロ資金供与の更なる捜査・訴追のため、タスクフォースの枠 継続実施 法務省、警察庁、その他\n組みや各種通達に基づいて、関係省庁が連携し、態勢整備も含め捜査・訴 関係省庁\n追の執行を強化する。また、必要に応じて、国内外のテロ資金供与の状況\n変化も踏まえた新たな取組を検討する。\nIO.10 テロ資金の凍結・NPOの悪用防止\n項目 行動内容 期限 担当府省庁等\n(1) 関係機関の連携強 遅滞なき資産凍結等の実施強化のため、迅速な制裁対象者情報の通知やベ 令和７年度末 外務省、財務省、経済産\n化 ストプラクティスの共有など、関係省庁及び特定事業者（金融機関等及び 業省、警察庁、特定事業\nDNFBPs）との連携の枠組みを強化する。 者監督官庁\n(2) テロ資金の凍結に 外為法及び国際テロリスト等財産凍結法で対応すべき事項及びその具体的 令和７年度末 特定事業者監督官庁、財\n係る事業者の理解 な対応方法を特定事業者に対し周知することで、リスク理解の向上につな 務省、警察庁\nの向上 げる。\n(3) 外国為替取引等取 外国為替取引等取扱業者によるテロ資金供与対策の態勢整備状況及びリス 令和７年度末 財務省\n扱業者に対するテ クに応じた対応状況について、経済制裁の迂回・潜脱等の検知を含め、リ\nロ資金の凍結に係 スクベースでの検査監督を強化する。\n6\nる検査監督の強化\n(4) NPOの悪用防止 NPOがテロ資金供与目的で悪用されることを防ぐため、ターゲットを絞っ 継続実施 内閣府、文科省、厚労省、\nたアウトリーチやモニタリングを継続する。 外務省、警察庁、財務省\nNPO に係る勧告 8 改訂及びそれを受けたメソドロジーの改訂を踏まえ、 令和７年度末 同上\n必要な対応を政府内で協議・実施する。\nIO.11 大量破壊兵器の拡散金融対策\n項目 行動内容 期限 担当府省庁等\n(1) 関係機関の連携強 遅滞なき資産凍結等の実施強化のため、迅速な制裁対象者情報の通知やベ 令和７年度末 外務省、財務省、経産省、\n化 ストプラクティスの共有など、関係省庁及び特定事業者との連携の枠組み 警察庁、特定事業者監督\nを強化する。 官庁\n(2) 拡散金融に係る事 外為法及び国際テロリスト等財産凍結法で対応すべき事項及びその具体的 令和７年度末 特定事業者監督官庁、財\n業者の理解の向上 な対応方法を特定事業者に対し周知することで、リスク理解の向上につな 務省、警察庁\nげる。\n(3) 外国為替取引等取 外国為替取引等取扱業者による拡散金融対策の態勢整備状況及びリスクに 令和７年度末 財務省\n扱業者に対する拡 応じた対応状況について、経済制裁の迂回・潜脱等の検知を含め、リスク\n散金融に係る検査 ベースでの検査監督を強化する。\n監督の強化\n7",
                        "000万円以上」では全生保が4.7件、民保が4.0件となっている。（図表Ⅰ－21）",
                        "000万円以上」では、全生保が3"
                    ],
                    "faithfulness_score": 1.0,
                    "relevancy_score": 0.0
                }
            ],
            "final_scores": {
                "average_faithfulness": 1.0,
                "average_answer_relevancy": 0.0
            },
            "token_usage": {
                "input_tokens": 10900,
                "output_tokens": 69
            },
            "total_cost": 0.243078,
            "model_name": "gpt-4o-mini"
        }
    ]
}
--- FILE: ./backend/rag_history/ebe6d547-6563-4e34-8eae-2c09ca770634.json ---
{
    "id": "ebe6d547-6563-4e34-8eae-2c09ca770634",
    "createdAt": "2025-08-17T12:53:56.408545+00:00",
    "qa_filename": "質問・正解(f).csv",
    "context_filename": "文脈(f).csv",
    "models_tested": [
        "gpt-4o-mini",
        "gemini-1.5-flash-latest"
    ],
    "advanced_options": {
        "chunking": false,
        "hybridSearch": true,
        "promptTuning": false
    },
    "num_questions": 1,
    "results": [
        {
            "results_by_question": [
                {
                    "question": "f.ドイツのサステナビリティ保証制度の実務訓練は何か月か？",
                    "ground_truth": "少なくとも8か月の実務訓練",
                    "generated_answer": "文脈情報には、ドイツのサステナビリティ保証制度の実務訓練に関する情報が含まれていないため、具体的な回答を提供することはできません。",
                    "retrieved_contexts": [
                        " the ML/TF risk associated with the life insurance sector is lower than that",
                        "2024年４月17日決定\nマネロン・テロ資金供与・拡散金融対策政策会議\nマネロン・テロ資金供与・拡散金融対策に関する行動計画（2024-2026 年度）\nIO.1 マネロン・テロ資金供与・拡散金融に係るリスクの認識・協調\n項目 行動内容 期限 担当府省庁等\n(1) ｢政策会議｣の体制 マネロンによる不正な資金の流れの複雑化・多様化に的確に対応するため、 令和６年度末 警察庁、財務省、金融庁、\n強化 マネロン・テロ資金供与・拡散金融対策政策会議（以下、「政策会議」）の 法務省、外務省、その他\n参加省庁拡大等により、｢政策会議｣の体制を強化する。 関係省庁\n(2) 「基本方針」等の進 マネロン・テロ資金供与・拡散金融対策の推進に関する基本方針（2022年 継続実施 同上\n捗管理及び更新 5 月 19 日決定・公表）（以下、「基本方針」）及び本行動計画の進捗状況を\n「政策会議」でフォローアップし、必要に応じ「基本方針」を更新する。\n我が国のマネロン・テロ資金供与・拡散金融対策(以下、｢マネロン等対策｣) 令和６年度末 同上\nの強化の進捗状況を的確に把握するため、FATF基準も踏まえ、適切な統計\nデータ等を特定し、継続的に把握する。\n関係省庁及び業界団体が緊密に連携し、マネロン等対策の強化に向けて取 令和８年度末 同上\nり組むため、次期「基本方針」等の検討において、民間有識者及び関係業\n界団体等の意見を聴取し、聴取した意見を反映させる。\n(3) 国内外情勢の変化 国内外の情勢変化等を踏まえタイムリーにリスク評価を見直すこととし、 継続実施 同上\n等を踏まえたタイ 犯罪収益移転危険度調査書については毎年、拡散金融リスク評価書につい\nムリーなリスク評 ては定期的に更新する。\n価の更新等 犯罪収益移転危険度調査書及び拡散金融リスク評価書等を踏まえ、定期的 継続実施 同上\nな意見交換等の場を設け、関係省庁間でリスク認識の向上につなげる。\nIO.２ 国際協力\n項目 行動内容 期限 担当府省庁等\n(1) 国際機関等との連 FATF、APG の活動支援等を通じ、国際的なマネロン等対策に貢献すると 継続実施 警察庁、財務省、外務省\n携強化 ともに、インターポール、エグモント・グループ等の国際機関等との連携\n1\n強化に取り組む。\n(2) 効果的かつ時機を 国際業務に従事する検察庁及び警察職員に対して、捜査共助・逃亡犯罪人 継続実施 法務省、警察庁\n得た捜査共助・逃亡 引渡に関するトレーニングを実施し、これら手続に対する理解を深め、積\n犯罪人引渡の実施 極的な活用につなげる。\n(3) 外国のカウンター JAFIC と外国 FIU の情報交換がより広範かつ効果的なものとなるよう、 継続実施 警察庁、外務省\nパートとの(2)以外 FIU 間の情報交換枠組みの一層の充実を図るとともに、活発な情報交換を\nの情報交換の促進 実施する。\n外国当局から要請された口座凍結に対し、適切な対応を推進する。 継続実施 同上\n監督当局等による他国のカウンターパートとのマネロン・テロ資金供与等 継続実施 金融庁、その他特定事業\nに関する情報交換を継続するとともに、必要に応じて更に発展させる。 者監督官庁\nIO.３ マネロン・テロ資金供与対策に係る金融機関・暗号資産交換業者（VASPs）の監督・予防措置\n項目 行動内容 期限 担当府省庁等\n(1) 金融機関等による マネロン・テロ資金供与対策に係る重要性等の周知徹底により、金融機関・ 継続実施 金融庁、その他金融機関\nリスクベースアプ 暗号資産交換業者（以下、「金融機関等」）のリスク理解を更に向上させ、 監督省庁\nローチに基づく取 リスク評価に基づくリスクベースの実効性ある取組を促す。また、必要に\n組の促進等 応じて、マネロン・テロ資金供与対策に関する検査監督ガイドラインを更\n新する。\n政府広報も活用して、官民が連携して国民の理解を促進しつつ、金融機関 継続実施 同上\n等による継続的な顧客情報管理に基づく顧客のリスク評価の取組を推進す\nる。\n(2) 監督当局による金 マネロン・テロ資金供与対策に関するノウハウの共有や共同研修の実施な 継続実施 同上\n融機関等に対する どの監督当局間連携の取組を推進するとともに、リスクベースアプローチ\nリスクベースアプ に基づくメリハリのある検査監督の取組を実践する。ブロックチェーンや\nローチに基づく検 暗号資産等を活用した技術による新たな金融商品・サービスを提供する金\n査監督の実践等 融機関等において、必要なリスク低減措置等が実施されるよう取り組む。\n2\nまた、金融機関等の取組を改善させるため、効果的かつ抑止力のある措置 継続実施 同上\nを実施する。\n(3) 取引モニタリング 為替取引分析業者の検査監督等を通じて、共同システムの安定運営を確保 継続実施 同上\n共同システムの充 しつつ、金融機関等による取引モニタリング等を強化する。\n実・効率化、金融機\n関等の取引モニタ\nリング等の強化\nIO.４ マネロン・テロ資金供与対策に係る特定非金融業者及び職業専門家（DNFBPs）の監督・予防措置\n項目 行動内容 期限 担当府省庁等\n(1) DNFBPs のリスク マネロン・テロ資金供与対策に関するガイドライン等の周知徹底により、 令和８年度末 DNFBPs監督官庁、警察\n理解向上とリスク DNFBPsのリスク理解を向上させ、適切なリスクベースアプローチに基づ 庁、財務省\nベースアプローチ く取組を促す。その上で、必要に応じて、ガイドラインの更新やガイドラ\nに基づく取組の促 インに関するよくある質問（FAQ）の策定を行う。\n進等 また、マネロン・テロ資金供与対策に関するガイドラインの実施期限を明\n確化する。\n取引モニタリングを強化するとともに、政府広報も活用して国民の理解を 令和８年度末 警察庁、財務省、DNFBPs\n促進しつつ、DNFBPsによる取引時確認及び継続的顧客管理の実効性を確 監督官庁\n保する。\n(2) 監 督 当 局 に よ る ｢政策会議｣等において、モニタリング手法や参考事例、ベストプラクティ 令和６年度末 同上\nDNFBPs に対する スを共有することにより、監督当局によるマネロン・テロ資金供与対策に\nリスクベースアプ 係るリスクベースでの検査監督を強化する。\nローチに基づく検 各業界団体と政府当局との定期協議の場を設けるとともに、関係省庁間で 令和６年度末 同上\n査監督の強化 連携して地方公共団体を含む担当者の能力向上のための研修プログラムを\n作成し、実施する。\n監督当局によるリスクベースでの検査監督を実施するため、モニタリング 令和７年度末 DNFBPs監督官庁、警察\n3\n方針を策定する。 庁、財務省\n(3) 疑わしい取引の届 疑わしい取引の届出の実効性を高めるため、必要に応じて、疑わしい取引 令和８年度末 警察庁、財務省、DNFBPs\n出の推進強化及び の参考事例を作成・更新するとともに、疑わしい取引参考事例の共有やア 監督官庁\n向上 ウトリーチの実施等によりDNFBPsの理解を深めることにより、疑わしい\n取引の届出の推進強化及び質・件数の向上につなげる。\nIO.５ 法人等の悪用防止\n項目 行動内容 期限 担当府省庁等\n(1) 法人の実質的支配 法人の実質的支配者情報に関する制度整備に向けた検討を推進しながら、 令和８年度末 法務省、財務省、警察庁、\n者情報に関する制 株式会社が自らの実質的支配者情報を特定するため、株主である他の株式 金融庁、経済産業省、そ\n度の改善と実効性 会社の実質的支配者リストを活用する方策を検討し、所要の措置を講じる。 の他特定事業者監督省\n向上 併せて、株式会社をはじめとする法人が自身の実質的支配者情報を把握す 庁、その他法人設立根拠\nることの重要性を周知する。 法所管省庁\n実質的支配者リスト制度の実効性を高めるため、引き続きその積極的な活\n用を政府として推進するとともに、金融機関等による直接の確認等の検討\nを含む制度の利便性向上や商業登記制度との連携による実質的支配者リス\nト制度の活用場面の確保にも取り組み、所要の措置を講じる。\n(2) 法人の実質的支配 特定事業者が保持する実質的支配者情報を十分、正確、最新な状態に保つ 令和８年度末 金融庁、警察庁、財務省、\n者情報への当局に ための措置を行うとともに、当局による当該情報への効率的なアクセスを 法務省、その他特定事業\nよるアクセス強化 確保する仕組みを検討し、導入する。 者監督省庁\n公証人が定款認証を通じて保有する実質的支配者情報への当局による照会\nについての対応を一層迅速化する。\n(3) 法人・信託に関する 外国で設立された法人や民事・外国信託について、日本においてマネロン 令和７年度末 警察庁、財務省、金融庁、\nリスク評価 等に悪用されるリスクの評価を行い、必要なリスク低減措置を検討する。 法務省\nIO.６ 特定金融情報の活用\n項目 行動内容 期限 担当府省庁等\n4\n(1) 疑わしい取引の届 JAFICの疑わしい取引の届出の分析にICT／AI技術を積極的に活用するこ 継続実施 警察庁\n出の分析の高度化 とにより、分析の実効性・効率性の向上につなげる。\n(2) 関係機関の連携強 JAFICからの情報提供の充実や、定期的な意見交換等の場を設け、関係機 継続実施 警察庁、特定事業者監督\n化 関との連携を強化する。 官庁\nIO.７ マネロンの捜査・訴追・制裁\n項目 行動内容 期限 担当府省庁等\n(1) リスクに応じたマ 高リスクと特定された前提犯罪について、とりわけ重大複雑な事案（外国 継続実施 法務省、警察庁\nネロン事案の捜査・ において前提犯罪が行われた場合を含む）に係るマネロンの捜査・訴追を\n訴追 推進するため、リスクの理解向上に努めるとともに、各種通達や研修のほ\nか、タスクフォースの枠組みに基づいて、関係省庁が連携して捜査・訴追\nに取り組む。\nマネロン罪の捜査や訴追における電子化の推進について検討し、所要の措 継続実施 同上\n置を講じる。\n(2) 効果的で均衡のと 各種通達や研修等に基づいて、マネロン罪について適切な量刑を確保する 継続実施 法務省\nれた抑止力のある べく取り組む。\n量刑の確保\nIO.８ 犯罪収益の没収\n項目 行動内容 期限 担当府省庁等\n(1) 捜査・没収の執行 犯罪収益や、マネロンに関連する犯罪供用物の押収・没収・追徴を適切に 継続実施 法務省、警察庁\n実施するため、リスクが高い分野に関する犯罪収益追跡捜査、保全措置及\nび没収・追徴を執行する。\nマネロン等に関連する現金等の国境での差し止め、現金等の輸出入情報の 継続実施 財務省、警察庁\n警察庁への共有及び官民連携した取締り等を引き続き行うとともに、カレ\nンシードッグの導入を始めとした新たな取締手法等、国境での取締り体制\n5\nの強化に取り組む。\n(2) 適切な口座凍結検 預貯金口座や暗号資産取引口座に関して、迅速かつ確実な凍結検討依頼を 継続実施 警察庁、金融庁\n討依頼の実施 行う。\n(3) 財産回復に係る勧 財産回復に係る勧告 4 及び勧告 38 の改訂並びにそれを受けたメソドロジ 令和8年度末 法務省、警察庁、財務省、\n告4及び38の改訂 ーの改訂を踏まえ、政府内で諸外国の制度調査等を行うとともに、国内に 金融庁\n対応 おける対応を協議のうえ、必要に応じ措置を講じる。\nIO.９ テロ資金の捜査・訴追・制裁\n項目 行動内容 期限 担当府省庁等\n(1) テロ資金等提供罪 テロ資金等提供罪の捜査や訴追における電子化の推進について検討し、所 継続実施 法務省、警察庁\nの捜査・訴追 要の措置を講じる。\n重大複雑なテロ資金供与の更なる捜査・訴追のため、タスクフォースの枠 継続実施 法務省、警察庁、その他\n組みや各種通達に基づいて、関係省庁が連携し、態勢整備も含め捜査・訴 関係省庁\n追の執行を強化する。また、必要に応じて、国内外のテロ資金供与の状況\n変化も踏まえた新たな取組を検討する。\nIO.10 テロ資金の凍結・NPOの悪用防止\n項目 行動内容 期限 担当府省庁等\n(1) 関係機関の連携強 遅滞なき資産凍結等の実施強化のため、迅速な制裁対象者情報の通知やベ 令和７年度末 外務省、財務省、経済産\n化 ストプラクティスの共有など、関係省庁及び特定事業者（金融機関等及び 業省、警察庁、特定事業\nDNFBPs）との連携の枠組みを強化する。 者監督官庁\n(2) テロ資金の凍結に 外為法及び国際テロリスト等財産凍結法で対応すべき事項及びその具体的 令和７年度末 特定事業者監督官庁、財\n係る事業者の理解 な対応方法を特定事業者に対し周知することで、リスク理解の向上につな 務省、警察庁\nの向上 げる。\n(3) 外国為替取引等取 外国為替取引等取扱業者によるテロ資金供与対策の態勢整備状況及びリス 令和７年度末 財務省\n扱業者に対するテ クに応じた対応状況について、経済制裁の迂回・潜脱等の検知を含め、リ\nロ資金の凍結に係 スクベースでの検査監督を強化する。\n6\nる検査監督の強化\n(4) NPOの悪用防止 NPOがテロ資金供与目的で悪用されることを防ぐため、ターゲットを絞っ 継続実施 内閣府、文科省、厚労省、\nたアウトリーチやモニタリングを継続する。 外務省、警察庁、財務省\nNPO に係る勧告 8 改訂及びそれを受けたメソドロジーの改訂を踏まえ、 令和７年度末 同上\n必要な対応を政府内で協議・実施する。\nIO.11 大量破壊兵器の拡散金融対策\n項目 行動内容 期限 担当府省庁等\n(1) 関係機関の連携強 遅滞なき資産凍結等の実施強化のため、迅速な制裁対象者情報の通知やベ 令和７年度末 外務省、財務省、経産省、\n化 ストプラクティスの共有など、関係省庁及び特定事業者との連携の枠組み 警察庁、特定事業者監督\nを強化する。 官庁\n(2) 拡散金融に係る事 外為法及び国際テロリスト等財産凍結法で対応すべき事項及びその具体的 令和７年度末 特定事業者監督官庁、財\n業者の理解の向上 な対応方法を特定事業者に対し周知することで、リスク理解の向上につな 務省、警察庁\nげる。\n(3) 外国為替取引等取 外国為替取引等取扱業者による拡散金融対策の態勢整備状況及びリスクに 令和７年度末 財務省\n扱業者に対する拡 応じた対応状況について、経済制裁の迂回・潜脱等の検知を含め、リスク\n散金融に係る検査 ベースでの検査監督を強化する。\n監督の強化\n7",
                        "984~2023~þÿ2023.4.1ÿ2024.3.31ÿo{rgwg",
                        "000万円以上」では全生保が4.7件、民保が4.0件となっている。（図表Ⅰ－21）",
                        "032 ÿ",
                        "000万円以上」では、全生保が3"
                    ],
                    "faithfulness_score": 1.0,
                    "relevancy_score": 0.0
                }
            ],
            "final_scores": {
                "average_faithfulness": 1.0,
                "average_answer_relevancy": 0.0
            },
            "token_usage": {
                "input_tokens": 11002,
                "output_tokens": 69
            },
            "total_cost": 0.2452965,
            "model_name": "gpt-4o-mini"
        },
        {
            "results_by_question": [
                {
                    "question": "f.ドイツのサステナビリティ保証制度の実務訓練は何か月か？",
                    "ground_truth": "少なくとも8か月の実務訓練",
                    "generated_answer": "この文章には、ドイツのサステナビリティ保証制度の実務訓練に関する情報は含まれていません。そのため、質問にお答えすることはできません。",
                    "retrieved_contexts": [
                        " the ML/TF risk associated with the life insurance sector is lower than that",
                        "2024年４月17日決定\nマネロン・テロ資金供与・拡散金融対策政策会議\nマネロン・テロ資金供与・拡散金融対策に関する行動計画（2024-2026 年度）\nIO.1 マネロン・テロ資金供与・拡散金融に係るリスクの認識・協調\n項目 行動内容 期限 担当府省庁等\n(1) ｢政策会議｣の体制 マネロンによる不正な資金の流れの複雑化・多様化に的確に対応するため、 令和６年度末 警察庁、財務省、金融庁、\n強化 マネロン・テロ資金供与・拡散金融対策政策会議（以下、「政策会議」）の 法務省、外務省、その他\n参加省庁拡大等により、｢政策会議｣の体制を強化する。 関係省庁\n(2) 「基本方針」等の進 マネロン・テロ資金供与・拡散金融対策の推進に関する基本方針（2022年 継続実施 同上\n捗管理及び更新 5 月 19 日決定・公表）（以下、「基本方針」）及び本行動計画の進捗状況を\n「政策会議」でフォローアップし、必要に応じ「基本方針」を更新する。\n我が国のマネロン・テロ資金供与・拡散金融対策(以下、｢マネロン等対策｣) 令和６年度末 同上\nの強化の進捗状況を的確に把握するため、FATF基準も踏まえ、適切な統計\nデータ等を特定し、継続的に把握する。\n関係省庁及び業界団体が緊密に連携し、マネロン等対策の強化に向けて取 令和８年度末 同上\nり組むため、次期「基本方針」等の検討において、民間有識者及び関係業\n界団体等の意見を聴取し、聴取した意見を反映させる。\n(3) 国内外情勢の変化 国内外の情勢変化等を踏まえタイムリーにリスク評価を見直すこととし、 継続実施 同上\n等を踏まえたタイ 犯罪収益移転危険度調査書については毎年、拡散金融リスク評価書につい\nムリーなリスク評 ては定期的に更新する。\n価の更新等 犯罪収益移転危険度調査書及び拡散金融リスク評価書等を踏まえ、定期的 継続実施 同上\nな意見交換等の場を設け、関係省庁間でリスク認識の向上につなげる。\nIO.２ 国際協力\n項目 行動内容 期限 担当府省庁等\n(1) 国際機関等との連 FATF、APG の活動支援等を通じ、国際的なマネロン等対策に貢献すると 継続実施 警察庁、財務省、外務省\n携強化 ともに、インターポール、エグモント・グループ等の国際機関等との連携\n1\n強化に取り組む。\n(2) 効果的かつ時機を 国際業務に従事する検察庁及び警察職員に対して、捜査共助・逃亡犯罪人 継続実施 法務省、警察庁\n得た捜査共助・逃亡 引渡に関するトレーニングを実施し、これら手続に対する理解を深め、積\n犯罪人引渡の実施 極的な活用につなげる。\n(3) 外国のカウンター JAFIC と外国 FIU の情報交換がより広範かつ効果的なものとなるよう、 継続実施 警察庁、外務省\nパートとの(2)以外 FIU 間の情報交換枠組みの一層の充実を図るとともに、活発な情報交換を\nの情報交換の促進 実施する。\n外国当局から要請された口座凍結に対し、適切な対応を推進する。 継続実施 同上\n監督当局等による他国のカウンターパートとのマネロン・テロ資金供与等 継続実施 金融庁、その他特定事業\nに関する情報交換を継続するとともに、必要に応じて更に発展させる。 者監督官庁\nIO.３ マネロン・テロ資金供与対策に係る金融機関・暗号資産交換業者（VASPs）の監督・予防措置\n項目 行動内容 期限 担当府省庁等\n(1) 金融機関等による マネロン・テロ資金供与対策に係る重要性等の周知徹底により、金融機関・ 継続実施 金融庁、その他金融機関\nリスクベースアプ 暗号資産交換業者（以下、「金融機関等」）のリスク理解を更に向上させ、 監督省庁\nローチに基づく取 リスク評価に基づくリスクベースの実効性ある取組を促す。また、必要に\n組の促進等 応じて、マネロン・テロ資金供与対策に関する検査監督ガイドラインを更\n新する。\n政府広報も活用して、官民が連携して国民の理解を促進しつつ、金融機関 継続実施 同上\n等による継続的な顧客情報管理に基づく顧客のリスク評価の取組を推進す\nる。\n(2) 監督当局による金 マネロン・テロ資金供与対策に関するノウハウの共有や共同研修の実施な 継続実施 同上\n融機関等に対する どの監督当局間連携の取組を推進するとともに、リスクベースアプローチ\nリスクベースアプ に基づくメリハリのある検査監督の取組を実践する。ブロックチェーンや\nローチに基づく検 暗号資産等を活用した技術による新たな金融商品・サービスを提供する金\n査監督の実践等 融機関等において、必要なリスク低減措置等が実施されるよう取り組む。\n2\nまた、金融機関等の取組を改善させるため、効果的かつ抑止力のある措置 継続実施 同上\nを実施する。\n(3) 取引モニタリング 為替取引分析業者の検査監督等を通じて、共同システムの安定運営を確保 継続実施 同上\n共同システムの充 しつつ、金融機関等による取引モニタリング等を強化する。\n実・効率化、金融機\n関等の取引モニタ\nリング等の強化\nIO.４ マネロン・テロ資金供与対策に係る特定非金融業者及び職業専門家（DNFBPs）の監督・予防措置\n項目 行動内容 期限 担当府省庁等\n(1) DNFBPs のリスク マネロン・テロ資金供与対策に関するガイドライン等の周知徹底により、 令和８年度末 DNFBPs監督官庁、警察\n理解向上とリスク DNFBPsのリスク理解を向上させ、適切なリスクベースアプローチに基づ 庁、財務省\nベースアプローチ く取組を促す。その上で、必要に応じて、ガイドラインの更新やガイドラ\nに基づく取組の促 インに関するよくある質問（FAQ）の策定を行う。\n進等 また、マネロン・テロ資金供与対策に関するガイドラインの実施期限を明\n確化する。\n取引モニタリングを強化するとともに、政府広報も活用して国民の理解を 令和８年度末 警察庁、財務省、DNFBPs\n促進しつつ、DNFBPsによる取引時確認及び継続的顧客管理の実効性を確 監督官庁\n保する。\n(2) 監 督 当 局 に よ る ｢政策会議｣等において、モニタリング手法や参考事例、ベストプラクティ 令和６年度末 同上\nDNFBPs に対する スを共有することにより、監督当局によるマネロン・テロ資金供与対策に\nリスクベースアプ 係るリスクベースでの検査監督を強化する。\nローチに基づく検 各業界団体と政府当局との定期協議の場を設けるとともに、関係省庁間で 令和６年度末 同上\n査監督の強化 連携して地方公共団体を含む担当者の能力向上のための研修プログラムを\n作成し、実施する。\n監督当局によるリスクベースでの検査監督を実施するため、モニタリング 令和７年度末 DNFBPs監督官庁、警察\n3\n方針を策定する。 庁、財務省\n(3) 疑わしい取引の届 疑わしい取引の届出の実効性を高めるため、必要に応じて、疑わしい取引 令和８年度末 警察庁、財務省、DNFBPs\n出の推進強化及び の参考事例を作成・更新するとともに、疑わしい取引参考事例の共有やア 監督官庁\n向上 ウトリーチの実施等によりDNFBPsの理解を深めることにより、疑わしい\n取引の届出の推進強化及び質・件数の向上につなげる。\nIO.５ 法人等の悪用防止\n項目 行動内容 期限 担当府省庁等\n(1) 法人の実質的支配 法人の実質的支配者情報に関する制度整備に向けた検討を推進しながら、 令和８年度末 法務省、財務省、警察庁、\n者情報に関する制 株式会社が自らの実質的支配者情報を特定するため、株主である他の株式 金融庁、経済産業省、そ\n度の改善と実効性 会社の実質的支配者リストを活用する方策を検討し、所要の措置を講じる。 の他特定事業者監督省\n向上 併せて、株式会社をはじめとする法人が自身の実質的支配者情報を把握す 庁、その他法人設立根拠\nることの重要性を周知する。 法所管省庁\n実質的支配者リスト制度の実効性を高めるため、引き続きその積極的な活\n用を政府として推進するとともに、金融機関等による直接の確認等の検討\nを含む制度の利便性向上や商業登記制度との連携による実質的支配者リス\nト制度の活用場面の確保にも取り組み、所要の措置を講じる。\n(2) 法人の実質的支配 特定事業者が保持する実質的支配者情報を十分、正確、最新な状態に保つ 令和８年度末 金融庁、警察庁、財務省、\n者情報への当局に ための措置を行うとともに、当局による当該情報への効率的なアクセスを 法務省、その他特定事業\nよるアクセス強化 確保する仕組みを検討し、導入する。 者監督省庁\n公証人が定款認証を通じて保有する実質的支配者情報への当局による照会\nについての対応を一層迅速化する。\n(3) 法人・信託に関する 外国で設立された法人や民事・外国信託について、日本においてマネロン 令和７年度末 警察庁、財務省、金融庁、\nリスク評価 等に悪用されるリスクの評価を行い、必要なリスク低減措置を検討する。 法務省\nIO.６ 特定金融情報の活用\n項目 行動内容 期限 担当府省庁等\n4\n(1) 疑わしい取引の届 JAFICの疑わしい取引の届出の分析にICT／AI技術を積極的に活用するこ 継続実施 警察庁\n出の分析の高度化 とにより、分析の実効性・効率性の向上につなげる。\n(2) 関係機関の連携強 JAFICからの情報提供の充実や、定期的な意見交換等の場を設け、関係機 継続実施 警察庁、特定事業者監督\n化 関との連携を強化する。 官庁\nIO.７ マネロンの捜査・訴追・制裁\n項目 行動内容 期限 担当府省庁等\n(1) リスクに応じたマ 高リスクと特定された前提犯罪について、とりわけ重大複雑な事案（外国 継続実施 法務省、警察庁\nネロン事案の捜査・ において前提犯罪が行われた場合を含む）に係るマネロンの捜査・訴追を\n訴追 推進するため、リスクの理解向上に努めるとともに、各種通達や研修のほ\nか、タスクフォースの枠組みに基づいて、関係省庁が連携して捜査・訴追\nに取り組む。\nマネロン罪の捜査や訴追における電子化の推進について検討し、所要の措 継続実施 同上\n置を講じる。\n(2) 効果的で均衡のと 各種通達や研修等に基づいて、マネロン罪について適切な量刑を確保する 継続実施 法務省\nれた抑止力のある べく取り組む。\n量刑の確保\nIO.８ 犯罪収益の没収\n項目 行動内容 期限 担当府省庁等\n(1) 捜査・没収の執行 犯罪収益や、マネロンに関連する犯罪供用物の押収・没収・追徴を適切に 継続実施 法務省、警察庁\n実施するため、リスクが高い分野に関する犯罪収益追跡捜査、保全措置及\nび没収・追徴を執行する。\nマネロン等に関連する現金等の国境での差し止め、現金等の輸出入情報の 継続実施 財務省、警察庁\n警察庁への共有及び官民連携した取締り等を引き続き行うとともに、カレ\nンシードッグの導入を始めとした新たな取締手法等、国境での取締り体制\n5\nの強化に取り組む。\n(2) 適切な口座凍結検 預貯金口座や暗号資産取引口座に関して、迅速かつ確実な凍結検討依頼を 継続実施 警察庁、金融庁\n討依頼の実施 行う。\n(3) 財産回復に係る勧 財産回復に係る勧告 4 及び勧告 38 の改訂並びにそれを受けたメソドロジ 令和8年度末 法務省、警察庁、財務省、\n告4及び38の改訂 ーの改訂を踏まえ、政府内で諸外国の制度調査等を行うとともに、国内に 金融庁\n対応 おける対応を協議のうえ、必要に応じ措置を講じる。\nIO.９ テロ資金の捜査・訴追・制裁\n項目 行動内容 期限 担当府省庁等\n(1) テロ資金等提供罪 テロ資金等提供罪の捜査や訴追における電子化の推進について検討し、所 継続実施 法務省、警察庁\nの捜査・訴追 要の措置を講じる。\n重大複雑なテロ資金供与の更なる捜査・訴追のため、タスクフォースの枠 継続実施 法務省、警察庁、その他\n組みや各種通達に基づいて、関係省庁が連携し、態勢整備も含め捜査・訴 関係省庁\n追の執行を強化する。また、必要に応じて、国内外のテロ資金供与の状況\n変化も踏まえた新たな取組を検討する。\nIO.10 テロ資金の凍結・NPOの悪用防止\n項目 行動内容 期限 担当府省庁等\n(1) 関係機関の連携強 遅滞なき資産凍結等の実施強化のため、迅速な制裁対象者情報の通知やベ 令和７年度末 外務省、財務省、経済産\n化 ストプラクティスの共有など、関係省庁及び特定事業者（金融機関等及び 業省、警察庁、特定事業\nDNFBPs）との連携の枠組みを強化する。 者監督官庁\n(2) テロ資金の凍結に 外為法及び国際テロリスト等財産凍結法で対応すべき事項及びその具体的 令和７年度末 特定事業者監督官庁、財\n係る事業者の理解 な対応方法を特定事業者に対し周知することで、リスク理解の向上につな 務省、警察庁\nの向上 げる。\n(3) 外国為替取引等取 外国為替取引等取扱業者によるテロ資金供与対策の態勢整備状況及びリス 令和７年度末 財務省\n扱業者に対するテ クに応じた対応状況について、経済制裁の迂回・潜脱等の検知を含め、リ\nロ資金の凍結に係 スクベースでの検査監督を強化する。\n6\nる検査監督の強化\n(4) NPOの悪用防止 NPOがテロ資金供与目的で悪用されることを防ぐため、ターゲットを絞っ 継続実施 内閣府、文科省、厚労省、\nたアウトリーチやモニタリングを継続する。 外務省、警察庁、財務省\nNPO に係る勧告 8 改訂及びそれを受けたメソドロジーの改訂を踏まえ、 令和７年度末 同上\n必要な対応を政府内で協議・実施する。\nIO.11 大量破壊兵器の拡散金融対策\n項目 行動内容 期限 担当府省庁等\n(1) 関係機関の連携強 遅滞なき資産凍結等の実施強化のため、迅速な制裁対象者情報の通知やベ 令和７年度末 外務省、財務省、経産省、\n化 ストプラクティスの共有など、関係省庁及び特定事業者との連携の枠組み 警察庁、特定事業者監督\nを強化する。 官庁\n(2) 拡散金融に係る事 外為法及び国際テロリスト等財産凍結法で対応すべき事項及びその具体的 令和７年度末 特定事業者監督官庁、財\n業者の理解の向上 な対応方法を特定事業者に対し周知することで、リスク理解の向上につな 務省、警察庁\nげる。\n(3) 外国為替取引等取 外国為替取引等取扱業者による拡散金融対策の態勢整備状況及びリスクに 令和７年度末 財務省\n扱業者に対する拡 応じた対応状況について、経済制裁の迂回・潜脱等の検知を含め、リスク\n散金融に係る検査 ベースでの検査監督を強化する。\n監督の強化\n7",
                        "984~2023~þÿ2023.4.1ÿ2024.3.31ÿo{rgwg",
                        "000万円以上」では全生保が4.7件、民保が4.0件となっている。（図表Ⅰ－21）",
                        "032 ÿ",
                        "000万円以上」では、全生保が3"
                    ],
                    "faithfulness_score": 1.0,
                    "relevancy_score": 0.0
                }
            ],
            "final_scores": {
                "average_faithfulness": 1.0,
                "average_answer_relevancy": 0.0
            },
            "token_usage": {
                "input_tokens": 5592,
                "output_tokens": 20
            },
            "total_cost": 0.28683899999999996,
            "model_name": "gemini-1.5-flash-latest"
        }
    ]
}
--- FILE: ./backend/rag_history/39bce19c-c109-4a56-9940-3f76b16dfdda.json ---
{
    "id": "39bce19c-c109-4a56-9940-3f76b16dfdda",
    "createdAt": "2025-08-17T12:58:06.418118+00:00",
    "qa_filename": "質問・正解(f).csv",
    "context_filename": "文脈(f).csv",
    "models_tested": [
        "gpt-4o-mini"
    ],
    "advanced_options": {
        "chunking": false,
        "hybridSearch": false,
        "promptTuning": false
    },
    "num_questions": 1,
    "results": [
        {
            "results_by_question": [
                {
                    "question": "f.ドイツのサステナビリティ保証制度の実務訓練は何か月か？",
                    "ground_truth": "少なくとも8か月の実務訓練",
                    "generated_answer": "文脈情報には、ドイツのサステナビリティ保証制度の実務訓練に関する情報が含まれていないため、具体的な回答を提供することはできません。",
                    "retrieved_contexts": [
                        "2024年４月17日決定\nマネロン・テロ資金供与・拡散金融対策政策会議\nマネロン・テロ資金供与・拡散金融対策に関する行動計画（2024-2026 年度）\nIO.1 マネロン・テロ資金供与・拡散金融に係るリスクの認識・協調\n項目 行動内容 期限 担当府省庁等\n(1) ｢政策会議｣の体制 マネロンによる不正な資金の流れの複雑化・多様化に的確に対応するため、 令和６年度末 警察庁、財務省、金融庁、\n強化 マネロン・テロ資金供与・拡散金融対策政策会議（以下、「政策会議」）の 法務省、外務省、その他\n参加省庁拡大等により、｢政策会議｣の体制を強化する。 関係省庁\n(2) 「基本方針」等の進 マネロン・テロ資金供与・拡散金融対策の推進に関する基本方針（2022年 継続実施 同上\n捗管理及び更新 5 月 19 日決定・公表）（以下、「基本方針」）及び本行動計画の進捗状況を\n「政策会議」でフォローアップし、必要に応じ「基本方針」を更新する。\n我が国のマネロン・テロ資金供与・拡散金融対策(以下、｢マネロン等対策｣) 令和６年度末 同上\nの強化の進捗状況を的確に把握するため、FATF基準も踏まえ、適切な統計\nデータ等を特定し、継続的に把握する。\n関係省庁及び業界団体が緊密に連携し、マネロン等対策の強化に向けて取 令和８年度末 同上\nり組むため、次期「基本方針」等の検討において、民間有識者及び関係業\n界団体等の意見を聴取し、聴取した意見を反映させる。\n(3) 国内外情勢の変化 国内外の情勢変化等を踏まえタイムリーにリスク評価を見直すこととし、 継続実施 同上\n等を踏まえたタイ 犯罪収益移転危険度調査書については毎年、拡散金融リスク評価書につい\nムリーなリスク評 ては定期的に更新する。\n価の更新等 犯罪収益移転危険度調査書及び拡散金融リスク評価書等を踏まえ、定期的 継続実施 同上\nな意見交換等の場を設け、関係省庁間でリスク認識の向上につなげる。\nIO.２ 国際協力\n項目 行動内容 期限 担当府省庁等\n(1) 国際機関等との連 FATF、APG の活動支援等を通じ、国際的なマネロン等対策に貢献すると 継続実施 警察庁、財務省、外務省\n携強化 ともに、インターポール、エグモント・グループ等の国際機関等との連携\n1\n強化に取り組む。\n(2) 効果的かつ時機を 国際業務に従事する検察庁及び警察職員に対して、捜査共助・逃亡犯罪人 継続実施 法務省、警察庁\n得た捜査共助・逃亡 引渡に関するトレーニングを実施し、これら手続に対する理解を深め、積\n犯罪人引渡の実施 極的な活用につなげる。\n(3) 外国のカウンター JAFIC と外国 FIU の情報交換がより広範かつ効果的なものとなるよう、 継続実施 警察庁、外務省\nパートとの(2)以外 FIU 間の情報交換枠組みの一層の充実を図るとともに、活発な情報交換を\nの情報交換の促進 実施する。\n外国当局から要請された口座凍結に対し、適切な対応を推進する。 継続実施 同上\n監督当局等による他国のカウンターパートとのマネロン・テロ資金供与等 継続実施 金融庁、その他特定事業\nに関する情報交換を継続するとともに、必要に応じて更に発展させる。 者監督官庁\nIO.３ マネロン・テロ資金供与対策に係る金融機関・暗号資産交換業者（VASPs）の監督・予防措置\n項目 行動内容 期限 担当府省庁等\n(1) 金融機関等による マネロン・テロ資金供与対策に係る重要性等の周知徹底により、金融機関・ 継続実施 金融庁、その他金融機関\nリスクベースアプ 暗号資産交換業者（以下、「金融機関等」）のリスク理解を更に向上させ、 監督省庁\nローチに基づく取 リスク評価に基づくリスクベースの実効性ある取組を促す。また、必要に\n組の促進等 応じて、マネロン・テロ資金供与対策に関する検査監督ガイドラインを更\n新する。\n政府広報も活用して、官民が連携して国民の理解を促進しつつ、金融機関 継続実施 同上\n等による継続的な顧客情報管理に基づく顧客のリスク評価の取組を推進す\nる。\n(2) 監督当局による金 マネロン・テロ資金供与対策に関するノウハウの共有や共同研修の実施な 継続実施 同上\n融機関等に対する どの監督当局間連携の取組を推進するとともに、リスクベースアプローチ\nリスクベースアプ に基づくメリハリのある検査監督の取組を実践する。ブロックチェーンや\nローチに基づく検 暗号資産等を活用した技術による新たな金融商品・サービスを提供する金\n査監督の実践等 融機関等において、必要なリスク低減措置等が実施されるよう取り組む。\n2\nまた、金融機関等の取組を改善させるため、効果的かつ抑止力のある措置 継続実施 同上\nを実施する。\n(3) 取引モニタリング 為替取引分析業者の検査監督等を通じて、共同システムの安定運営を確保 継続実施 同上\n共同システムの充 しつつ、金融機関等による取引モニタリング等を強化する。\n実・効率化、金融機\n関等の取引モニタ\nリング等の強化\nIO.４ マネロン・テロ資金供与対策に係る特定非金融業者及び職業専門家（DNFBPs）の監督・予防措置\n項目 行動内容 期限 担当府省庁等\n(1) DNFBPs のリスク マネロン・テロ資金供与対策に関するガイドライン等の周知徹底により、 令和８年度末 DNFBPs監督官庁、警察\n理解向上とリスク DNFBPsのリスク理解を向上させ、適切なリスクベースアプローチに基づ 庁、財務省\nベースアプローチ く取組を促す。その上で、必要に応じて、ガイドラインの更新やガイドラ\nに基づく取組の促 インに関するよくある質問（FAQ）の策定を行う。\n進等 また、マネロン・テロ資金供与対策に関するガイドラインの実施期限を明\n確化する。\n取引モニタリングを強化するとともに、政府広報も活用して国民の理解を 令和８年度末 警察庁、財務省、DNFBPs\n促進しつつ、DNFBPsによる取引時確認及び継続的顧客管理の実効性を確 監督官庁\n保する。\n(2) 監 督 当 局 に よ る ｢政策会議｣等において、モニタリング手法や参考事例、ベストプラクティ 令和６年度末 同上\nDNFBPs に対する スを共有することにより、監督当局によるマネロン・テロ資金供与対策に\nリスクベースアプ 係るリスクベースでの検査監督を強化する。\nローチに基づく検 各業界団体と政府当局との定期協議の場を設けるとともに、関係省庁間で 令和６年度末 同上\n査監督の強化 連携して地方公共団体を含む担当者の能力向上のための研修プログラムを\n作成し、実施する。\n監督当局によるリスクベースでの検査監督を実施するため、モニタリング 令和７年度末 DNFBPs監督官庁、警察\n3\n方針を策定する。 庁、財務省\n(3) 疑わしい取引の届 疑わしい取引の届出の実効性を高めるため、必要に応じて、疑わしい取引 令和８年度末 警察庁、財務省、DNFBPs\n出の推進強化及び の参考事例を作成・更新するとともに、疑わしい取引参考事例の共有やア 監督官庁\n向上 ウトリーチの実施等によりDNFBPsの理解を深めることにより、疑わしい\n取引の届出の推進強化及び質・件数の向上につなげる。\nIO.５ 法人等の悪用防止\n項目 行動内容 期限 担当府省庁等\n(1) 法人の実質的支配 法人の実質的支配者情報に関する制度整備に向けた検討を推進しながら、 令和８年度末 法務省、財務省、警察庁、\n者情報に関する制 株式会社が自らの実質的支配者情報を特定するため、株主である他の株式 金融庁、経済産業省、そ\n度の改善と実効性 会社の実質的支配者リストを活用する方策を検討し、所要の措置を講じる。 の他特定事業者監督省\n向上 併せて、株式会社をはじめとする法人が自身の実質的支配者情報を把握す 庁、その他法人設立根拠\nることの重要性を周知する。 法所管省庁\n実質的支配者リスト制度の実効性を高めるため、引き続きその積極的な活\n用を政府として推進するとともに、金融機関等による直接の確認等の検討\nを含む制度の利便性向上や商業登記制度との連携による実質的支配者リス\nト制度の活用場面の確保にも取り組み、所要の措置を講じる。\n(2) 法人の実質的支配 特定事業者が保持する実質的支配者情報を十分、正確、最新な状態に保つ 令和８年度末 金融庁、警察庁、財務省、\n者情報への当局に ための措置を行うとともに、当局による当該情報への効率的なアクセスを 法務省、その他特定事業\nよるアクセス強化 確保する仕組みを検討し、導入する。 者監督省庁\n公証人が定款認証を通じて保有する実質的支配者情報への当局による照会\nについての対応を一層迅速化する。\n(3) 法人・信託に関する 外国で設立された法人や民事・外国信託について、日本においてマネロン 令和７年度末 警察庁、財務省、金融庁、\nリスク評価 等に悪用されるリスクの評価を行い、必要なリスク低減措置を検討する。 法務省\nIO.６ 特定金融情報の活用\n項目 行動内容 期限 担当府省庁等\n4\n(1) 疑わしい取引の届 JAFICの疑わしい取引の届出の分析にICT／AI技術を積極的に活用するこ 継続実施 警察庁\n出の分析の高度化 とにより、分析の実効性・効率性の向上につなげる。\n(2) 関係機関の連携強 JAFICからの情報提供の充実や、定期的な意見交換等の場を設け、関係機 継続実施 警察庁、特定事業者監督\n化 関との連携を強化する。 官庁\nIO.７ マネロンの捜査・訴追・制裁\n項目 行動内容 期限 担当府省庁等\n(1) リスクに応じたマ 高リスクと特定された前提犯罪について、とりわけ重大複雑な事案（外国 継続実施 法務省、警察庁\nネロン事案の捜査・ において前提犯罪が行われた場合を含む）に係るマネロンの捜査・訴追を\n訴追 推進するため、リスクの理解向上に努めるとともに、各種通達や研修のほ\nか、タスクフォースの枠組みに基づいて、関係省庁が連携して捜査・訴追\nに取り組む。\nマネロン罪の捜査や訴追における電子化の推進について検討し、所要の措 継続実施 同上\n置を講じる。\n(2) 効果的で均衡のと 各種通達や研修等に基づいて、マネロン罪について適切な量刑を確保する 継続実施 法務省\nれた抑止力のある べく取り組む。\n量刑の確保\nIO.８ 犯罪収益の没収\n項目 行動内容 期限 担当府省庁等\n(1) 捜査・没収の執行 犯罪収益や、マネロンに関連する犯罪供用物の押収・没収・追徴を適切に 継続実施 法務省、警察庁\n実施するため、リスクが高い分野に関する犯罪収益追跡捜査、保全措置及\nび没収・追徴を執行する。\nマネロン等に関連する現金等の国境での差し止め、現金等の輸出入情報の 継続実施 財務省、警察庁\n警察庁への共有及び官民連携した取締り等を引き続き行うとともに、カレ\nンシードッグの導入を始めとした新たな取締手法等、国境での取締り体制\n5\nの強化に取り組む。\n(2) 適切な口座凍結検 預貯金口座や暗号資産取引口座に関して、迅速かつ確実な凍結検討依頼を 継続実施 警察庁、金融庁\n討依頼の実施 行う。\n(3) 財産回復に係る勧 財産回復に係る勧告 4 及び勧告 38 の改訂並びにそれを受けたメソドロジ 令和8年度末 法務省、警察庁、財務省、\n告4及び38の改訂 ーの改訂を踏まえ、政府内で諸外国の制度調査等を行うとともに、国内に 金融庁\n対応 おける対応を協議のうえ、必要に応じ措置を講じる。\nIO.９ テロ資金の捜査・訴追・制裁\n項目 行動内容 期限 担当府省庁等\n(1) テロ資金等提供罪 テロ資金等提供罪の捜査や訴追における電子化の推進について検討し、所 継続実施 法務省、警察庁\nの捜査・訴追 要の措置を講じる。\n重大複雑なテロ資金供与の更なる捜査・訴追のため、タスクフォースの枠 継続実施 法務省、警察庁、その他\n組みや各種通達に基づいて、関係省庁が連携し、態勢整備も含め捜査・訴 関係省庁\n追の執行を強化する。また、必要に応じて、国内外のテロ資金供与の状況\n変化も踏まえた新たな取組を検討する。\nIO.10 テロ資金の凍結・NPOの悪用防止\n項目 行動内容 期限 担当府省庁等\n(1) 関係機関の連携強 遅滞なき資産凍結等の実施強化のため、迅速な制裁対象者情報の通知やベ 令和７年度末 外務省、財務省、経済産\n化 ストプラクティスの共有など、関係省庁及び特定事業者（金融機関等及び 業省、警察庁、特定事業\nDNFBPs）との連携の枠組みを強化する。 者監督官庁\n(2) テロ資金の凍結に 外為法及び国際テロリスト等財産凍結法で対応すべき事項及びその具体的 令和７年度末 特定事業者監督官庁、財\n係る事業者の理解 な対応方法を特定事業者に対し周知することで、リスク理解の向上につな 務省、警察庁\nの向上 げる。\n(3) 外国為替取引等取 外国為替取引等取扱業者によるテロ資金供与対策の態勢整備状況及びリス 令和７年度末 財務省\n扱業者に対するテ クに応じた対応状況について、経済制裁の迂回・潜脱等の検知を含め、リ\nロ資金の凍結に係 スクベースでの検査監督を強化する。\n6\nる検査監督の強化\n(4) NPOの悪用防止 NPOがテロ資金供与目的で悪用されることを防ぐため、ターゲットを絞っ 継続実施 内閣府、文科省、厚労省、\nたアウトリーチやモニタリングを継続する。 外務省、警察庁、財務省\nNPO に係る勧告 8 改訂及びそれを受けたメソドロジーの改訂を踏まえ、 令和７年度末 同上\n必要な対応を政府内で協議・実施する。\nIO.11 大量破壊兵器の拡散金融対策\n項目 行動内容 期限 担当府省庁等\n(1) 関係機関の連携強 遅滞なき資産凍結等の実施強化のため、迅速な制裁対象者情報の通知やベ 令和７年度末 外務省、財務省、経産省、\n化 ストプラクティスの共有など、関係省庁及び特定事業者との連携の枠組み 警察庁、特定事業者監督\nを強化する。 官庁\n(2) 拡散金融に係る事 外為法及び国際テロリスト等財産凍結法で対応すべき事項及びその具体的 令和７年度末 特定事業者監督官庁、財\n業者の理解の向上 な対応方法を特定事業者に対し周知することで、リスク理解の向上につな 務省、警察庁\nげる。\n(3) 外国為替取引等取 外国為替取引等取扱業者による拡散金融対策の態勢整備状況及びリスクに 令和７年度末 財務省\n扱業者に対する拡 応じた対応状況について、経済制裁の迂回・潜脱等の検知を含め、リスク\n散金融に係る検査 ベースでの検査監督を強化する。\n監督の強化\n7",
                        "000万円以上」では全生保が4.7件、民保が4.0件となっている。（図表Ⅰ－21）",
                        "000万円以上」では、全生保が3"
                    ],
                    "faithfulness_score": 1.0,
                    "relevancy_score": 0.0
                }
            ],
            "final_scores": {
                "average_faithfulness": 1.0,
                "average_answer_relevancy": 0.0
            },
            "token_usage": {
                "input_tokens": 10900,
                "output_tokens": 69
            },
            "total_cost": 0.243078,
            "model_name": "gpt-4o-mini"
        }
    ]
}
--- FILE: ./backend/rag_history/f4a825b2-fe81-414d-8c11-12f318b42f44.json ---
{
    "id": "f4a825b2-fe81-414d-8c11-12f318b42f44",
    "createdAt": "2025-08-17T12:57:18.948760+00:00",
    "qa_filename": "質問・正解(f).csv",
    "context_filename": "文脈(f).csv",
    "models_tested": [
        "gpt-4o-mini"
    ],
    "advanced_options": {
        "chunking": false,
        "hybridSearch": false,
        "promptTuning": false
    },
    "num_questions": 1,
    "results": [
        {
            "results_by_question": [
                {
                    "question": "f.ドイツのサステナビリティ保証制度の実務訓練は何か月か？",
                    "ground_truth": "少なくとも8か月の実務訓練",
                    "generated_answer": "文脈情報には、ドイツのサステナビリティ保証制度の実務訓練に関する情報が含まれていないため、具体的な回答を提供することはできません。",
                    "retrieved_contexts": [
                        "2024年４月17日決定\nマネロン・テロ資金供与・拡散金融対策政策会議\nマネロン・テロ資金供与・拡散金融対策に関する行動計画（2024-2026 年度）\nIO.1 マネロン・テロ資金供与・拡散金融に係るリスクの認識・協調\n項目 行動内容 期限 担当府省庁等\n(1) ｢政策会議｣の体制 マネロンによる不正な資金の流れの複雑化・多様化に的確に対応するため、 令和６年度末 警察庁、財務省、金融庁、\n強化 マネロン・テロ資金供与・拡散金融対策政策会議（以下、「政策会議」）の 法務省、外務省、その他\n参加省庁拡大等により、｢政策会議｣の体制を強化する。 関係省庁\n(2) 「基本方針」等の進 マネロン・テロ資金供与・拡散金融対策の推進に関する基本方針（2022年 継続実施 同上\n捗管理及び更新 5 月 19 日決定・公表）（以下、「基本方針」）及び本行動計画の進捗状況を\n「政策会議」でフォローアップし、必要に応じ「基本方針」を更新する。\n我が国のマネロン・テロ資金供与・拡散金融対策(以下、｢マネロン等対策｣) 令和６年度末 同上\nの強化の進捗状況を的確に把握するため、FATF基準も踏まえ、適切な統計\nデータ等を特定し、継続的に把握する。\n関係省庁及び業界団体が緊密に連携し、マネロン等対策の強化に向けて取 令和８年度末 同上\nり組むため、次期「基本方針」等の検討において、民間有識者及び関係業\n界団体等の意見を聴取し、聴取した意見を反映させる。\n(3) 国内外情勢の変化 国内外の情勢変化等を踏まえタイムリーにリスク評価を見直すこととし、 継続実施 同上\n等を踏まえたタイ 犯罪収益移転危険度調査書については毎年、拡散金融リスク評価書につい\nムリーなリスク評 ては定期的に更新する。\n価の更新等 犯罪収益移転危険度調査書及び拡散金融リスク評価書等を踏まえ、定期的 継続実施 同上\nな意見交換等の場を設け、関係省庁間でリスク認識の向上につなげる。\nIO.２ 国際協力\n項目 行動内容 期限 担当府省庁等\n(1) 国際機関等との連 FATF、APG の活動支援等を通じ、国際的なマネロン等対策に貢献すると 継続実施 警察庁、財務省、外務省\n携強化 ともに、インターポール、エグモント・グループ等の国際機関等との連携\n1\n強化に取り組む。\n(2) 効果的かつ時機を 国際業務に従事する検察庁及び警察職員に対して、捜査共助・逃亡犯罪人 継続実施 法務省、警察庁\n得た捜査共助・逃亡 引渡に関するトレーニングを実施し、これら手続に対する理解を深め、積\n犯罪人引渡の実施 極的な活用につなげる。\n(3) 外国のカウンター JAFIC と外国 FIU の情報交換がより広範かつ効果的なものとなるよう、 継続実施 警察庁、外務省\nパートとの(2)以外 FIU 間の情報交換枠組みの一層の充実を図るとともに、活発な情報交換を\nの情報交換の促進 実施する。\n外国当局から要請された口座凍結に対し、適切な対応を推進する。 継続実施 同上\n監督当局等による他国のカウンターパートとのマネロン・テロ資金供与等 継続実施 金融庁、その他特定事業\nに関する情報交換を継続するとともに、必要に応じて更に発展させる。 者監督官庁\nIO.３ マネロン・テロ資金供与対策に係る金融機関・暗号資産交換業者（VASPs）の監督・予防措置\n項目 行動内容 期限 担当府省庁等\n(1) 金融機関等による マネロン・テロ資金供与対策に係る重要性等の周知徹底により、金融機関・ 継続実施 金融庁、その他金融機関\nリスクベースアプ 暗号資産交換業者（以下、「金融機関等」）のリスク理解を更に向上させ、 監督省庁\nローチに基づく取 リスク評価に基づくリスクベースの実効性ある取組を促す。また、必要に\n組の促進等 応じて、マネロン・テロ資金供与対策に関する検査監督ガイドラインを更\n新する。\n政府広報も活用して、官民が連携して国民の理解を促進しつつ、金融機関 継続実施 同上\n等による継続的な顧客情報管理に基づく顧客のリスク評価の取組を推進す\nる。\n(2) 監督当局による金 マネロン・テロ資金供与対策に関するノウハウの共有や共同研修の実施な 継続実施 同上\n融機関等に対する どの監督当局間連携の取組を推進するとともに、リスクベースアプローチ\nリスクベースアプ に基づくメリハリのある検査監督の取組を実践する。ブロックチェーンや\nローチに基づく検 暗号資産等を活用した技術による新たな金融商品・サービスを提供する金\n査監督の実践等 融機関等において、必要なリスク低減措置等が実施されるよう取り組む。\n2\nまた、金融機関等の取組を改善させるため、効果的かつ抑止力のある措置 継続実施 同上\nを実施する。\n(3) 取引モニタリング 為替取引分析業者の検査監督等を通じて、共同システムの安定運営を確保 継続実施 同上\n共同システムの充 しつつ、金融機関等による取引モニタリング等を強化する。\n実・効率化、金融機\n関等の取引モニタ\nリング等の強化\nIO.４ マネロン・テロ資金供与対策に係る特定非金融業者及び職業専門家（DNFBPs）の監督・予防措置\n項目 行動内容 期限 担当府省庁等\n(1) DNFBPs のリスク マネロン・テロ資金供与対策に関するガイドライン等の周知徹底により、 令和８年度末 DNFBPs監督官庁、警察\n理解向上とリスク DNFBPsのリスク理解を向上させ、適切なリスクベースアプローチに基づ 庁、財務省\nベースアプローチ く取組を促す。その上で、必要に応じて、ガイドラインの更新やガイドラ\nに基づく取組の促 インに関するよくある質問（FAQ）の策定を行う。\n進等 また、マネロン・テロ資金供与対策に関するガイドラインの実施期限を明\n確化する。\n取引モニタリングを強化するとともに、政府広報も活用して国民の理解を 令和８年度末 警察庁、財務省、DNFBPs\n促進しつつ、DNFBPsによる取引時確認及び継続的顧客管理の実効性を確 監督官庁\n保する。\n(2) 監 督 当 局 に よ る ｢政策会議｣等において、モニタリング手法や参考事例、ベストプラクティ 令和６年度末 同上\nDNFBPs に対する スを共有することにより、監督当局によるマネロン・テロ資金供与対策に\nリスクベースアプ 係るリスクベースでの検査監督を強化する。\nローチに基づく検 各業界団体と政府当局との定期協議の場を設けるとともに、関係省庁間で 令和６年度末 同上\n査監督の強化 連携して地方公共団体を含む担当者の能力向上のための研修プログラムを\n作成し、実施する。\n監督当局によるリスクベースでの検査監督を実施するため、モニタリング 令和７年度末 DNFBPs監督官庁、警察\n3\n方針を策定する。 庁、財務省\n(3) 疑わしい取引の届 疑わしい取引の届出の実効性を高めるため、必要に応じて、疑わしい取引 令和８年度末 警察庁、財務省、DNFBPs\n出の推進強化及び の参考事例を作成・更新するとともに、疑わしい取引参考事例の共有やア 監督官庁\n向上 ウトリーチの実施等によりDNFBPsの理解を深めることにより、疑わしい\n取引の届出の推進強化及び質・件数の向上につなげる。\nIO.５ 法人等の悪用防止\n項目 行動内容 期限 担当府省庁等\n(1) 法人の実質的支配 法人の実質的支配者情報に関する制度整備に向けた検討を推進しながら、 令和８年度末 法務省、財務省、警察庁、\n者情報に関する制 株式会社が自らの実質的支配者情報を特定するため、株主である他の株式 金融庁、経済産業省、そ\n度の改善と実効性 会社の実質的支配者リストを活用する方策を検討し、所要の措置を講じる。 の他特定事業者監督省\n向上 併せて、株式会社をはじめとする法人が自身の実質的支配者情報を把握す 庁、その他法人設立根拠\nることの重要性を周知する。 法所管省庁\n実質的支配者リスト制度の実効性を高めるため、引き続きその積極的な活\n用を政府として推進するとともに、金融機関等による直接の確認等の検討\nを含む制度の利便性向上や商業登記制度との連携による実質的支配者リス\nト制度の活用場面の確保にも取り組み、所要の措置を講じる。\n(2) 法人の実質的支配 特定事業者が保持する実質的支配者情報を十分、正確、最新な状態に保つ 令和８年度末 金融庁、警察庁、財務省、\n者情報への当局に ための措置を行うとともに、当局による当該情報への効率的なアクセスを 法務省、その他特定事業\nよるアクセス強化 確保する仕組みを検討し、導入する。 者監督省庁\n公証人が定款認証を通じて保有する実質的支配者情報への当局による照会\nについての対応を一層迅速化する。\n(3) 法人・信託に関する 外国で設立された法人や民事・外国信託について、日本においてマネロン 令和７年度末 警察庁、財務省、金融庁、\nリスク評価 等に悪用されるリスクの評価を行い、必要なリスク低減措置を検討する。 法務省\nIO.６ 特定金融情報の活用\n項目 行動内容 期限 担当府省庁等\n4\n(1) 疑わしい取引の届 JAFICの疑わしい取引の届出の分析にICT／AI技術を積極的に活用するこ 継続実施 警察庁\n出の分析の高度化 とにより、分析の実効性・効率性の向上につなげる。\n(2) 関係機関の連携強 JAFICからの情報提供の充実や、定期的な意見交換等の場を設け、関係機 継続実施 警察庁、特定事業者監督\n化 関との連携を強化する。 官庁\nIO.７ マネロンの捜査・訴追・制裁\n項目 行動内容 期限 担当府省庁等\n(1) リスクに応じたマ 高リスクと特定された前提犯罪について、とりわけ重大複雑な事案（外国 継続実施 法務省、警察庁\nネロン事案の捜査・ において前提犯罪が行われた場合を含む）に係るマネロンの捜査・訴追を\n訴追 推進するため、リスクの理解向上に努めるとともに、各種通達や研修のほ\nか、タスクフォースの枠組みに基づいて、関係省庁が連携して捜査・訴追\nに取り組む。\nマネロン罪の捜査や訴追における電子化の推進について検討し、所要の措 継続実施 同上\n置を講じる。\n(2) 効果的で均衡のと 各種通達や研修等に基づいて、マネロン罪について適切な量刑を確保する 継続実施 法務省\nれた抑止力のある べく取り組む。\n量刑の確保\nIO.８ 犯罪収益の没収\n項目 行動内容 期限 担当府省庁等\n(1) 捜査・没収の執行 犯罪収益や、マネロンに関連する犯罪供用物の押収・没収・追徴を適切に 継続実施 法務省、警察庁\n実施するため、リスクが高い分野に関する犯罪収益追跡捜査、保全措置及\nび没収・追徴を執行する。\nマネロン等に関連する現金等の国境での差し止め、現金等の輸出入情報の 継続実施 財務省、警察庁\n警察庁への共有及び官民連携した取締り等を引き続き行うとともに、カレ\nンシードッグの導入を始めとした新たな取締手法等、国境での取締り体制\n5\nの強化に取り組む。\n(2) 適切な口座凍結検 預貯金口座や暗号資産取引口座に関して、迅速かつ確実な凍結検討依頼を 継続実施 警察庁、金融庁\n討依頼の実施 行う。\n(3) 財産回復に係る勧 財産回復に係る勧告 4 及び勧告 38 の改訂並びにそれを受けたメソドロジ 令和8年度末 法務省、警察庁、財務省、\n告4及び38の改訂 ーの改訂を踏まえ、政府内で諸外国の制度調査等を行うとともに、国内に 金融庁\n対応 おける対応を協議のうえ、必要に応じ措置を講じる。\nIO.９ テロ資金の捜査・訴追・制裁\n項目 行動内容 期限 担当府省庁等\n(1) テロ資金等提供罪 テロ資金等提供罪の捜査や訴追における電子化の推進について検討し、所 継続実施 法務省、警察庁\nの捜査・訴追 要の措置を講じる。\n重大複雑なテロ資金供与の更なる捜査・訴追のため、タスクフォースの枠 継続実施 法務省、警察庁、その他\n組みや各種通達に基づいて、関係省庁が連携し、態勢整備も含め捜査・訴 関係省庁\n追の執行を強化する。また、必要に応じて、国内外のテロ資金供与の状況\n変化も踏まえた新たな取組を検討する。\nIO.10 テロ資金の凍結・NPOの悪用防止\n項目 行動内容 期限 担当府省庁等\n(1) 関係機関の連携強 遅滞なき資産凍結等の実施強化のため、迅速な制裁対象者情報の通知やベ 令和７年度末 外務省、財務省、経済産\n化 ストプラクティスの共有など、関係省庁及び特定事業者（金融機関等及び 業省、警察庁、特定事業\nDNFBPs）との連携の枠組みを強化する。 者監督官庁\n(2) テロ資金の凍結に 外為法及び国際テロリスト等財産凍結法で対応すべき事項及びその具体的 令和７年度末 特定事業者監督官庁、財\n係る事業者の理解 な対応方法を特定事業者に対し周知することで、リスク理解の向上につな 務省、警察庁\nの向上 げる。\n(3) 外国為替取引等取 外国為替取引等取扱業者によるテロ資金供与対策の態勢整備状況及びリス 令和７年度末 財務省\n扱業者に対するテ クに応じた対応状況について、経済制裁の迂回・潜脱等の検知を含め、リ\nロ資金の凍結に係 スクベースでの検査監督を強化する。\n6\nる検査監督の強化\n(4) NPOの悪用防止 NPOがテロ資金供与目的で悪用されることを防ぐため、ターゲットを絞っ 継続実施 内閣府、文科省、厚労省、\nたアウトリーチやモニタリングを継続する。 外務省、警察庁、財務省\nNPO に係る勧告 8 改訂及びそれを受けたメソドロジーの改訂を踏まえ、 令和７年度末 同上\n必要な対応を政府内で協議・実施する。\nIO.11 大量破壊兵器の拡散金融対策\n項目 行動内容 期限 担当府省庁等\n(1) 関係機関の連携強 遅滞なき資産凍結等の実施強化のため、迅速な制裁対象者情報の通知やベ 令和７年度末 外務省、財務省、経産省、\n化 ストプラクティスの共有など、関係省庁及び特定事業者との連携の枠組み 警察庁、特定事業者監督\nを強化する。 官庁\n(2) 拡散金融に係る事 外為法及び国際テロリスト等財産凍結法で対応すべき事項及びその具体的 令和７年度末 特定事業者監督官庁、財\n業者の理解の向上 な対応方法を特定事業者に対し周知することで、リスク理解の向上につな 務省、警察庁\nげる。\n(3) 外国為替取引等取 外国為替取引等取扱業者による拡散金融対策の態勢整備状況及びリスクに 令和７年度末 財務省\n扱業者に対する拡 応じた対応状況について、経済制裁の迂回・潜脱等の検知を含め、リスク\n散金融に係る検査 ベースでの検査監督を強化する。\n監督の強化\n7",
                        "000万円以上」では全生保が4.7件、民保が4.0件となっている。（図表Ⅰ－21）",
                        "000万円以上」では、全生保が3"
                    ],
                    "faithfulness_score": 1.0,
                    "relevancy_score": 0.0
                }
            ],
            "final_scores": {
                "average_faithfulness": 1.0,
                "average_answer_relevancy": 0.0
            },
            "token_usage": {
                "input_tokens": 10900,
                "output_tokens": 69
            },
            "total_cost": 0.243078,
            "model_name": "gpt-4o-mini"
        }
    ]
}
--- FILE: ./backend/legacy_rag_app/rag_pipeline.py ---
# rag_pipeline.py
from langchain_core.prompts import ChatPromptTemplate
from langchain_core.runnables import RunnablePassthrough
from langchain_core.output_parsers import StrOutputParser
from langchain.callbacks import get_openai_callback
from models import get_llm_instance
from config import MODEL_COSTS

def format_docs(docs):
    """検索されたドキュメントを文字列にフォーマットする"""
    return "\n\n".join(doc.page_content for doc in docs)

def run_rag_pipeline(retriever, model_name: str, question: str):
    """
    本格的なRAGパイプラインを実行し、回答、文脈、コストを返す。
    
    Args:
        retriever: LangChainのretrieverオブジェクト。
        model_name (str): 使用するモデルの名前。
        question (str): ユーザーの質問。
        
    Returns:
        tuple[str, str, float]: (生成された回答, 検索された文脈, 概算コスト)
    """
    llm = get_llm_instance(model_name)
    
    template = """
    あなたは親切なアシスタントです。以下の文脈情報のみを使って、最後の質問に答えてください。
    文脈情報で答えがわからない場合は、その旨を正直に伝えてください。

    文脈:
    {context}

    質問: {question}
    """
    prompt = ChatPromptTemplate.from_template(template)

    # LCELを使ってチェーンを構築
    rag_chain = (
        {"context": retriever | format_docs, "question": RunnablePassthrough()}
        | prompt
        | llm
        | StrOutputParser()
    )

    # 回答と一緒に文脈も取得するためのチェーン
    # retrieverを2回呼ばないように、最初にretrieverの結果を保持する
    chain_with_context = RunnablePassthrough.assign(
        contexts_docs=lambda x: retriever.invoke(x["question"])
    ).assign(
        answer=lambda x: (
            {"context": format_docs(x["contexts_docs"]), "question": x["question"]}
            | prompt
            | llm
            | StrOutputParser()
        )
    )
    
    cost = 0.0
    # get_openai_callbackはOpenAIモデルでのみトークン数を正確に取得できる
    # 他モデルのコスト計算は概算または別途実装が必要
    with get_openai_callback() as cb:
        result = chain_with_context.invoke({"question": question})
        
        # コスト計算
        model_cost = MODEL_COSTS.get(model_name, {"input": 0, "output": 0})
        cost = (cb.prompt_tokens * model_cost["input"] / 1000) + \
               (cb.completion_tokens * model_cost["output"] / 1000)

    contexts_str = format_docs(result["contexts_docs"])
    return result["answer"], contexts_str, cost

--- FILE: ./backend/legacy_rag_app/agent_setup.py ---
# agent_setup.py
from langchain.agents import create_openai_functions_agent, AgentExecutor
from langchain_core.prompts import ChatPromptTemplate, MessagesPlaceholder
from langchain.memory import ConversationBufferMemory

# 修正：get_llm_instanceのみをインポートする
from models import get_llm_instance

def initialize_agent_executor(state, model_name: str, tools: list):
    """
    指定されたモデル名でLangChainエージェントを初期化します。
    """
    if state is None:
        raise ValueError("アプリケーションの状態が初期化されていません。")

    # LLMの初期化ロジックを簡潔化
    try:
        # 修正：get_llm_instanceを呼び出すだけにする
        llm = get_llm_instance(model_name)
    except Exception as e:
        raise ValueError(f"LLMの初期化に失敗しました: {e}")

    # プロンプトの作成 (変更なし)
    prompt = ChatPromptTemplate.from_messages([
        ("system", """あなたはRAG評価の結果データを分析するAIアシスタントです。
        以下のツールを適切に使い分け、ユーザーからの依頼に答えてください。
        - 質問には簡潔かつ明確に答えること。
        - グラフや分析結果を要求されたら、必ず対応するツールを呼び出すこと。
        - RAG構成の変更を指示されたら、'update_rag_config'ツールを使用して、次の評価からその設定が反映されるように変更すること。
        - ユーザーが評価の実行を依頼した場合、`run_evaluation_for_agent`ツールを呼び出すこと。
        """),
        MessagesPlaceholder("chat_history", optional=True),
        ("human", "{input}"),
        MessagesPlaceholder("agent_scratchpad"),
    ])
    
    # エージェントの作成 (変更なし)
    agent = create_openai_functions_agent(llm, tools, prompt)
    
    # Executorの作成 (変更なし)
    executor = AgentExecutor(
        agent=agent,
        tools=tools,
        verbose=True,
        memory=ConversationBufferMemory(
            memory_key="chat_history", 
            return_messages=True,
            chat_history=state.agent_memory_messages
        ),
        handle_parsing_errors=True
    )
    return executor

--- FILE: ./backend/legacy_rag_app/gradio_ui.py ---
# gradio_ui.py
import gradio as gr
from config import RAG_CONFIG_OPTIONS, EVAL_MODEL_OPTIONS, AGENT_MODEL_OPTIONS, DF_HEADERS
import japanize_matplotlib

def create_ui_tabs():
    """Gradio UIのタブ構成とコンポーネントを定義する"""
    japanize_matplotlib.japanize()
    ui_components = {}

    with gr.Blocks(theme=gr.themes.Base()) as ui_tabs_block:
        gr.Markdown("# LLM RAG 評価・検証 & AIエージェント Playground")
        gr.Markdown("このアプリケーションは、RAG (Retrieval-Augmented Generation) パイプラインの性能を評価・検証し、AIアシスタントと対話するための統合ツールです。")

        with gr.Tab("RAG評価"):
            gr.Markdown("## RAGパイプラインの評価")
            with gr.Row():
                with gr.Column(scale=1):
                    with gr.Accordion("質問と文脈データのロード", open=True):
                        ui_components["csv_qna_input"] = gr.File(label="評価用CSV (qna.csv) をアップロード", file_types=[".csv"])
                        ui_components["csv_docs_input"] = gr.File(label="ドキュメントCSV (docs.csv) をアップロード", file_types=[".csv"])
                        ui_components["csv_load_status"] = gr.Textbox(label="ステータス", interactive=False)
                    ui_components["reset_btn"] = gr.Button("全履歴とデータをクリア", variant="secondary")

                with gr.Column(scale=2):
                    with gr.Accordion("評価設定と実行", open=True):
                        gr.Markdown("### 評価設定")
                        ui_components["model_dropdown"] = gr.Dropdown(label="モデルを選択", choices=EVAL_MODEL_OPTIONS, interactive=True)
                        with gr.Row():
                            ui_components["rag_config"] = gr.CheckboxGroup(label="RAG構成オプションを選択", choices=RAG_CONFIG_OPTIONS, value=[], interactive=True)
                            ui_components["select_all_rag_btn"] = gr.Button("全RAG構成を選択/選択解除")
                        ui_components["set_rag_config_btn"] = gr.Button("RAG構成を確定", variant="primary")
                        ui_components["current_rag_config_label"] = gr.Textbox(label="現在のRAG構成", interactive=False, value="Simple")
                        
            gr.Markdown("### 単体評価")
            with gr.Row():
                ui_components["question_dropdown"] = gr.Dropdown(label="評価したい質問を選択", interactive=True)
                ui_components["eval_btn"] = gr.Button("単体評価を実行", variant="primary")
            with gr.Row():
                ui_components["question_display"] = gr.Textbox(label="質問文", interactive=False)
                ui_components["answer_text"] = gr.Textbox(label="正解", interactive=False)
            with gr.Row():
                ui_components["generated_text"] = gr.Textbox(label="生成された回答", interactive=False, lines=5)
            with gr.Row():
                ui_components["eval_result"] = gr.Textbox(label="最終評価", interactive=False)
                ui_components["eval_detail"] = gr.Textbox(label="詳細スコア", interactive=False)

            gr.Markdown("### 一括評価")
            with gr.Row():
                ui_components["question_multi_dropdown"] = gr.CheckboxGroup(label="評価対象の質問を選択", interactive=True)
            with gr.Row():
                ui_components["select_all_questions_btn"] = gr.Button("全質問を選択/選択解除")
                ui_components["multi_eval_btn"] = gr.Button("一括評価を実行", variant="primary")
            ui_components["multi_eval_status"] = gr.Textbox(label="一括評価ステータス", interactive=False)

        with gr.Tab("評価履歴と分析"):
            gr.Markdown("## 評価結果の分析")
            with gr.Row():
                gr.Markdown("### 評価履歴")
                ui_components["eval_count"] = gr.Textbox(label="評価数", interactive=False, value="0")
            with gr.Row():
                ui_components["save_csv_btn"] = gr.Button("履歴をCSVで保存", variant="secondary")
                ui_components["csv_save_file"] = gr.File(label="保存されたファイル", visible=False)
                ui_components["csv_save_status"] = gr.Textbox(label="保存ステータス", interactive=False)

            ui_components["history_df_display"] = gr.DataFrame(headers=DF_HEADERS, interactive=False, wrap=True)

            gr.Markdown("### フィルタリング")
            with gr.Row():
                ui_components["filter_model"] = gr.Dropdown(label="モデル", choices=["All"] + EVAL_MODEL_OPTIONS, value="All", interactive=True)
                ui_components["filter_config"] = gr.Dropdown(label="RAG構成", choices=["All"] + RAG_CONFIG_OPTIONS, value="All", interactive=True)
                ui_components["filter_final"] = gr.Dropdown(label="最終判定", choices=["All", "O", "X"], value="All", interactive=True)

            gr.Markdown("### グラフ分析")
            with gr.Row():
                ui_components["graph_3d_btn"] = gr.Button("3Dスコアプロットを生成", variant="primary")
                ui_components["graph_3d_out"] = gr.Plot()
            with gr.Row():
                ui_components["group_analysis_btn"] = gr.Button("グループ別分析グラフを生成", variant="primary")
                ui_components["group_model_plot_out"] = gr.Plot()
                ui_components["group_config_plot_out"] = gr.Plot()

        with gr.Tab("AIアシスタント"):
            gr.Markdown("## 評価データと対話するAIアシスタント")
            with gr.Row():
                ui_components["agent_model_dropdown"] = gr.Dropdown(label="エージェントモデルを選択", choices=AGENT_MODEL_OPTIONS, interactive=True)
                ui_components["init_agent_btn"] = gr.Button("エージェントを初期化", variant="primary")
            ui_components["agent_status_output"] = gr.Textbox(label="エージェントステータス", interactive=False, value="エージェントは初期化されていません。")
            ui_components["agent_chat_history_display"] = gr.Chatbot(label="対話履歴", type='messages', height=400)
            with gr.Row():
                ui_components["agent_query_input"] = gr.Textbox(label="質問を送信", interactive=True)
                ui_components["send_agent_btn"] = gr.Button("送信", variant="primary")
            ui_components["clear_agent_chat_btn"] = gr.Button("チャットをクリア")

    ui_components["ui_tabs_block"] = ui_tabs_block
    return ui_components

--- FILE: ./backend/legacy_rag_app/config.py ---
# backend/config.py
import os
from dotenv import load_dotenv

# .envファイルから環境変数を読み込む（ローカル開発用）
load_dotenv()

# APIキーを環境変数から取得
OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")
GOOGLE_API_KEY = os.getenv("GOOGLE_API_KEY")
ANTHROPIC_API_KEY = os.getenv("ANTHROPIC_API_KEY")

# ★★★★★★★★★★★★★★★★★★★★★★★★★★★★
# ★ 修正点：Hugging Faceのトークンを環境変数から取得する行を追加
# ★★★★★★★★★★★★★★★★★★★★★★★★★★★★
HUGGING_FACE_HUB_TOKEN = os.getenv("HUGGING_FACE_HUB_TOKEN")


# モデルごとのコスト情報（1000トークンあたりのドル価格）
MODEL_COSTS = {
    "gpt-4o-mini": {"input": 0.00015, "output": 0.0006},
    "gpt-4o": {"input": 0.005, "output": 0.015},
    "gpt-4-turbo": {"input": 0.01, "output": 0.03},
    "gemini-1.5-pro-latest": {"input": 0.0035, "output": 0.0105},
    "gemini-1.5-flash-latest": {"input": 0.00035, "output": 0.00105},
    "claude-3-opus-20240229": {"input": 0.015, "output": 0.075},
    "claude-3-sonnet-20240229": {"input": 0.003, "output": 0.015},
    "claude-3-haiku-20240307": {"input": 0.00025, "output": 0.00125},
}
--- FILE: ./backend/legacy_rag_app/handlers.py ---
# handlers.py
import pandas as pd
import io
import datetime
import chardet
import gradio as gr
from datasets import Dataset
from sqlalchemy.orm import Session

# LangChain & RAG
from langchain_community.vectorstores import Chroma
from langchain_text_splitters import RecursiveCharacterTextSplitter
from langchain.embeddings import SentenceTransformerEmbeddings

# Ragas
from ragas import evaluate
from ragas.metrics import faithfulness, answer_relevancy, context_precision, context_recall

# ローカルモジュール
import database
from rag_pipeline import run_rag_pipeline
from utils import tonic_similarity, cosine_sim, llm_evaluate, plot_3d_scores, plot_group_analysis
from config import DF_HEADERS, COSINE_THRESHOLD
from agent_setup import initialize_agent_executor
from agent_tools import AgentToolsManager

# --- DBセッション管理 ---
def get_db():
    db = database.SessionLocal()
    try: yield db
    finally: db.close()

# --- 最終判定ロジック ---
def determine_final_judgement(ragas_score, cosine_score):
    if ragas_score.get('faithfulness', 0) >= 0.8 and \
       ragas_score.get('answer_relevancy', 0) >= 0.8 and \
       cosine_score >= COSINE_THRESHOLD:
        return "O"
    return "X"

# --- ファイル読み込みとベクトルストア構築 ---
def handle_csv_qna_upload(state, f):
    if f is None: return gr.update(), gr.update(), "ファイルが選択されていません。"
    try:
        byte_data = f.read()
        encoding = chardet.detect(byte_data)['encoding']
        df = pd.read_csv(io.BytesIO(byte_data), encoding=encoding)
        df.columns = [col.strip() for col in df.columns]
        if not all(col in df.columns for col in ["質問", "正解"]): raise ValueError("CSVに『質問』『正解』列が必要です。")
        
        state.df_qna = df
        questions = df["質問"].dropna().astype(str).tolist()
        return gr.update(choices=questions, value=None), gr.update(choices=questions, value=[]), "質問CSVが正常にロードされました。"
    except Exception as e:
        return gr.update(choices=[], value=None), gr.update(choices=[], value=[]), f"エラー: {e}"

def handle_csv_docs_upload(state, f):
    if f is None: return "ファイルが選択されていません。"
    try:
        byte_data = f.read()
        encoding = chardet.detect(byte_data)['encoding']
        df = pd.read_csv(io.BytesIO(byte_data), encoding=encoding)
        documents = [row['内容'] for _, row in df.iterrows()]
        
        text_splitter = RecursiveCharacterTextSplitter(chunk_size=1000, chunk_overlap=200)
        splits = text_splitter.create_documents(documents)

        embedding_function = SentenceTransformerEmbeddings(model_name="intfloat/multilingual-e5-large")
        vectorstore = Chroma.from_documents(documents=splits, embedding=embedding_function)
        
        state.retriever = vectorstore.as_retriever()
        return f"文脈CSVがロードされ、ベクトルストアが構築されました ({len(splits)}チャンク)。"
    except Exception as e:
        return f"エラー: {e}"

# --- 評価実行 ---
def handle_single_evaluation(state, model_name, question):
    if state.df_qna is None: return "", "質問データがロードされていません。", "", "0"
    if state.retriever is None: return "", "文脈データがロードされていません。", "", "0"
    
    db = next(get_db())
    try:
        row = state.df_qna[state.df_qna["質問"] == question].iloc[0]
        ground_truth = row["正解"]

        answer, contexts, cost = run_rag_pipeline(state.retriever, model_name, question)
        
        data_samples = {'question': [question], 'answer': [answer], 'contexts': [[c.strip() for c in contexts.split('\n\n') if c]], 'ground_truth': [ground_truth]}
        dataset = Dataset.from_dict(data_samples)
        ragas_score = evaluate(dataset, metrics=[faithfulness, answer_relevancy, context_precision, context_recall])
        
        tonic_score = tonic_similarity(question, ground_truth, answer, model_name)
        cosine = cosine_sim(ground_truth, answer)
        mlflow_ox = llm_evaluate(model_name, [question], [answer], [ground_truth])[0]
        
        final_judgement = determine_final_judgement(ragas_score, cosine)

        new_log = database.EvaluationLog(
            model_name=model_name, rag_config=", ".join(state.current_rag_config),
            question=question, ground_truth=ground_truth, generated_answer=answer,
            retrieved_contexts=contexts, final_judgement=final_judgement,
            tonic_score=tonic_score, cosine_similarity=round(cosine, 3), mlflow_judgement=mlflow_ox,
            faithfulness=ragas_score.get('faithfulness', 0), answer_relevancy=ragas_score.get('answer_relevancy', 0),
            context_precision=ragas_score.get('context_precision', 0), context_recall=ragas_score.get('context_recall', 0),
            cost_usd=cost
        )
        db.add(new_log)
        db.commit()
        
        eval_count = db.query(database.EvaluationLog).count()
        detail_text = f"コスト: ${cost:.6f}, Faithfulness: {ragas_score.get('faithfulness', 0):.3f}, Answer Relevancy: {ragas_score.get('answer_relevancy', 0):.3f}"
        return answer, f"最終判定: {final_judgement}", detail_text, str(eval_count)
    except Exception as e:
        db.rollback()
        print(f"評価エラー: {e}")
        return "エラー発生", str(e), "", str(db.query(database.EvaluationLog).count())
    finally:
        db.close()

def handle_multi_evaluation(state, model_name, selected_questions, prog=gr.Progress()):
    db = next(get_db())
    count = db.query(database.EvaluationLog).count()
    db.close()
    if not selected_questions: return "評価する質問が選択されていません。", str(count)
        
    for i, question in enumerate(selected_questions):
        prog((i + 1) / len(selected_questions), desc=f"評価中: {question[:30]}...")
        handle_single_evaluation(state, model_name, question)
    
    db = next(get_db())
    eval_count = db.query(database.EvaluationLog).count()
    db.close()
    return f"{len(selected_questions)} 件を一括評価しました。", str(eval_count)

# --- 履歴の取得とクリア ---
def get_history_df(model_filter="All", config_filter="All", final_filter="All"):
    db = next(get_db())
    try:
        query = db.query(database.EvaluationLog)
        if model_filter != "All": query = query.filter(database.EvaluationLog.model_name == model_filter)
        if config_filter != "All": query = query.filter(database.EvaluationLog.rag_config == config_filter)
        if final_filter != "All": query = query.filter(database.EvaluationLog.final_judgement == final_filter)
        
        logs = query.order_by(database.EvaluationLog.id.desc()).all()
        if not logs: return pd.DataFrame(columns=DF_HEADERS)
        
        log_list = [{
            "ID": log.id, "タイムスタンプ": log.timestamp.strftime("%Y-%m-%d %H:%M"), "モデル": log.model_name,
            "構成": log.rag_config, "質問": log.question, "最終判定": log.final_judgement,
            "Faithfulness": f"{log.faithfulness:.3f}", "Answer Relevancy": f"{log.answer_relevancy:.3f}",
            "Context Precision": f"{log.context_precision:.3f}", "Context Recall": f"{log.context_recall:.3f}",
            "コスト(USD)": f"${log.cost_usd:.6f}", "正解": log.ground_truth,
            "生成回答": log.generated_answer, "検索された文脈": log.retrieved_contexts
        } for log in logs]
        return pd.DataFrame(log_list, columns=DF_HEADERS)
    finally:
        db.close()

def clear_all_history(state):
    db = next(get_db())
    try:
        db.query(database.EvaluationLog).delete()
        db.commit()
        state.df_qna = None
        state.retriever = None
        state.current_rag_config = []
        state.agent_executor = None
        state.agent_memory_messages.clear()
        state.agent_tools_manager = None
        status_message = "全履歴とデータをクリアしました。"
    except Exception as e:
        db.rollback()
        status_message = f"クリア中にエラーが発生しました: {e}"
    finally:
        db.close()
        
    return {
        "csv_qna_input": gr.update(value=None), "csv_docs_input": gr.update(value=None), "csv_load_status": status_message,
        "rag_config": gr.update(value=[]), "current_rag_config_label": gr.update(value="Simple"),
        "question_dropdown": gr.update(choices=[], value=None), "question_display": "", "answer_text": "",
        "generated_text": "", "eval_result": "", "eval_detail": "",
        "question_multi_dropdown": gr.update(choices=[], value=[]), "multi_eval_status": "",
        "eval_count": "0", "csv_save_file": gr.update(value=None, visible=False), "csv_save_status": "",
        "history_df_display": pd.DataFrame(columns=DF_HEADERS), "graph_3d_out": None,
        "group_model_plot_out": None, "group_config_plot_out": None,
        "agent_status_output": "エージェントは初期化されていません。", "agent_chat_history_display": [],
        "agent_query_input": gr.update(interactive=False, value="")
    }

# --- グラフ描画ハンドラ ---
def handle_plot_3d_scores():
    db = next(get_db())
    try:
        df = pd.read_sql(db.query(database.EvaluationLog).statement, db.bind)
        return plot_3d_scores(df)
    finally:
        db.close()

def handle_group_analysis():
    db = next(get_db())
    try:
        df = pd.read_sql(db.query(database.EvaluationLog).statement, db.bind)
        return plot_group_analysis(df)
    finally:
        db.close()

# --- その他UIハンドラ ---
def get_current_question_context(state, selected_question: str):
    if state.df_qna is None or selected_question is None: return "", ""
    try:
        row = state.df_qna[state.df_qna['質問'] == selected_question].iloc[0]
        return row['質問'], row['正解']
    except (IndexError, KeyError):
        return "", ""

def handle_set_rag_config(state, configs):
    state.current_rag_config = configs
    return ", ".join(state.current_rag_config) if state.current_rag_config else "Simple"

# --- エージェント関連 ---
def init_agent_for_chat(state, model_name: str):
    try:
        tools_manager = AgentToolsManager(state, database.SessionLocal, handle_single_evaluation)
        state.agent_tools_manager = tools_manager
        state.agent_executor = initialize_agent_executor(state, model_name, tools_manager.tools)
        state.agent_memory_messages.clear()
        return ([], f"AIアシスタントがモデル '{model_name}' で初期化されました。", gr.update(interactive=True))
    except Exception as e:
        return ([], f"AIアシスタントの初期化に失敗: {e}", gr.update(interactive=False))

def chat_with_agent(state, user_message: str, chat_history_list: list):
    if not state.agent_executor:
        chat_history_list.append((user_message, "AIアシスタントが初期化されていません。"))
        return chat_history_list, ""

    chat_history_list.append((user_message, None))
    yield chat_history_list, ""

    full_response = ""
    try:
        response_stream = state.agent_executor.stream({"input": user_message})
        for chunk in response_stream:
            if "output" in chunk:
                full_response += chunk["output"]
                chat_history_list[-1] = (user_message, full_response)
                yield chat_history_list, ""
    except Exception as e:
        error_message = f"分析中にエラーが発生しました: {e}"
        chat_history_list[-1] = (user_message, error_message)
    yield chat_history_list, ""

def clear_agent_chat_history(state):
    if state.agent_executor:
        state.agent_executor.memory.clear()
    state.agent_memory_messages.clear()
    return [], gr.update(value="")

--- FILE: ./backend/legacy_rag_app/utils.py ---
# utils.py
import numpy as np
import matplotlib.pyplot as plt
import pandas as pd
from matplotlib import cm
from sentence_transformers import SentenceTransformer, util
from models import invoke_model

# --- モデルのキャッシュ ---
sentence_model = SentenceTransformer("intfloat/multilingual-e5-large")

# --- 評価関数 ---
def tonic_similarity(question, target_answer, generated_answer, model_name):
    try:
        prompt_template = f"""
        以下の質問と正解に対する生成回答の関連性を5点満点で評価してください。
        1点: 全く関連性がない
        2点: 部分的に関連するが、多くの間違いがある
        3点: 関連性は高いが、重要な情報が欠けているか不正確
        4点: 正確で関連性が非常に高いが、完璧ではない
        5点: 完全に正確で、正解とほぼ同等である
        評価の点数のみを出力してください。

        質問: {question}
        正解: {target_answer}
        生成回答: {generated_answer}
        """
        response = invoke_model(model_name, prompt_template, {})
        score_str = response.splitlines()[0].strip()
        return float(score_str)
    except Exception as e:
        print(f"Tonic評価シミュレーションエラー: {e}")
        return 0.0

def cosine_sim(text1, text2):
    embeddings = sentence_model.encode([text1, text2], convert_to_tensor=True)
    cosine_scores = util.cos_sim(embeddings[0], embeddings[1])
    return cosine_scores.item()

def score_to_ox(score, threshold):
    return "O" if score >= threshold else "X"

def llm_evaluate(model_name, questions, generated_answers, target_answers):
    results = []
    for q, g, t in zip(questions, generated_answers, target_answers):
        try:
            prompt_template = f"""
            以下の質問に対する生成回答は、正解として適切ですか？
            「O」（適切）または「X」（不適切）で答えてください。
            評価理由の説明は不要です。

            質問: {q}
            正解: {t}
            生成回答: {g}
            """
            response = invoke_model(model_name, prompt_template, {})
            results.append("O" if "O" in response else "X")
        except Exception as e:
            print(f"LLM評価エラー: {e}")
            results.append("X")
    return results

# --- グラフ描画関数 ---
def plot_3d_scores(df: pd.DataFrame):
    """DataFrameを受け取り、3Dスコアグラフを生成する"""
    if df.empty or 'tonic_score' not in df.columns or 'cosine_similarity' not in df.columns:
        return None
    
    fig = plt.figure(figsize=(12, 8))
    ax = fig.add_subplot(111, projection='3d')
    
    colors = cm.rainbow(np.linspace(0, 1, len(df['model_name'].unique())))
    color_map = dict(zip(df['model_name'].unique(), colors))
    
    for model_name, color in color_map.items():
        sub_df = df[df['model_name'] == model_name]
        ax.scatter(sub_df['tonic_score'], sub_df['cosine_similarity'], sub_df['final_judgement'].apply(lambda x: 1 if x == 'O' else 0),
                   c=[color], label=model_name, s=50, alpha=0.7)
                   
    ax.set_xlabel('TONICスコア')
    ax.set_ylabel('コサイン類似度')
    ax.set_zlabel('最終判定 (O=1, X=0)')
    ax.set_title('RAG評価スコア 3Dプロット')
    ax.legend()
    
    return fig

def plot_group_analysis(df: pd.DataFrame):
    """DataFrameを受け取り、グループ別分析グラフを生成する"""
    if df.empty:
        return None, None
    
    # モデル別分析
    model_summary = df.groupby('model_name')['final_judgement'].apply(lambda x: (x == 'O').mean()).sort_values(ascending=False)
    fig1, ax1 = plt.subplots(figsize=(10, 6))
    model_summary.plot(kind='bar', ax=ax1, color='skyblue')
    ax1.set_title('モデル別成功率 (最終判定: Oの割合)')
    ax1.set_ylabel('成功率')
    ax1.set_xlabel('モデル')
    ax1.tick_params(axis='x', rotation=45)
    plt.tight_layout()

    # RAG構成別分析
    config_summary = df.groupby('rag_config')['final_judgement'].apply(lambda x: (x == 'O').mean()).sort_values(ascending=False)
    fig2, ax2 = plt.subplots(figsize=(10, 6))
    config_summary.plot(kind='bar', ax=ax2, color='lightgreen')
    ax2.set_title('RAG構成別成功率 (最終判定: Oの割合)')
    ax2.set_ylabel('成功率')
    ax2.set_xlabel('RAG構成')
    ax2.tick_params(axis='x', rotation=45)
    plt.tight_layout()
    
    return fig1, fig2

--- FILE: ./backend/legacy_rag_app/agent_tools.py ---
# agent_tools.py
import pandas as pd
from langchain.tools import tool
from sqlalchemy.orm import Session
import database
from models import invoke_model
from config import RAG_CONFIG_OPTIONS

class AgentToolsManager:
    """AIアシスタントが使用するツールを管理するクラス"""
    def __init__(self, state, db_session_factory, single_eval_func):
        self.state = state
        self.db_session_factory = db_session_factory
        self._single_eval_func = single_eval_func
        
        # ツールをリストとして保持
        self.tools = [
            self.summarize_model_performance,
            self.analyze_failed_questions,
            self.compare_models_configs,
            self.update_rag_config,
            self.run_evaluation_for_agent,
        ]

    def _get_df_from_db(self) -> pd.DataFrame:
        """データベースから評価履歴をDataFrameとして読み込むヘルパー関数"""
        db = self.db_session_factory()
        try:
            query = db.query(database.EvaluationLog).statement
            df = pd.read_sql(query, db.bind)
            return df
        finally:
            db.close()

    @tool
    def summarize_model_performance(self) -> str:
        """評価履歴データに基づき、各モデルの性能を要約します。"""
        df = self._get_df_from_db()
        if df.empty:
            return "評価履歴データがありません。"
        
        summary = df.groupby('model_name')['final_judgement'].apply(
            lambda x: (x == 'O').mean()
        ).sort_values(ascending=False)
        
        summary_text = "【モデル別性能サマリー】\n"
        for model, success_rate in summary.items():
            count = len(df[df['model_name'] == model])
            summary_text += f"- {model}: 成功率 {success_rate:.2%} ({count}件中)\n"
        return summary_text

    @tool
    def analyze_failed_questions(self) -> str:
        """最終判定が「X」となった質問を抽出し、その原因をAIで分析します。"""
        df = self._get_df_from_db()
        if df.empty:
            return "評価履歴データがありません。"

        failed_df = df[df['final_judgement'] == 'X']
        if failed_df.empty:
            return "最終判定が「X」の質問はありませんでした。"
        
        # 最新3件に絞って分析
        recent_failed_df = failed_df.tail(3)
        analysis_results = []
        for _, row in recent_failed_df.iterrows():
            try:
                analysis_prompt = f"""
                以下の質問に対する生成回答は、正解と比べてなぜ「X」と判定されたのでしょうか？
                簡潔に理由を分析してください。
                質問: {row['question']}
                正解: {row['ground_truth']}
                生成回答: {row['generated_answer']}
                """
                analysis = invoke_model(row['model_name'], analysis_prompt, {})
                analysis_results.append(f"【質問: {row['question']}】\n原因分析: {analysis}\n")
            except Exception as e:
                analysis_results.append(f"【質問: {row['question']}】\n分析中にエラーが発生しました: {e}\n")
        return "「X」と判定された質問の原因分析:\n\n" + "\n".join(analysis_results)

    @tool
    def compare_models_configs(self, query: str) -> str:
        """ "gpt-4o vs claude-3-sonnet" のように、2つのモデルの性能を比較します。"""
        df = self._get_df_from_db()
        if df.empty:
            return "評価履歴データがありません。"

        parts = query.lower().split(" vs ")
        if len(parts) != 2:
            return "比較するには「A vs B」の形式でモデル名を指定してください。"
        item1, item2 = parts[0].strip(), parts[1].strip()

        def get_summary(item_name, df_group):
            filtered_df = df_group[df_group['model_name'].str.lower() == item_name]
            if filtered_df.empty:
                return f"'{item_name}'のデータが見つかりません。"
            success_rate = (filtered_df['final_judgement'] == 'O').mean()
            avg_faithfulness = filtered_df['faithfulness'].mean()
            avg_cost = filtered_df['cost_usd'].mean()
            return f"- {item_name}:\n  - 成功率: {success_rate:.2%}\n  - 忠実性 (Faithfulness): {avg_faithfulness:.3f}\n  - 平均コスト: ${avg_cost:.6f}"
        
        summary1 = get_summary(item1, df)
        summary2 = get_summary(item2, df)
        return f"【モデル性能比較レポート】\n{summary1}\n\n{summary2}"

    @tool
    def update_rag_config(self, new_config_list_str: str) -> str:
        """RAG評価に使用する構成要素を更新します。例: "Chanking,Hybrid Search" """
        new_configs = [c.strip() for c in new_config_list_str.split(',') if c.strip()]
        valid_configs = set(RAG_CONFIG_OPTIONS)
        
        if not all(c in valid_configs for c in new_configs):
            invalid_configs = [c for c in new_configs if c not in valid_configs]
            return f"無効な構成要素: {', '.join(invalid_configs)}。有効なオプション: {', '.join(valid_configs)}"
        
        self.state.current_rag_config = new_configs
        config_str = ", ".join(new_configs) if new_configs else "Simple"
        return f"RAG構成を「{config_str}」に更新しました。"

    @tool
    def run_evaluation_for_agent(self, model_name: str, question: str) -> str:
        """指定されたモデルと質問でRAG評価を実行します。"""
        if self.state.df_qna is None or self.state.df_qna.empty:
            return "質問データ（qna.csv）がアップロードされていません。"
        if self.state.retriever is None:
            return "文脈データ（docs.csv）がアップロードされていません。"
        try:
            _, final_ox, _, _ = self._single_eval_func(self.state, model_name, question)
            return f"質問「{question}」の評価が完了しました。モデル: {model_name}, 最終判定: {final_ox}"
        except Exception as e:
            return f"評価中にエラーが発生しました: {e}"

--- FILE: ./backend/legacy_rag_app/database.py ---
# database.py
from sqlalchemy import create_engine, Column, Integer, String, Float, DateTime
from sqlalchemy.orm import sessionmaker, declarative_base
import datetime

# SQLiteデータベースファイルのパス
DATABASE_URL = "sqlite:///evaluation_log.db"

# SQLAlchemyのエンジンを作成
# connect_argsはSQLite使用時にスレッドセーフを確保するために必要
engine = create_engine(DATABASE_URL, connect_args={"check_same_thread": False})

# データベースセッションを作成するためのクラス
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

# モデルクラスのベースとなるクラス
Base = declarative_base()

class EvaluationLog(Base):
    """評価履歴を保存するためのデータベースモデル（テーブル）"""
    __tablename__ = "evaluation_logs"

    id = Column(Integer, primary_key=True, index=True)
    timestamp = Column(DateTime, default=datetime.datetime.now)
    model_name = Column(String, index=True)
    rag_config = Column(String)
    question = Column(String)
    ground_truth = Column(String)
    generated_answer = Column(String)
    retrieved_contexts = Column(String, default="")
    
    # 評価指標
    final_judgement = Column(String, index=True)
    tonic_score = Column(Float)
    cosine_similarity = Column(Float)
    mlflow_judgement = Column(String) # この名前は歴史的なものですが、LLMによる判定として残します
    faithfulness = Column(Float)
    answer_relevancy = Column(Float)
    context_precision = Column(Float)
    context_recall = Column(Float)

    # コスト
    cost_usd = Column(Float)

def init_db():
    """
    データベースを初期化し、テーブルが存在しない場合は作成します。
    アプリケーションの起動時に一度だけ呼び出されます。
    """
    Base.metadata.create_all(bind=engine)

--- FILE: ./backend/legacy_rag_app/models.py ---
# models.py
from langchain_openai import ChatOpenAI
from langchain_google_genai import ChatGoogleGenerativeAI
from langchain_anthropic import ChatAnthropic
from langchain_core.prompts import ChatPromptTemplate
from langchain_core.language_models.chat_models import BaseChatModel

# configからAPIキーを直接インポート
from config import OPENAI_API_KEY, GOOGLE_API_KEY, ANTHROPIC_API_KEY

def is_openai_model(model_name: str) -> bool:
    """モデル名がOpenAIのものか判定する"""
    return model_name.startswith("gpt")

def is_gemini_model(model_name: str) -> bool:
    """モデル名がGeminiのものか判定する"""
    return model_name.startswith("gemini")

def is_anthropic_model(model_name: str) -> bool:
    """モデル名がAnthropicのものか判定する"""
    return model_name.startswith("claude")

def get_llm_instance(model_name: str) -> BaseChatModel:
    """
    モデル名に基づいてLLMのインスタンスを生成して返す。
    APIキーの選択ロジックもこの関数内にカプセル化する。
    """
    if is_openai_model(model_name):
        return ChatOpenAI(model=model_name, api_key=OPENAI_API_KEY, temperature=0)
    elif is_gemini_model(model_name):
        # Geminiはシステムプロンプトの扱いに注意が必要なため、互換性オプションを有効にする
        return ChatGoogleGenerativeAI(model=model_name, google_api_key=GOOGLE_API_KEY, temperature=0, convert_system_message_to_human=True)
    elif is_anthropic_model(model_name):
        return ChatAnthropic(model=model_name, anthropic_api_key=ANTHROPIC_API_KEY, temperature=0)
    else:
        raise ValueError(f"サポートされていないモデル、または不明なモデルです: {model_name}")

def invoke_model(model_name: str, prompt_template: str, inputs: dict) -> str:
    """プロンプトと入力を使用してモデルを呼び出し、テキストの応答を返す"""
    llm = get_llm_instance(model_name)
    prompt = ChatPromptTemplate.from_template(prompt_template)
    chain = prompt | llm
    response = chain.invoke(inputs)
    return response.content

--- FILE: ./backend/rag_pipelines.py ---
import pandas as pd
import numpy as np
import chardet
import json
from io import BytesIO
from langchain.text_splitter import RecursiveCharacterTextSplitter
from langchain_community.vectorstores import FAISS
from langchain_community.retrievers import BM25Retriever
from langchain.retrievers import EnsembleRetriever
from langchain_huggingface import HuggingFaceEmbeddings
from langchain_core.documents import Document
from langchain_core.prompts import ChatPromptTemplate
from langchain_core.runnables import RunnablePassthrough
from models import get_llm
from ai_pipelines import _extract_token_usage

def _parse_csv_to_records(file, required_columns: list[str]):
    try:
        file_content = file.read()
        result = chardet.detect(file_content)
        encoding = result.get('encoding', 'utf-8')
        df = pd.read_csv(BytesIO(file_content), encoding=encoding)
        for col in required_columns:
            if col not in df.columns:
                raise ValueError(f"CSVに必須のカラム '{col}' が見つかりません。")
        return df.to_dict('records')
    except Exception as e:
        raise ValueError(f"CSVファイルの読み込みまたは解析に失敗しました: {e}")

def create_retriever(context_file, options: dict):
    print("--- RAG: Parsing context CSV ---")
    context_records = _parse_csv_to_records(context_file, required_columns=["context"])
    initial_docs = [Document(page_content=rec["context"]) for rec in context_records if isinstance(rec["context"], str) and rec["context"].strip()]
    if not initial_docs:
        raise ValueError("文脈CSVに、有効なコンテキストが見つかりませんでした。")

    docs_to_index = initial_docs
    if options.get("chunking"):
        print("--- RAG: Chunking context documents... ---")
        text_splitter = RecursiveCharacterTextSplitter(chunk_size=500, chunk_overlap=50)
        docs_to_index = text_splitter.split_documents(initial_docs)

    print("--- RAG: Initializing embedding model ---")
    embedding_model = HuggingFaceEmbeddings(model_name="sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2")
    
    print("--- RAG: Creating retrievers ---")
    faiss_retriever = FAISS.from_documents(docs_to_index, embedding_model).as_retriever(search_kwargs={"k": 3})

    if options.get("hybridSearch"):
        print("--- RAG: Creating BM25 retriever for Hybrid Search... ---")
        bm25_retriever = BM25Retriever.from_documents(docs_to_index)
        bm25_retriever.k = 3
        ensemble_retriever = EnsembleRetriever(retrievers=[bm25_retriever, faiss_retriever], weights=[0.5, 0.5])
        print("--- RAG: Hybrid Search retriever created successfully ---")
        return ensemble_retriever
    else:
        print("--- RAG: Using standard vector retriever ---")
        return faiss_retriever

def get_rag_prompt(options: dict):
    if options.get("promptTuning"):
        print("--- RAG: Using advanced prompt template ---")
        template = """あなたは思考の連鎖（Chain of Thought）を用いて回答する、高度なAIアシスタントです。まずステップバイステップで考え、その後に最終的な回答を生成してください。
以下の文脈情報だけを使って、質問に答えてください。
文脈: 
{context}
質問: 
{question}
思考: （ここに思考を記述）
回答:
"""
    else:
        print("--- RAG: Using simple prompt template ---")
        template = "以下の文脈情報だけを使って、質問に答えてください。\n\n文脈:\n{context}\n\n質問:\n{question}\n\n回答:"
    
    return ChatPromptTemplate.from_template(template)

def run_rag_benchmark_pipeline(qa_dataset: list, context_file, model_name: str, advanced_options: dict):
    retriever = create_retriever(context_file, advanced_options)
    prompt = get_rag_prompt(advanced_options)
    llm = get_llm(model_name)
    eval_llm = get_llm("gpt-4o-mini") 
    def format_docs(docs): return "\n\n".join(doc.page_content for doc in docs)
    rag_chain = ({"context": retriever | format_docs, "question": RunnablePassthrough()} | prompt | llm)
    
    evaluation_prompt = ChatPromptTemplate.from_messages([("system", "あなたは、AIの回答を評価する厳格な評価者です。"),("user", """以下の「質問」、「AIが参照した文脈」、「AIの回答」を比較して、評価スコアを付けてください。
# 質問
{question}
# AIが参照した文脈
{context}
# AIの回答
{prediction}
# 命令
以下の2つの観点で、AIの回答の品質を0.0から1.0の範囲で採点してください。
1. **忠実性 (faithfulness)**
2. **関連性 (relevance)**
あなたの評価を、以下のjson形式で返してください。
{{"faithfulness_score": 0.9, "relevance_score": 1.0}}""")])
    evaluator_chain = evaluation_prompt | eval_llm.bind(response_format={"type": "json_object"})
    results, total_token_usage = [], {"input_tokens": 0, "output_tokens": 0}
    
    print(f"--- RAG: Running benchmark for {len(qa_dataset)} questions ---")
    for item in qa_dataset:
        question, ground_truth = item['question'], item['ground_truth']
        print(f"--- RAG: Answering question: '{question[:30]}...' ---")
        retrieved_docs_result = retriever.invoke(question)
        rag_chain_response = rag_chain.invoke(question)
        generated_answer = rag_chain_response.content
        usage = _extract_token_usage(rag_chain_response)
        total_token_usage["input_tokens"] += usage["input_tokens"]; total_token_usage["output_tokens"] += usage["output_tokens"]
        
        print(f"--- RAG: Evaluating answer... ---")
        evaluator_response = evaluator_chain.invoke({"question": question, "context": format_docs(retrieved_docs_result), "prediction": generated_answer})
        usage = _extract_token_usage(evaluator_response)
        total_token_usage["input_tokens"] += usage["input_tokens"]; total_token_usage["output_tokens"] += usage["output_tokens"]
        evaluation_result = json.loads(evaluator_response.content)
        
        current_faithfulness = evaluation_result.get('faithfulness_score', 0)
        current_relevancy = evaluation_result.get('relevance_score', 0)
        results.append({"question": question, "ground_truth": ground_truth, "generated_answer": generated_answer, "retrieved_contexts": [doc.page_content for doc in retrieved_docs_result], "faithfulness_score": current_faithfulness, "relevancy_score": current_relevancy})

    print("--- RAG: Benchmark finished ---")
    faithfulness_scores = [res.get('faithfulness_score', 0) for res in results]
    relevancy_scores = [res.get('relevancy_score', 0) for res in results]
    final_scores = {"average_faithfulness": np.mean(faithfulness_scores) if faithfulness_scores else 0, "average_answer_relevancy": np.mean(relevancy_scores) if relevancy_scores else 0}
    
    return {"results_by_question": results, "final_scores": final_scores, "token_usage": total_token_usage}
--- FILE: ./backend/ai_pipelines.py ---
import time
import json
import pandas as pd
import numpy as np
import chardet
from io import BytesIO
from langchain_community.vectorstores import FAISS
from langchain_huggingface import HuggingFaceEmbeddings
from langchain_core.documents import Document
from langchain_core.prompts import ChatPromptTemplate
from langchain_core.runnables import RunnablePassthrough
from langchain_core.output_parsers import StrOutputParser, JsonOutputParser
from models import get_llm

def _extract_token_usage(response):
    """LangChainのレスポンスオブジェクトからトークン使用量を抽出する（全プロバイダー対応版）"""
    usage = {}
    if hasattr(response, 'response_metadata') and response.response_metadata:
        if "usage_metadata" in response.response_metadata: # Google Gemini
            usage_meta = response.response_metadata["usage_metadata"]
            return {"input_tokens": usage_meta.get("prompt_token_count", 0), "output_tokens": usage_meta.get("candidates_token_count", 0)}
        elif "token_usage" in response.response_metadata: # OpenAI
            usage = response.response_metadata["token_usage"]
        elif "usage" in response.response_metadata: # Anthropic Claude
            usage = response.response_metadata["usage"]
    return {"input_tokens": usage.get("prompt_tokens", 0) or usage.get("input_tokens", 0), "output_tokens": usage.get("completion_tokens", 0) or usage.get("output_tokens", 0)}

def _generate_draft(llm, model_name: str, transcript_text: str):
    print(f"LLM [Step 1/4]: Generating draft with {model_name}...")
    prompt = ChatPromptTemplate.from_messages([
        ("system", "あなたは、会議の文字起こしを分析し、要点とアクションアイテムを抽出するアシスタントです。"),
        ("user", """以下の会議の文字起こしから、要約とToDoリストを作成してください。
# 文字起こし
{transcript}
# 命令
1. この会議の要約を3〜5個の箇条書きで作成してください。
2. この会議で発生したToDo（アクションアイテム）をリストアップしてください。
あなたの回答は、必ず以下のjson形式で返してください。
{{"summary": ["要約1", "要約2"], "todos": ["ToDo1", "ToDo2"]}}""")
    ])
    if model_name.startswith("gpt"):
        chain = prompt | llm.bind(response_format={"type": "json_object"})
    else:
        chain = prompt | llm
    return chain.invoke({"transcript": transcript_text})

def _review_draft(llm, model_name: str, transcript_text: str, draft: dict):
    print(f"LLM [Step 2/4]: Reviewing draft with {model_name}...")
    draft_summary = "\n".join(f"- {item}" for item in draft.get("summary", []))
    draft_todos = "\n".join(f"- {item}" for item in draft.get("todos", []))
    prompt = ChatPromptTemplate.from_messages([
        ("system", "あなたは、AIアシスタントが作成した会議の要約とToDoリストを評価する、優秀な編集長です。"),
        ("user", """以下の「元の文字起こし」と、それに基づいてAIが作成した「ドラフト」をレビューしてください。
# 元の文字起こし
{transcript}
# ドラフト
## 要約
{summary}
## ToDoリスト
{todos}
# 命令
以下の観点に基づいて、このドラフトの良い点と改善点を具体的に指摘してください。
- 要約の忠実性
- ToDoの網羅性
- 全体的な明確さ
あなたのレビューコメントを簡潔に記述してください。""")
    ])
    chain = prompt | llm
    return chain.invoke({"transcript": transcript_text, "summary": draft_summary, "todos": draft_todos})

def _revise_draft(llm, model_name: str, transcript_text: str, draft: dict, review_feedback: str):
    print(f"LLM [Step 3/4]: Revising draft with {model_name}...")
    draft_summary = "\n".join(f"- {item}" for item in draft.get("summary", []))
    draft_todos = "\n".join(f"- {item}" for item in draft.get("todos", []))
    prompt = ChatPromptTemplate.from_messages([
        ("system", "あなたは、編集長からのレビューフィードバックを元に、会議の要約とToDoリストを改善するアシスタントです。"),
        ("user", """以下の「元の文字起こし」、「最初のドラフト」、そして「編集長からのレビュー」をすべて考慮して、最終的な成果物を作成してください。
# 元の文字起こし
{transcript}
# 最初のドラフト
## 要約
{summary}
## ToDoリスト
{todos}
# 編集長からのレビュー
{feedback}
# 命令
レビューでの指摘事項を反映し、**最高の品質**の要約とToDoリストを生成してください。
あなたの回答は、必ず以下のjson形式で返してください。
{{"summary": ["改善された要約1"], "todos": ["改善されたToDo1"]}}""")
    ])
    if model_name.startswith("gpt"):
        chain = prompt | llm.bind(response_format={"type": "json_object"})
    else:
        chain = prompt | llm
    return chain.invoke({"transcript": transcript_text, "summary": draft_summary, "todos": draft_todos, "feedback": review_feedback})

def _evaluate_reliability(llm, model_name: str, transcript_text: str, final_summary: str):
    print(f"LLM [Step 4/4]: Evaluating reliability with {model_name}...")
    prompt = ChatPromptTemplate.from_messages([
        ("system", "あなたは、AIが生成した要約を、元の文字起こしと比較して評価する厳格な評価者です。"),
        ("user", """以下の「元の文字起こし」と「AIによる要約」を比較してください。
# 元の文字起こし
{transcript}
# AIによる要約
{summary}
# 命令
以下の3つの観点で、要約の品質を0.0から1.0の範囲で採点してください。
1. **忠実性 (Faithfulness)**
2. **網羅性 (Comprehensiveness)**
3. **簡潔性 (Conciseness)**
あなたの評価を、以下のjson形式で返してください。
{{"faithfulness_score": 0.9, "comprehensiveness_score": 0.8, "conciseness_score": 1.0, "justification": "要約は概ね正確だが、Q4予算に関する言及が抜けている。"}}""")
    ])
    if model_name.startswith("gpt"):
        chain = prompt | llm.bind(response_format={"type": "json_object"})
    else:
        chain = prompt | llm
    return chain.invoke({"transcript": transcript_text, "summary": final_summary})

def run_self_improvement_pipeline(model_name: str, transcript_text: str):
    try:
        llm = get_llm(model_name)
        total_token_usage = {"input_tokens": 0, "output_tokens": 0}
        
        response1 = _generate_draft(llm, model_name, transcript_text)
        usage = _extract_token_usage(response1); total_token_usage["input_tokens"] += usage["input_tokens"]; total_token_usage["output_tokens"] += usage["output_tokens"]
        draft_result = json.loads(response1.content)

        response2 = _review_draft(llm, model_name, transcript_text, draft_result)
        usage = _extract_token_usage(response2); total_token_usage["input_tokens"] += usage["input_tokens"]; total_token_usage["output_tokens"] += usage["output_tokens"]
        review_feedback = response2.content
        
        response3 = _revise_draft(llm, model_name, transcript_text, draft_result, review_feedback)
        usage = _extract_token_usage(response3); total_token_usage["input_tokens"] += usage["input_tokens"]; total_token_usage["output_tokens"] += usage["output_tokens"]
        final_result = json.loads(response3.content)

        summary = "\n".join(f"- {item}" for item in final_result.get("summary", []))
        todos = final_result.get("todos", [])
        
        response4 = _evaluate_reliability(llm, model_name, transcript_text, summary)
        usage = _extract_token_usage(response4); total_token_usage["input_tokens"] += usage["input_tokens"]; total_token_usage["output_tokens"] += usage["output_tokens"]
        evaluation = json.loads(response4.content)
        
        scores = [evaluation.get(s, 0) for s in ["faithfulness_score", "comprehensiveness_score", "conciseness_score"]]
        average_score = sum(scores) / len(scores) if scores else 0
        reliability_info = {"score": average_score, "justification": evaluation.get("justification", "評価に失敗しました。")}
        
        return summary, todos, reliability_info, total_token_usage
    except Exception as e:
        print(f"LLMパイプラインでエラーが発生しました ({model_name}): {e}")
        return "要約の生成に失敗しました。", ["ToDoの抽出に失敗しました。"], {"score": 0.0, "justification": f"パイプラインエラー: {e}"}, {"input_tokens": 0, "output_tokens": 0}

def run_benchmark_pipeline(transcript_text: str, models_to_run: list[str]):
    benchmark_results = []
    for model_name in models_to_run:
        print(f"\n--- Starting benchmark for model: {model_name} ---")
        start_time = time.time()
        summary, todos, reliability, token_usage = run_self_improvement_pipeline(model_name=model_name, transcript_text=transcript_text)
        end_time = time.time()
        execution_time = end_time - start_time
        print(f"--- Finished benchmark for {model_name} in {execution_time:.2f} seconds ---")
        benchmark_results.append({"model_name": model_name, "summary": summary, "todos": todos, "reliability": reliability, "token_usage": token_usage, "execution_time": execution_time})
    return benchmark_results
--- FILE: ./backend/history/ba061d36-a283-49ea-8911-fdf0623c9474.json ---
{
    "id": "ba061d36-a283-49ea-8911-fdf0623c9474",
    "createdAt": "2025-08-17T10:32:55.898146+00:00",
    "originalFilename": "sanple.m4a",
    "model_name": "gpt-4o-mini",
    "transcript": "これはトラストークのテストですいいでしょう",
    "summary": "- トラストークのテストが行われた。",
    "todos": [
        "テスト結果の分析を行い、次回の会議で報告する。責任者: 山田"
    ],
    "speakers": "**UNKNOWN**: これは ト ラ スト ー ク の [*] テ スト です いい でしょう",
    "cost": 0.06518475000000001,
    "reliability": {
        "score": 0.9333333333333332,
        "justification": "要約は元の文字起こしの内容を正確に反映しているが、詳細な文脈やニュアンスが欠けているため、網羅性がやや低い。"
    }
}
--- FILE: ./backend/history/4cfe2fb8-ee00-4e2a-a71e-c7b1114de111.json ---
{
    "id": "4cfe2fb8-ee00-4e2a-a71e-c7b1114de111",
    "createdAt": "2025-08-17T10:33:16.819135+00:00",
    "originalFilename": "sanple.m4a",
    "model_name": "gpt-4o-mini",
    "transcript": "これはトラストークのテストですいいでしょう",
    "summary": "- トラストークのテストが行われた。",
    "todos": [
        "テスト結果を分析し、次回の改善点をまとめる。責任者: 山田"
    ],
    "speakers": "**UNKNOWN**: これは ト ラ スト ー ク の [*] テ スト です いい でしょう",
    "cost": 0.061878749999999996,
    "reliability": {
        "score": 0.9333333333333332,
        "justification": "要約は元の文字起こしの内容を正確に反映しているが、詳細な文脈やニュアンスが欠けているため、網羅性がやや低い。"
    }
}
--- FILE: ./backend/history/a651452a-e9aa-4d7f-8880-54c382245c57.json ---
{
    "id": "a651452a-e9aa-4d7f-8880-54c382245c57",
    "createdAt": "2025-08-17T10:34:49.824591+00:00",
    "originalFilename": "sanple.m4a",
    "model_name": "gpt-4o-mini",
    "transcript": "これはトラストークのテストですいいでしょう",
    "summary": "- トラストークのテストが行われた。",
    "todos": [
        "テスト結果を分析し、次回の会議で報告する。"
    ],
    "speakers": "**UNKNOWN**: これは ト ラ スト ー ク の [*] テ スト です いい でしょう",
    "cost": 0.06720749999999999,
    "reliability": {
        "score": 0.9333333333333332,
        "justification": "要約は元の文字起こしの内容を正確に反映しているが、詳細な文脈やニュアンスが欠けているため、網羅性がやや低い。"
    }
}
--- FILE: ./backend/history/8ad5fa41-8385-416d-94d8-ed1e8202efc2.json ---
{
    "id": "8ad5fa41-8385-416d-94d8-ed1e8202efc2",
    "createdAt": "2025-08-17T10:35:10.112926+00:00",
    "originalFilename": "sanple.m4a",
    "model_name": "gpt-4o-mini",
    "transcript": "これはトラストークのテストですいいでしょう",
    "summary": "- トラストークのテストが行われた。",
    "todos": [
        "テスト結果を分析し、次回の改善点をまとめる。"
    ],
    "speakers": "**UNKNOWN**: これは ト ラ スト ー ク の [*] テ スト です いい でしょう",
    "cost": 0.061248,
    "reliability": {
        "score": 0.9333333333333332,
        "justification": "要約は元の文字起こしの内容を正確に反映しているが、詳細な文脈やニュアンスが欠けているため、網羅性がやや低い。"
    }
}
--- FILE: ./backend/history/f508540c-1ab0-405b-a808-2f4309062198.json ---
{
    "id": "f508540c-1ab0-405b-a808-2f4309062198",
    "createdAt": "2025-08-17T10:34:02.539076+00:00",
    "originalFilename": "sanple.m4a",
    "model_name": "gpt-4o-mini",
    "transcript": "これはトラストークのテストですいいでしょう",
    "summary": "- トラストークのテストが行われた。",
    "todos": [
        "テスト結果を分析し、次回の改善点をまとめる。担当者: 山田"
    ],
    "speakers": "**UNKNOWN**: これは ト ラ スト ー ク の [*] テ スト です いい でしょう",
    "cost": 0.06614175,
    "reliability": {
        "score": 0.9666666666666667,
        "justification": "要約は元の文字起こしの内容を正確に反映しており、簡潔である。ただし、元の文のニュアンスや詳細が若干失われているため、網羅性は完璧ではない。"
    }
}
--- FILE: ./backend/history/84aa7a89-a3ef-4659-98d0-076da3134cc9.json ---
{
    "id": "84aa7a89-a3ef-4659-98d0-076da3134cc9",
    "createdAt": "2025-08-17T10:20:32.738355+00:00",
    "originalFilename": "sanple.m4a",
    "model_name": "gpt-4o-mini",
    "transcript": "これはトラストークのテストですいいでしょう",
    "summary": "- トラストークのテストが行われた。",
    "todos": [
        "テスト結果の分析を行う",
        "次回のトラストークのスケジュールを決定する"
    ],
    "speakers": "**UNKNOWN**: これは ト ラ スト ー ク の [*] テ スト です いい でしょう",
    "cost": 0.063336,
    "reliability": {
        "score": 0.9666666666666667,
        "justification": "要約は元の文字起こしの内容を正確に反映しており、簡潔である。ただし、元の文のニュアンスや文脈の詳細が若干欠けているため、網羅性は完璧ではない。"
    }
}
--- FILE: ./backend/history/cd7b9819-4032-4f98-ade7-48bb3798597c.json ---
{
    "id": "cd7b9819-4032-4f98-ade7-48bb3798597c",
    "createdAt": "2025-08-17T10:30:11.986568+00:00",
    "originalFilename": "sanple.m4a",
    "model_name": "gpt-4o-mini",
    "transcript": "これはトラストークのテストですいいでしょう",
    "summary": "- トラストークのテストが行われた。",
    "todos": [
        "テスト結果を分析し、次回の改善点をまとめる。"
    ],
    "speakers": "**UNKNOWN**: これは ト ラ スト ー ク の [*] テ スト です いい でしょう",
    "cost": 0.06548925,
    "reliability": {
        "score": 0.9333333333333332,
        "justification": "要約は元の文字起こしの内容を正確に反映しているが、詳細な文脈やニュアンスが欠けているため、網羅性がやや低い。"
    }
}
--- FILE: ./backend/history/a86e6a3c-9d76-415c-b879-2179dd96a868.json ---
{
    "id": "a86e6a3c-9d76-415c-b879-2179dd96a868",
    "createdAt": "2025-08-17T10:30:33.701148+00:00",
    "originalFilename": "sanple.m4a",
    "model_name": "gpt-4o-mini",
    "transcript": "これはトラストークのテストですいいでしょう",
    "summary": "- トラストークのテストが行われた。",
    "todos": [
        "テスト結果を分析し、次回の改善点をまとめる。責任者: 山田"
    ],
    "speakers": "**UNKNOWN**: これは ト ラ スト ー ク の [*] テ スト です いい でしょう",
    "cost": 0.068121,
    "reliability": {
        "score": 0.9666666666666667,
        "justification": "要約は元の文字起こしの内容を正確に反映しており、簡潔である。ただし、元の文のニュアンスや口語的な表現が完全には伝わっていないため、網羅性はやや低めに評価した。"
    }
}
--- FILE: ./backend/history/59ee6611-368a-47a9-88f2-7402bdd7cba1.json ---
{
    "id": "59ee6611-368a-47a9-88f2-7402bdd7cba1",
    "createdAt": "2025-08-17T10:35:31.823568+00:00",
    "originalFilename": "sanple.m4a",
    "model_name": "gpt-4o-mini",
    "transcript": "これはトラストークのテストですいいでしょう",
    "summary": "- トラストークのテストが行われた。",
    "todos": [
        "テスト結果を分析し、次回の改善点をまとめる。責任者: 山田"
    ],
    "speakers": "**UNKNOWN**: これは ト ラ スト ー ク の [*] テ スト です いい でしょう",
    "cost": 0.06307499999999999,
    "reliability": {
        "score": 0.9333333333333332,
        "justification": "要約は元の文字起こしの内容を正確に反映しているが、詳細な文脈やニュアンスが欠けているため、網羅性がやや低い。"
    }
}
--- FILE: ./backend/history/fa128291-44d6-4c44-b436-edbba113686e.json ---
{
    "id": "fa128291-44d6-4c44-b436-edbba113686e",
    "createdAt": "2025-08-17T10:33:37.587379+00:00",
    "originalFilename": "sanple.m4a",
    "model_name": "gpt-4o-mini",
    "transcript": "これはトラストークのテストですいいでしょう",
    "summary": "- トラストークのテストが行われた。",
    "todos": [
        "テスト結果を分析し、次回の改善点を明確にする。責任者: 山田"
    ],
    "speakers": "**UNKNOWN**: これは ト ラ スト ー ク の [*] テ スト です いい でしょう",
    "cost": 0.06862125000000001,
    "reliability": {
        "score": 0.9666666666666667,
        "justification": "要約は元の文字起こしの内容を正確に反映しており、簡潔である。ただし、元の文の「これは」という部分が省略されているため、完全な網羅性には欠ける。"
    }
}
--- FILE: ./backend/history/ac5f2a40-2007-4276-9e95-b2f5af101154.json ---
{
    "id": "ac5f2a40-2007-4276-9e95-b2f5af101154",
    "createdAt": "2025-08-17T10:29:23.828706+00:00",
    "originalFilename": "Todo.m4a",
    "model_name": "gpt-4o-mini",
    "transcript": "本日の会議は以上です。 アクションアイテムを確認します。続きさんは、来週の月曜日までに、 映像の提案資料を準備してください。佐藤さんは、金曜日に、 グライアントへ確認の例目をお願いします。",
    "summary": "- 本日の会議は終了し、続きさんと佐藤さんのアクションアイテムが確認されました。続きさんは来週の月曜日までに映像の提案資料を準備し、佐藤さんは金曜日にグライアントへ確認の連絡を行います。",
    "todos": [
        "続きさん: 映像の提案資料を来週の月曜日までに準備する",
        "佐藤さん: 金曜日にグライアントへ確認の連絡を行う"
    ],
    "speakers": "**UNKNOWN**: 本 日 の 会 議 は 以上 です。   ア ク ショ ン ア イ テ ム を 確 認 します。 続 き さん は、 来 週 の 月 曜 日 まで に、   映 像 の 提 案 資 料 を 準備 して ください。 佐 藤 さん は、 金 曜 日 に、   グ ライ ア ント へ 確 認 の 例 目 を お願いします。",
    "cost": 0.09354675000000001,
    "reliability": {
        "score": 1.0,
        "justification": "要約は元の文字起こしの内容を正確に反映しており、アクションアイテムも漏れなく含まれている。簡潔で明瞭な表現が使われているため、全体的に非常に良い要約である。"
    }
}
--- FILE: ./backend/cost_calculator.py ---
# backend/cost_calculator.py

# 2025年8月時点のおおよそのドル円レートを固定値として使用
# 本番環境では、APIなどでリアルタイムに取得するのが望ましいです
USD_TO_JPY_RATE = 145.0

# 各AIモデルの料金表 (100万トークンあたりのUSD)
# 注: 料金は変動する可能性があるため、これは実装時点での概算です
MODEL_PRICES_PER_MILLION_TOKENS = {
    # OpenAI
    "gpt-4o-mini": {"input": 0.150, "output": 0.600},
    "gpt-4o": {"input": 5.00, "output": 15.00},
    # Google
    "gemini-1.5-flash-latest": {"input": 0.35, "output": 1.05},
    "gemini-1.5-pro-latest": {"input": 3.50, "output": 10.50},
    # Anthropic
    "claude-3-haiku-20240307": {"input": 0.25, "output": 1.25},
    "claude-3-sonnet-20240229": {"input": 3.00, "output": 15.00},
}

# Whisperの料金 (1分あたりのUSD)
# whisper-timestampedはローカルで実行されるためAPIコストは0ですが、
# 将来的にOpenAIのAPI版に切り替えることを想定し、計算ロジックの枠組みを用意しておきます。
WHISPER_PRICE_PER_MINUTE = 0.00 # ローカル実行のため0

def calculate_cost_in_jpy(model_name: str, total_input_tokens: int, total_output_tokens: int, audio_duration_seconds: float) -> float:
    """
    使用したトークン数と音声の長さから、概算コストを日本円で計算する。
    """
    
    # 1. LLMのコストを計算 (USD)
    prices = MODEL_PRICES_PER_MILLION_TOKENS.get(model_name)
    if not prices:
        print(f"警告: モデル '{model_name}' の料金情報が見つかりません。")
        llm_cost_usd = 0.0
    else:
        input_cost = (total_input_tokens / 1_000_000) * prices["input"]
        output_cost = (total_output_tokens / 1_000_000) * prices["output"]
        llm_cost_usd = input_cost + output_cost

    # 2. Whisperのコストを計算 (USD)
    audio_duration_minutes = audio_duration_seconds / 60.0
    whisper_cost_usd = audio_duration_minutes * WHISPER_PRICE_PER_MINUTE
    
    # 3. 合計コストを日本円に換算
    total_cost_usd = llm_cost_usd + whisper_cost_usd
    total_cost_jpy = total_cost_usd * USD_TO_JPY_RATE
    
    print(f"Cost Calculated: LLM Tokens (in:{total_input_tokens}, out:{total_output_tokens}), Audio Duration: {audio_duration_seconds:.2f}s, Total Cost: ¥{total_cost_jpy:.4f}")
    
    return total_cost_jpy
--- FILE: ./backend/models.py ---
# backend/models.py (JSONモードの強制を削除)

from langchain_openai import ChatOpenAI
from langchain_google_genai import ChatGoogleGenerativeAI
from langchain_anthropic import ChatAnthropic
from langchain_core.language_models.chat_models import BaseChatModel

def get_llm(model_name: str) -> BaseChatModel:
    """
    モデル名に基づいて、適切なLLMクライアントのインスタンスを生成して返す。
    """
    
    provider = "unknown"
    if model_name.startswith("gpt"):
        provider = "openai"
    elif model_name.startswith("gemini"):
        provider = "google"
    elif model_name.startswith("claude"):
        provider = "anthropic"

    if provider == "openai":
        # ★ 変更点: デフォルトでのJSONモード強制を削除
        return ChatOpenAI(
            model=model_name,
            temperature=0,
        )
    elif provider == "google":
        return ChatGoogleGenerativeAI(model=model_name, temperature=0, convert_system_message_to_human=True)
    elif provider == "anthropic":
        return ChatAnthropic(model=model_name, temperature=0)
    else:
        raise ValueError(f"サポートされていない、または不明なモデル名です: {model_name}")